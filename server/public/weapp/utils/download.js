"use strict";const e=require("../common/vendor.js");exports.downloadFile=async(i,t,o="image")=>{if(!i)return e.index.$u.toast("文件地址错误");e.index.showLoading({title:"下载中"});try{i=(await e.index.downloadFile({url:i,timeout:1e4})).tempFilePath;const t="image"===o?e.index.saveImageToPhotosAlbum:e.index.saveVideoToPhotosAlbum;await t({filePath:i}),e.index.showToast({title:"文件保存成功",icon:"success"}),e.index.hideLoading()}catch(n){if(e.index.hideLoading(),"downloadFile:fail fail:timeout"==n.errMsg)return void e.index.$u.toast("文件下载超时，请重新下载");if(n.errMsg.indexof("fail auth deny")){if((await e.index.showModal({title:"提示",content:"您关闭了权限，请前往设置打开权限"})).confirm){(await e.index.openSetting()).authSetting["scope.writePhotosAlbum"]?e.index.showModal({title:"提示",content:"获取权限成功,再次保存文件即可成功",showCancel:!1}):e.index.showModal({title:"提示",content:"获取权限失败，无法保存到相册",showCancel:!1})}return}e.index.$u.toast("文件下载失败，请重试")}};
