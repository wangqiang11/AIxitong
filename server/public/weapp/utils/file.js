"use strict";const e=require("../common/vendor.js"),t=e.ref(!1);exports.saveImageToPhotosAlbum=async function(o,i={}){const{download:a=!0}=i;if(!o)return e.index.$u.toast("图片错误");if(!t.value){e.index.showLoading({title:"下载中"}),t.value=!0;try{if(a){o=(await e.index.downloadFile({url:o,timeout:1e4})).tempFilePath}await e.index.saveImageToPhotosAlbum({filePath:o}),e.index.hideLoading(),e.index.showToast({title:"保存成功",icon:"success"}),t.value=!1}catch(n){if(e.index.hideLoading(),console.log(n),t.value=!1,"saveImageToPhotosAlbum:fail cancel"==n.errMsg)return void e.index.$u.toast("取消保存");if("downloadFile:fail fail:timeout"==n.errMsg)return void e.index.$u.toast("下载图片超时，请重新下载");if("saveImageToPhotosAlbum:fail auth deny"==n.errMsg){if((await e.index.showModal({title:"提示",content:"您关闭了权限，请前往设置打开权限"})).confirm){(await e.index.openSetting()).authSetting["scope.writePhotosAlbum"]?e.index.showModal({title:"提示",content:"获取权限成功,再次保存图片即可成功",showCancel:!1}):e.index.showModal({title:"提示",content:"获取权限失败，无法保存到相册",showCancel:!1})}return}e.index.$u.toast(n.errMsg||"保存失败")}}};
