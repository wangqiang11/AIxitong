"use strict";const e=require("../../../../common/vendor.js"),a=require("../../../../api/square.js"),r=require("../../../../api/task_reward.js"),i=require("../../../../stores/user.js"),l=require("../../../../config/index.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../router/index.js"),require("../../../../utils/cache.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/client.js"),require("../../../../enums/appEnums.js"),require("../../../../api/user.js"),require("../../../../utils/auth.js"),require("../../../../utils/unique-id.js"),!Array){(e.resolveComponent("u-lazy-load")+e.resolveComponent("u-image")+e.resolveComponent("u-waterfall")+e.resolveComponent("z-paging")+e.resolveComponent("draw-poster"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-lazy-load/u-lazy-load.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-image/u-image.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-waterfall/u-waterfall.js")+(()=>"../../../../node-modules/z-paging/components/z-paging/z-paging.js"))();const o=e.defineComponent({__name:"draw",props:{keyword:null},setup(o){const u=o,s=l.config.baseUrl,n=e.useRouter(),t=i.useUserStore(),d=e.ref([]),c=e.shallowRef(),p=e.shallowRef(null),m=e.shallowRef(),f=e.ref(!1),v=e.reactive({lists:[],current:""}),g=()=>{var e;null==(e=c.value)||e.reload()},h=async(e,r)=>{var i,l,o;try{const{lists:o=[]}=await a.getDrawSquare({keyword:u.keyword,category_id:v.current,page_size:r,page_no:e});1==e&&(null==(i=p.value)||i.clear()),null==(l=c.value)||l.complete(o)}catch(s){null==(o=c.value)||o.complete(!1)}},b=async r=>{var i,l;if(t.isLogin)try{await a.drawSquareCollect({records_id:r.id,status:r.is_collect?0:1}),0===v.current?(c.value.refresh(),null==(i=p.value)||i.remove(r.id)):null==(l=p.value)||l.modify(r.id,"is_collect",r.is_collect?0:1)}catch(o){console.error(o),e.index.$u.toast(JSON.stringify(o))}else n.navigateTo("/pages/login/login")},w=async e=>{n.navigateTo({path:"/packages/pages/draw_detail/draw_detail",query:{id:e.id,collectId:e.id}})};return e.watchDebounced((()=>u.keyword),(e=>{g()}),{debounce:500}),e.onMounted((async()=>{await(async()=>{v.lists=await r.getSquareCategory({type:1}),v.lists.unshift({name:"全部",id:""})})()})),(a,r)=>e.e({a:e.f(v.lists,((a,r,i)=>({a:e.t(a.name),b:a.id===v.current?1:"",c:a.id,d:e.o((e=>{return r=a.id,v.current=r,void g();var r}),a.id)}))),b:e.w((({leftList:a},r,i)=>({a:e.f(a,((a,r,l)=>{var o,u;return e.e({a:"6b013af0-2-"+i+"-"+l+",6b013af0-1",b:e.p({threshold:"0","border-radius":"10",image:(null==a?void 0:a.thumbnail)||(null==a?void 0:a.image),index:r}),c:e.n(a.is_collect?"praise-entry":"praise-leave"),d:e.o((e=>b(a)),r),e:e.t((null==a?void 0:a.prompts_cn)||(null==a?void 0:a.original_prompts.prompt)),f:null==(o=null==a?void 0:a.user_info)?void 0:o.name},(null==(u=null==a?void 0:a.user_info)?void 0:u.name)?{g:"6b013af0-3-"+i+"-"+l+",6b013af0-1",h:e.p({src:a.user_info.image,width:"40",height:"40","border-radius":"50"}),i:e.t(a.user_info.name)}:{},{j:r,k:e.o((e=>w(a)),r)})})),b:i,c:r})),{name:"left",path:"b",vueId:"6b013af0-1,6b013af0-0"}),c:`url(${e.unref(s)}resource/image/api/default/praise.png)`,d:e.w((({rightList:a},r,i)=>({a:e.f(a,((a,r,l)=>{var o,u;return e.e({a:"6b013af0-4-"+i+"-"+l+",6b013af0-1",b:e.p({threshold:"0","border-radius":"10",image:(null==a?void 0:a.thumbnail)||(null==a?void 0:a.image),index:r}),c:e.n(a.is_collect?"praise-entry":"praise-leave"),d:e.o((e=>b(a)),r),e:e.t((null==a?void 0:a.prompts_cn)||(null==a?void 0:a.original_prompts.prompt)),f:null==(o=null==a?void 0:a.user_info)?void 0:o.name},(null==(u=null==a?void 0:a.user_info)?void 0:u.name)?{g:"6b013af0-5-"+i+"-"+l+",6b013af0-1",h:e.p({src:a.user_info.image,width:"40",height:"40","border-radius":"50"}),i:e.t(a.user_info.name)}:{},{j:r,k:e.o((e=>w(a)),r)})})),b:i,c:r})),{name:"right",path:"d",vueId:"6b013af0-1,6b013af0-0"}),e:`url(${e.unref(s)}resource/image/api/default/praise.png)`,f:e.sr(p,"6b013af0-1,6b013af0-0",{k:"waterfallRef"}),g:e.o((e=>d.value=e)),h:e.p({"add-time":"50",modelValue:d.value}),i:e.sr(c,"6b013af0-0",{k:"pagingRef"}),j:e.o(h),k:e.o((e=>d.value=e)),l:e.p({"auto-show-back-to-top":!0,fixed:!1,"auto-clean-list-when-reload":!0,"auto-scroll-to-top-when-reload":!1,modelValue:d.value}),m:f.value},f.value?{n:e.sr(m,"6b013af0-6",{k:"posterRef"}),o:e.o((e=>f.value=!1))}:{})}}),u=e._export_sfc(o,[["__scopeId","data-v-6b013af0"]]);wx.createComponent(u);
