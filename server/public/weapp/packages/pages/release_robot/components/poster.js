"use strict";const e=require("../../../../common/vendor.js"),n=require("../../../../api/robot.js"),o=require("../../../../config/index.js"),r=require("../../../../hooks/useLockFn.js"),t=require("../../../../utils/file.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/auth.js"),require("../../../../utils/cache.js"),require("../../../../utils/unique-id.js"),require("../../../../router/index.js"),require("../../../../utils/client.js"),require("../../../../enums/appEnums.js"),!Array){(e.resolveComponent("l-painter-qrcode")+e.resolveComponent("l-painter-view")+e.resolveComponent("l-painter-text")+e.resolveComponent("l-painter")+e.resolveComponent("file-upload")+e.resolveComponent("u-input")+e.resolveComponent("u-button")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../../uni_modules/lime-painter/components/l-painter-qrcode/l-painter-qrcode.js")+(()=>"../../../../uni_modules/lime-painter/components/l-painter-view/l-painter-view.js")+(()=>"../../../../uni_modules/lime-painter/components/l-painter-text/l-painter-text.js")+(()=>"../../../../uni_modules/lime-painter/components/l-painter/l-painter.js")+(()=>"../../../../components/file-upload/file-upload.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js"))();const i=e.defineComponent({__name:"poster",props:{show:{type:Boolean},url:null,apikey:null,shareId:null},emits:["update:show","update"],setup(i,{emit:s}){const u=i,l=e.useVModel(u,"show",s),a=e.computed((()=>`${window.location.origin}/resource/image/other/ai_share_bg.png`)),p=e.ref(a.value),c=e.ref("快来扫码"),d=e.ref("和我的智能体对话吧"),m=e=>{e.url&&(p.value=e.url)},v=e.computed((()=>`${o.config.baseUrl}chat/${u.apikey}`)),{lockFn:h,isLock:x}=r.useLockFn((async()=>{try{await n.putReleaseSetBg({id:u.shareId,url:p.value}),s("update");const e=await j();console.log(e),t.saveImageToPhotosAlbum(e,{download:!1})}catch(e){return Promise.reject()}})),g=()=>{p.value=a.value},f=e.ref(),j=()=>new Promise(((n,o)=>{var r;try{null==(r=f.value)||r.canvasToTempFilePathSync({fileType:"png",pathType:"url",quality:1,success:e=>{console.log(e),n(e.tempFilePath)},fail:n=>{o(n),e.index.hideLoading(),e.index.$u.toast("调用海报错误",n)}})}catch(t){console.log(t),o(t),e.index.hideLoading(),e.index.$u.toast("调用海报错误")}}));return e.watch((()=>u.url),(e=>{p.value=e||a.value})),(n,o)=>({a:e.p({css:"\n                                        width:280rpx;\n                                        height:280rpx;\n                                        box-sizing: border-box;\n                                        padding: 20rpx;\n                                        background-color: #FFFFFF;\n                                        border-radius:20rpx\n                                    ",text:e.unref(v)}),b:e.p({css:"\n                                        text-align: center;\n                                    "}),c:e.p({text:c.value,css:"\n                                            color: #FFFFFF;\n                                            text-align: center;\n                                            font-size: 32rpx;\n                                            font-weight: bold;\n                                        "}),d:e.p({css:"\n                                        text-align: center;\n                                        margin-top: 30rpx\n                                    "}),e:e.p({text:d.value,css:"\n                                            color: #FFFFFF;\n                                            text-align: center;\n                                            font-size: 32rpx;\n                                            font-weight: bold;\n                                        "}),f:e.p({css:`width: 570rpx;     \n                            display: flex;\n                            box-sizing: border-box;\n                            border-radius: 14rpx;\n                            height: 888rpx; \n                            background-image: url(${p.value});\n                            justify-content:center;\n                            align-items:center;\n                            `}),g:e.sr(f,"e5067b8f-1,e5067b8f-0",{k:"painterRef"}),h:e.p({isCanvasToTempFilePath:!1,"after-delay":100,css:"width: 570rpx;    \n                        height: 888rpx; \n                        "}),i:e.o(m),j:e.p({returnType:"object",maxCount:1,fileType:"image",showFilesLists:!1}),k:e.o(g),l:e.o((e=>c.value=e)),m:e.p({placeholder:"请输入背景图地址",border:!0,modelValue:c.value}),n:e.o((e=>d.value=e)),o:e.p({placeholder:"请输入背景图地址",border:!0,modelValue:d.value}),p:e.o(e.unref(h)),q:e.p({type:"primary",loading:e.unref(x)}),r:e.o((n=>e.isRef(l)?l.value=n:null)),s:e.p({mode:"center",closeable:!0,"border-radius":"14",modelValue:e.unref(l)})})}}),s=e._export_sfc(i,[["__scopeId","data-v-e5067b8f"]]);wx.createComponent(s);
