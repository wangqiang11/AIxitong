"use strict";const e=require("../../../common/vendor.js"),t=require("../../../api/ai_ppt.js"),o=require("../../../hooks/useCopy.js"),s=require("../../../stores/app.js"),u=require("./aiPPT.js");if(require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../stores/user.js"),require("../../../api/user.js"),require("../../../enums/constantEnums.js"),require("../../../utils/auth.js"),require("../../../utils/cache.js"),require("../../../utils/unique-id.js"),require("../../../router/index.js"),require("../../../config/index.js"),require("../../../utils/client.js"),require("../../../enums/appEnums.js"),require("../../../api/app.js"),require("../../../api/shop.js"),!Array){(e.resolveComponent("u-image")+e.resolveComponent("u-icon")+e.resolveComponent("u-loading")+e.resolveComponent("z-paging")+e.resolveComponent("u-action-sheet")+e.resolveComponent("u-button")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../uni_modules/vk-uview-ui/components/u-image/u-image.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-loading/u-loading.js")+(()=>"../../../node-modules/z-paging/components/z-paging/z-paging.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-action-sheet/u-action-sheet.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js"))();const i=e.defineComponent({__name:"history",setup(i){const a=e.useRouter(),n=s.useAppStore(),r=u.useAiPPTStore();r.getPPTConfig();const l=e.shallowRef(),{copy:p}=o.useCopy(),m=e.ref([]),c=[{name:"全部",type:-1},{name:"生成中",type:1},{name:"生成成功",type:2},{name:"生成失败",type:3}];e.shallowRef(null);const d=e.ref(-1),v=e.reactive({show:!1,item:{}}),g=e.computed((()=>{const e=[{value:"delete",text:"删除",color:"#EA0000"}];return 2==v.item.status&&e.unshift({value:"download",text:"下载"+(v.item.pay_status?"":r.config.isVipFree?"(会员免费)":r.config.price>0?"-"+r.config.price+n.getTokenUnit:"")}),e})),h=e=>{v.show=!0,v.item=e},j=e.ref(),w=async o=>{const s=g.value[o].value,u=v.item;switch(s){case"delete":(async o=>{const{cancel:s}=await e.index.showModal({title:"温馨提示",content:"确定删除？"});s||(await t.delPPT({id:o}),_())})(u.id);break;case"download":j.value=!0}},f=async()=>{const{file_url:e}=await t.downloadPPT({id:v.item.id});await p(e),j.value=!1},q=e.shallowRef(),y=async(e,o)=>{try{const{lists:s}=await t.getPPTLists({page_no:e,page_size:o,status:d.value});l.value.complete(s)}catch(s){l.value.complete(!1)}finally{setTimeout((()=>{clearTimeout(q.value),[-1,1].includes(d.value)&&m.value.some((e=>1===e.status))&&(q.value=setTimeout((()=>{_()}),6e3))}),100)}},_=()=>{var e;null==(e=l.value)||e.refresh()};return e.watch(d,(()=>{_()})),e.onUnmounted((()=>{clearTimeout(q.value)})),(t,o)=>({a:t.$theme.navColor,b:t.$theme.navBgColor,c:t.$theme.pageStyle,d:e.f(c,((t,o,s)=>({a:e.t(t.name),b:t.type===d.value?1:"",c:e.o((e=>d.value=t.type),t.type),d:t.type}))),e:e.f(m.value,((t,o,s)=>{var u;return e.e({a:"321d32e8-1-"+s+",321d32e8-0",b:e.p({src:null==(u=t.preview)?void 0:u[0],width:"100%",height:"100%",mode:"widthFix"}),c:e.t(t.title),d:e.t(t.create_time),e:"321d32e8-2-"+s+",321d32e8-0",f:e.o((e=>h(t)),t.id),g:3==t.status||1==t.status},3==t.status||1==t.status?e.e({h:1==t.status},1==t.status?{i:"321d32e8-3-"+s+",321d32e8-0",j:e.p({size:50,mode:"flower"})}:{k:e.t(t.create_time),l:"321d32e8-4-"+s+",321d32e8-0",m:e.p({name:"more-dot-fill",size:32}),n:e.o((e=>h(t)),t.id)}):{},{o:e.o((e=>{return o=t.id,void a.navigateTo({path:"/packages/pages/ai_ppt/detail",query:{id:o}});var o}),t.id),p:t.id})})),f:e.p({name:"more-dot-fill",size:32}),g:e.sr(l,"321d32e8-0",{k:"pagingRef"}),h:e.o(y),i:e.o((e=>m.value=e)),j:e.p({"auto-clean-list-when-reload":!1,"safe-area-inset-bottom":!0,fixed:!0,modelValue:m.value}),k:e.o(w),l:e.o((e=>v.show=e)),m:e.p({"safe-area-inset-bottom":!0,list:e.unref(g),modelValue:v.show}),n:e.o(f),o:e.p({type:"primary",shape:"circle"}),p:e.o((e=>j.value=e)),q:e.p({mode:"center","border-radius":"15",closeable:!0,modelValue:j.value})})}});wx.createPage(i);
