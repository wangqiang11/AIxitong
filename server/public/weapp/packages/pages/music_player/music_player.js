"use strict";const e=require("../../../common/vendor.js"),u=require("../../../common/assets.js"),r=require("../../../api/music.js"),s=require("../../../api/square.js"),i=require("./useMusicPlay.js"),t=require("../../../hooks/useCopy.js"),n=require("../../../stores/user.js");if(require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../router/index.js"),require("../../../utils/cache.js"),require("../../../enums/constantEnums.js"),require("../../../config/index.js"),require("../../../utils/client.js"),require("../../../enums/appEnums.js"),require("../../../api/user.js"),require("../../../utils/auth.js"),require("../../../utils/unique-id.js"),!Array){(e.resolveComponent("uv-slider")+e.resolveComponent("u-icon")+e.resolveComponent("u-button")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../uni_modules/uv-slider/components/uv-slider/uv-slider.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js"))();const o=e.defineComponent({__name:"music_player",setup(o){const{copy:l}=t.useCopy(),a=e.useRoute(),c=e.useRouter(),d=n.useUserStore(),p=e.ref([]),v=["default","lyric"],m=e.ref(0),f=new Map,q=e.ref(-1),y=e.ref(!1),g=e.ref(""),{play:j,duration:h,currentTime:_,seek:w,isPlaying:C,pause:b,setUrl:k}=i.useMusicPlay(),M=()=>{C.value?b():j()},x=e=>{let u=q.value+e;u<=0&&(u=0),u>=p.value.length-1&&(u=p.value.length-1),q.value=u},$=async()=>{await l(g.value),y.value=!1},z=e=>{w(e)},E=e=>{let u=parseInt(String(e/60)),r=Math.round(e%60)+"";return 0==u?u="00":u<10&&(u="0"+u),1==r.length&&(r="0"+r),u+":"+r},L=e=>{m.value=e.detail.current},P=e.computed((()=>p.value[q.value]||{}));return e.watch(P,(e=>{e.audio_url&&(k(e.audio_url),j())})),e.onMounted((async()=>{if(!d.isLogin&&"square"!=a.query.mode)return void c.navigateTo("/pages/login/login");await(async()=>{if(f.clear(),"square"==a.query.mode){const e=await s.getMusicDetail({id:a.query.id});e.square_id=a.query.id;const u=await s.getMusicRecommendLists();-1===u.findIndex((e=>e.id==a.query.id))?(u.unshift(e),p.value=u):p.value=u,p.value.forEach(((e,u)=>{f.set(1*e.square_id,u),console.log("没有找到音乐",f)}))}else{const e=await r.getMusicLists({page_type:0,status:2});p.value=e.lists,p.value.forEach(((e,u)=>{f.set(e.id,u)}))}})();const e=f.get(1*a.query.id);-1!==e&&(q.value=e)})),e.onUnload((()=>{b(),p.value=[]})),(r,s)=>e.e({a:r.$theme.navColor,b:r.$theme.navBgColor,c:r.$theme.pageStyle,d:p.value.length},p.value.length?e.e({e:e.f(v,((e,u,r)=>({a:e,b:m.value===u?1:""}))),f:e.f(v,((u,r,s)=>e.e({a:"default"===u},"default"===u?e.e({b:e.unref(P).image_url,c:e.t(e.unref(P).title),d:e.unref(P).style_desc},e.unref(P).style_desc?{e:e.t(e.unref(P).style_desc)}:{},{f:e.t(e.unref(P).lyric)}):"lyric"===u?e.e({h:e.t(e.unref(P).title),i:e.unref(P).style_desc},e.unref(P).style_desc?{j:e.t(e.unref(P).style_desc)}:{},{k:e.t(e.unref(P).lyric)}):{},{g:"lyric"===u,l:u}))),g:m.value,h:e.o(L),i:e.t(E(e.unref(_))),j:e.o(z),k:e.p({disabled:!e.unref(h),"model-value":e.unref(_),"block-size":12,"block-color":r.$theme.primaryColor,max:e.unref(h)||100,activeColor:r.$theme.primaryColor}),l:e.t(e.unref(h)?E(e.unref(h)):e.unref(P).duration),m:e.p({name:"download",size:48,color:"#999999"}),n:e.o((u=>{return r=e.unref(P),d.isLogin||c.navigateTo("/pages/login/login"),y.value=!0,void(g.value=r.audio_url);var r})),o:u._imports_0$5,p:0===q.value?1:"",q:e.o((e=>x(-1))),r:e.unref(C)},e.unref(C)?{s:e.p({name:"pause",size:40})}:{t:e.p({name:"play-right-fill",size:40})},{v:e.o(M),w:q.value===p.value.length-1?1:"",x:u._imports_1$3,y:e.o((e=>x(1))),z:e.o((e=>m.value=1)),A:e.o($),B:e.p({type:"primary",shape:"circle"}),C:e.o((e=>y.value=e)),D:e.p({mode:"center","border-radius":"15",closeable:!0,modelValue:y.value})}):{})}});wx.createPage(o);
