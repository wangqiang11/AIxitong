"use strict";const e=require("../../../common/vendor.js"),o=require("../../../api/member.js"),n=require("../../../api/pay.js"),a=require("../../../enums/appEnums.js"),r=require("../../../hooks/useLockFn.js"),u=require("../../../stores/app.js"),s=require("../../../stores/user.js");if(require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../router/index.js"),require("../../../utils/cache.js"),require("../../../enums/constantEnums.js"),require("../../../config/index.js"),require("../../../utils/client.js"),require("../../../api/app.js"),require("../../../api/shop.js"),require("../../../api/user.js"),require("../../../utils/auth.js"),require("../../../utils/unique-id.js"),!Array){(e.resolveComponent("u-avatar")+e.resolveComponent("u-tabs")+e.resolveComponent("price")+e.resolveComponent("router-navigate")+e.resolveComponent("u-empty")+e.resolveComponent("u-icon")+e.resolveComponent("u-popup")+e.resolveComponent("page-status")+e.resolveComponent("tabbar"))()}Math||((()=>"../../../uni_modules/vk-uview-ui/components/u-avatar/u-avatar.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-tabs/u-tabs.js")+(()=>"../../../components/price/price.js")+(()=>"../../../node-modules/uniapp-router-next/components/router-navigate/router-navigate.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-empty/u-empty.js")+i+(()=>"../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js")+(()=>"../../../components/page-status/page-status.js")+(()=>"../../../components/tabbar/tabbar.js"))();const i=()=>"../../components/payment/payment.js",t=e.defineComponent({__name:"member_center",setup(i){e.useRouter();const t=u.useAppStore(),l=s.useUserStore(),c=e.ref(a.PageStatusEnum.LOADING),m=e.ref([]),p=e.index.getSystemInfoSync(),v=e.ref({is_open:1,tips:"立即支付"}),d=e.reactive({orderId:"",from:"member",showPay:!1,orderAmount:"",showCheck:!1,showPaySuccess:!1}),f=e.ref(-1),g=e.ref(-1),h={1:"天",2:"个月"},_=e.computed((()=>{var e;if(-1===f.value&&(null==(e=m.value)?void 0:e.length)){const e=m.value.findIndex((e=>e.is_recommend));f.value=-1!==e?e:0}return m.value[f.value]||{}})),y=e.computed((()=>{var e,o,n,a;if(null==(o=null==(e=_.value)?void 0:e.price_list)?void 0:o.length){const e=(null==(n=_.value)?void 0:n.price_list.findIndex((e=>e.is_recommend)))||0;g.value=-1!==e?e:0}return(null==(a=_.value)?void 0:a.price_list)||[]})),{isLock:k,lockFn:b}=r.useLockFn((async()=>{e.index.showLoading({mask:!0,title:"请稍后..."});try{const n=await o.memberPackageBuy({member_price_id:y.value[g.value].id});e.index.hideLoading(),d.orderId=n.order_id,d.showPay=!0,d.orderAmount=n.order_amount}catch(n){setTimeout((()=>e.index.hideLoading()),1e3)}})),w=async()=>{d.showPay=!1,d.showPaySuccess=!0,l.getUser()},j=async()=>{const e=await o.memberPackageList();m.value=[],setTimeout((()=>{m.value=e}),250)};return e.onShow((async()=>{(async()=>{try{await Promise.all([j()]),c.value=a.PageStatusEnum.NORMAL}catch(e){c.value=a.PageStatusEnum.ERROR}})(),-1!==p.system.indexOf("iOS")&&await(async()=>{try{v.value=await n.getIosPayConfig(),console.log(v.value),0==v.value.is_open&&e.index.showModal({title:"提示",content:v.value.tips,showCancel:!1,success:()=>e.index.navigateBack()})}catch(o){console.log("获取支付设置错误=>",o)}})()})),e.onLoad((e=>{((null==e?void 0:e.id)||e["amp;id"])&&(e.from||e["amp;from"])&&(d.orderId=(null==e?void 0:e.id)||e["amp;id"],d.from=e.from||e["amp;from"]),(null==e?void 0:e.checkPay)&&(d.showCheck=!0)})),e.onPullDownRefresh((async()=>{})),(o,n)=>{var a,r,u,s,i,p,k,j,q,x;return e.e({a:o.$theme.navColor,b:o.$theme.navBgColor,c:o.$theme.pageStyle,d:v.value.is_open},v.value.is_open?e.e({e:null==(a=e.unref(t).config)?void 0:a.member_package_open},(null==(r=e.unref(t).config)?void 0:r.member_package_open)?e.e({f:e.p({src:e.unref(l).userInfo.avatar,size:120}),g:e.t(e.unref(l).userInfo.nickname),h:e.unref(l).userInfo.package_name?"300rpx":"100%",i:e.unref(l).userInfo.package_name},e.unref(l).userInfo.package_name?{j:e.t(e.unref(l).userInfo.package_name)}:{},{k:e.t(e.unref(l).userInfo.package_time||"-"),l:e.o((e=>f.value=e)),m:e.p({"is-scroll":!0,bgColor:"none",list:m.value,"active-color":o.$theme.primaryColor,modelValue:f.value}),n:e.f(e.unref(y),((o,n,a)=>e.e({a:o.tags},o.tags?{b:e.t(o.tags)}:{},{c:e.t(h[o.duration_type]?o.duration+h[o.duration_type]:"永久"),d:"641a0eaa-3-"+a+",641a0eaa-0",e:e.p({content:o.sell_price,color:"#000",fontWeight:"500",mainSize:"45rpx",minorSize:"32rpx"}),f:o.lineation_price>0},o.lineation_price>0?{g:"641a0eaa-4-"+a+",641a0eaa-0",h:e.p({color:"#999999",lineThrough:!0,content:o.lineation_price,mainSize:"28rpx",minorSize:"28rpx"})}:{},{i:o.id,j:o.tags?1:"",k:n==g.value?1:"",l:e.o((e=>g.value=n),o.id)}))),o:e.f(e.unref(_).benefits_list,((o,n,a)=>({a:o.image,b:e.t(o.name),c:e.t(o.describe),d:n}))),p:null==(u=e.unref(y)[g.value])?void 0:u.is_give},(null==(s=e.unref(y)[g.value])?void 0:s.is_give)?e.e({q:0!=(null==(i=e.unref(y)[g.value])?void 0:i.give_balance)},0!=(null==(p=e.unref(y)[g.value])?void 0:p.give_balance)?{r:e.t(e.unref(t).getTokenUnit),s:e.t(null==(k=e.unref(y)[g.value])?void 0:k.give_balance)}:{},{t:0!=(null==(j=e.unref(y)[g.value])?void 0:j.give_robot)},0!=(null==(q=e.unref(y)[g.value])?void 0:q.give_robot)?{v:e.t(null==(x=e.unref(y)[g.value])?void 0:x.give_robot)}:{}):{},{w:e.o(((...o)=>e.unref(b)&&e.unref(b)(...o))),x:e.p({to:"/packages/pages/agreement/agreement?type=payment"})}):{y:e.p({text:"功能未开启"})},{z:e.p({text:"加载出错～"}),A:e.o(w),B:e.o((e=>d.showPay=e)),C:e.o((e=>d.showCheck=e)),D:e.p({"order-id":d.orderId,from:d.from,redirect:"/mobile/packages/pages/member_center/member_center","order-amount":d.orderAmount,show:d.showPay,showCheck:d.showCheck}),E:e.p({name:"checkmark-circle-fill",size:"100"}),F:e.o((e=>d.showPaySuccess=!1)),G:e.p({to:"/pages/index/index","nav-type":"reLaunch"}),H:e.o((e=>d.showPaySuccess=e)),I:e.p({"safe-area-inset-bottom":!0,"mask-close-able":!1,"border-radius":"14","z-index":899,round:!0,mode:"center",width:"600",modelValue:d.showPaySuccess}),J:e.p({status:c.value})}):{})}}});wx.createPage(t);
