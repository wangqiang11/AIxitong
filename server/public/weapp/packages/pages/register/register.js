"use strict";const e=require("../../../common/vendor.js"),o=require("../../../api/account.js"),r=require("../../../stores/app.js"),u=require("../../../api/app.js"),t=require("../../../enums/appEnums.js"),s=require("../../../enums/constantEnums.js"),i=require("../../../hooks/useLockFn.js"),n=require("../../../utils/cache.js");if(require("../../../utils/client.js"),require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../stores/user.js"),require("../../../api/user.js"),require("../../../utils/auth.js"),require("../../../utils/unique-id.js"),require("../../../router/index.js"),require("../../../config/index.js"),require("../../../api/shop.js"),!Array){(e.resolveComponent("u-tabs")+e.resolveComponent("u-input")+e.resolveComponent("u-form-item")+e.resolveComponent("u-verification-code")+e.resolveComponent("u-form")+e.resolveComponent("agreement")+e.resolveComponent("u-button"))()}Math||((()=>"../../../uni_modules/vk-uview-ui/components/u-tabs/u-tabs.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-form-item/u-form-item.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-verification-code/u-verification-code.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-form/u-form.js")+(()=>"../../../components/agreement/agreement.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-button/u-button.js"))();const a=e.defineComponent({__name:"register",setup(a){const l=[{name:"手机号注册",type:"1"},{name:"邮箱注册",type:"2"}],m=e.ref(0),d=e.computed((()=>{var e;return(null==(e=p.getLoginConfig)?void 0:e.register_way)||[]})),c=e.computed((()=>l.filter((e=>d.value.includes(e.type))))),p=r.useAppStore(),v=e.useRouter(),f=e.shallowRef(),b=e.reactive({scene:"2",mobile:"",code:"",email:"",password:"",password_confirm:""}),j=e.shallowRef(),w=e.ref(""),q=e=>{w.value=e},g=e.computed((()=>e.index.$u.test.mobile(b.mobile))),h=e.computed((()=>e.index.$u.test.email(b.email))),y=e.computed((()=>{var e;return 1==(null==(e=p.getLoginConfig)?void 0:e.register_sms_verify)})),x=e.computed((()=>"1"==b.scene)),_=e.computed((()=>"2"==b.scene)),C=e=>{m.value=e,b.scene=l[e].type,1==e?b.mobile="":b.email=""},$=async()=>{var o,r;if(null==(o=j.value)?void 0:o.canGetCode)try{x.value?await E():await k(),e.index.$u.toast("发送成功"),null==(r=j.value)||r.start()}catch(u){console.log("发送验证码失败=>",u)}},k=async()=>(console.log(h.value),b.email?h.value?void(await o.sendEmailCode({scene:t.SMSEnum.REGISTER,email:b.email})):(e.index.$u.toast("请输入正确的邮箱地址"),Promise.reject()):(e.index.$u.toast("请输入邮箱"),Promise.reject())),E=async()=>b.mobile?h.value?(e.index.$u.toast("请输入正确的手机号"),Promise.reject()):void(await u.smsSend({scene:t.SMSEnum.REGISTER,mobile:b.mobile})):(e.index.$u.toast("请输入手机号"),Promise.reject()),{lockFn:S}=i.useLockFn((async()=>{var r;if(!(null==(r=f.value)?void 0:r.checkAgreement()))return;if(!b.mobile&&x.value)return e.index.$u.toast("请输入手机号码");if(!b.email&&_.value)return e.index.$u.toast("请输入邮箱");if(!b.code&&y.value)return e.index.$u.toast("请输入验证码");if(!b.password)return e.index.$u.toast("请输入密码");if(!b.password_confirm)return e.index.$u.toast("请再次输入密码");if(b.password!=b.password_confirm)return e.index.$u.toast("两次输入的密码不一致");const u=await o.register(b);n.cache.set(s.USER_LOGIN_DATA,JSON.stringify(u)),setTimeout((()=>{v.navigateBack()}),1500)}));return e.onLoad((async({type:e})=>{setTimeout((()=>{b.scene=e,2==e&&d.value.includes("1")&&(m.value=1)}),300)})),(o,r)=>e.e({a:o.$theme.navColor,b:o.$theme.navBgColor,c:o.$theme.pageStyle,d:e.o(C),e:e.o((e=>m.value=e)),f:e.p({list:e.unref(c),"active-color":o.$theme.primaryColor,modelValue:m.value}),g:e.unref(x)},e.unref(x)?{h:e.o((e=>b.mobile=e)),i:e.p({border:!1,placeholder:"请输入手机号码",modelValue:b.mobile}),j:e.p({label:"手机号",borderBottom:!0})}:{},{k:e.unref(_)},e.unref(_)?{l:e.o((e=>b.email=e)),m:e.p({border:!1,placeholder:"请输入邮箱账号",modelValue:b.email}),n:e.p({label:"邮箱",borderBottom:!0})}:{},{o:e.unref(y)},e.unref(y)?{p:e.o((e=>b.code=e)),q:e.p({placeholder:"请输入验证码",border:!1,modelValue:b.code}),r:e.sr(j,"5ae173d5-8,5ae173d5-6",{k:"uCodeRef"}),s:e.o(q),t:e.p({seconds:60,"change-text":"x秒"}),v:e.t(w.value),w:e.unref(g)&&e.unref(x)||e.unref(h)&&e.unref(_)?1:"",x:e.o($),y:e.p({label:"验证码"})}:{},{z:e.o((e=>b.password=e)),A:e.p({type:"password",placeholder:"请输入字母+数字组合的密码",border:!1,modelValue:b.password}),B:e.p({label:"设置密码",borderBottom:!0}),C:e.o((e=>b.password_confirm=e)),D:e.p({type:"password",placeholder:"再次输入密码",border:!1,modelValue:b.password_confirm}),E:e.p({label:"确认密码",borderBottom:!0}),F:e.p({borderBottom:!0,"label-width":150}),G:e.sr(f,"5ae173d5-13",{k:"agreementRef"}),H:e.o(e.unref(S)),I:e.p({type:"primary",shape:"circle"})})}});wx.createPage(a);
