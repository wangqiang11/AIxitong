"use strict";const e=require("../../../../common/vendor.js"),u=require("../../../../common/assets.js"),s=require("../../../../api/music.js"),a=require("../../../../hooks/useCopy.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/auth.js"),require("../../../../utils/cache.js"),require("../../../../utils/unique-id.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../utils/client.js"),require("../../../../enums/appEnums.js"),!Array){(e.resolveComponent("u-image")+e.resolveComponent("u-icon")+e.resolveComponent("u-loading")+e.resolveComponent("u-checkbox")+e.resolveComponent("u-button")+e.resolveComponent("z-paging")+e.resolveComponent("u-action-sheet")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-image/u-image.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-loading/u-loading.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-checkbox/u-checkbox.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../../node-modules/z-paging/components/z-paging/z-paging.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-action-sheet/u-action-sheet.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js"))();const t=e.defineComponent({__name:"music",props:{isBatch:{type:Boolean}},setup(t){const o=t,i=e.useRouter(),n=e.shallowRef(),{copy:l}=a.useCopy(),r=e.ref([]),c=e.ref([]),m=e.computed({get:()=>c.value.length===r.value.length,set(){c.value.length===r.value.length?c.value=[]:c.value=r.value.map((e=>e.id))}});e.watch((()=>o.isBatch),(()=>{c.value=[]}));const p=e.reactive({show:!1,item:{}}),d=e.computed((()=>{const e=[{value:"delete",text:"删除",color:"#EA0000"}];return 2==p.item.status&&e.unshift({value:"download",text:"下载"}),e})),v=e=>{p.show=!0,p.item=e},h=async u=>{const{cancel:a}=await e.index.showModal({title:"温馨提示",content:"确定删除？"});a||(await s.deleteMusic({id:u}),c.value=[],q())},g=e.ref(),j=async e=>{const u=d.value[e].value,s=p.item;switch(u){case"delete":h(s.id);break;case"download":g.value=!0}},w=async()=>{await l(p.item.audio_url),g.value=!1},b=e.shallowRef(),f=async(e,u)=>{try{const{lists:a}=await s.getMusicLists({page_no:e,page_size:u,status:2});n.value.complete(a)}catch(a){n.value.complete(!1)}},q=()=>{var e;null==(e=n.value)||e.refresh()};return e.onUnmounted((()=>{clearTimeout(b.value)})),(s,a)=>e.e({a:e.f(r.value,((s,a,n)=>e.e({a:"546b3ada-1-"+n+",546b3ada-0",b:e.p({src:s.image_url,width:"100%",height:"100%"}),c:e.t(s.duration),d:e.t(s.title),e:e.t(s.create_time),f:"546b3ada-2-"+n+",546b3ada-0",g:e.o((e=>v(s)),s.id),h:3==s.status||1==s.status},3==s.status||1==s.status?e.e({i:1==s.status},1==s.status?{j:"546b3ada-3-"+n+",546b3ada-0",k:e.p({size:50,mode:"flower"})}:{l:"546b3ada-4-"+n+",546b3ada-0",m:e.p({name:e.unref(u.music_fail),size:50}),n:e.t(s.create_time),o:"546b3ada-5-"+n+",546b3ada-0",p:e.p({name:"more-dot-fill",size:32}),q:e.o((e=>v(s)),s.id)}):{},t.isBatch?{r:"546b3ada-6-"+n+",546b3ada-0",s:e.p({"model-value":c.value.includes(s.id),shape:"circle"})}:{},{t:e.o((e=>(e=>{if(o.isBatch){const u=c.value.findIndex((u=>u===e));u>-1?c.value.splice(u,1):c.value.push(e)}else i.navigateTo({path:"/packages/pages/music_player/music_player",query:{id:e,mode:"user_works"}})})(s.id)),s.id),v:s.id}))),b:u._imports_0$4,c:e.p({name:"more-dot-fill",size:32}),d:t.isBatch,e:t.isBatch},t.isBatch?{f:e.o((u=>e.isRef(m)?m.value=u:null)),g:e.p({shape:"circle",modelValue:e.unref(m)}),h:e.t(c.value.length),i:e.t(r.value.length),j:e.o((e=>h(c.value))),k:e.p({size:"medium",type:"error",disabled:!c.value.length})}:{},{l:e.sr(n,"546b3ada-0",{k:"pagingRef"}),m:e.o(f),n:e.o((e=>r.value=e)),o:e.p({"auto-clean-list-when-reload":!1,"safe-area-inset-bottom":!0,fixed:!1,height:"100%",modelValue:r.value}),p:e.o(j),q:e.o((e=>p.show=e)),r:e.p({"safe-area-inset-bottom":!0,list:e.unref(d),modelValue:p.show}),s:e.o(w),t:e.p({type:"primary",shape:"circle"}),v:e.o((e=>g.value=e)),w:e.p({mode:"center","border-radius":"15",closeable:!0,modelValue:g.value})})}});wx.createComponent(t);
