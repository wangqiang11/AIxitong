"use strict";const e=require("../../../common/vendor.js"),t=require("../../../api/video.js"),s=require("../../../utils/client.js"),o=require("../../../hooks/useCopy.js"),a=require("../../../utils/download.js"),u=require("../../../stores/app.js"),i=require("../../../common/assets.js");if(require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../stores/user.js"),require("../../../api/user.js"),require("../../../enums/constantEnums.js"),require("../../../utils/auth.js"),require("../../../utils/cache.js"),require("../../../utils/unique-id.js"),require("../../../router/index.js"),require("../../../config/index.js"),require("../../../enums/appEnums.js"),require("../../../api/app.js"),require("../../../api/shop.js"),!Array){(e.resolveComponent("u-loading")+e.resolveComponent("u-tag")+e.resolveComponent("z-paging")+e.resolveComponent("u-button")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../uni_modules/vk-uview-ui/components/u-loading/u-loading.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-tag/u-tag.js")+(()=>"../../../node-modules/z-paging/components/z-paging/z-paging.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js")+r)();const r=()=>"./_components/video-share.js",n=e.defineComponent({__name:"video_list",setup(r){const n=e.useRouter(),l=u.useAppStore(),p=e.shallowRef(),{copy:d}=o.useCopy(),c=e.ref([]),m=[{name:"全部",type:-1},{name:"生成中",type:1},{name:"生成成功",type:2},{name:"生成失败",type:3}],v=e.ref(!1),g=e.shallowRef(null),f=e.ref([]),h=e.ref(-1),q=e.reactive({show:!1,item:{}}),w=async()=>{await d(q.item.video_url),q.show=!1},y=e.shallowRef(),j=async(e,s)=>{try{const{lists:o}=await t.getVideoLists({page_no:e,page_size:s,status:h.value});p.value.complete(o)}catch(o){p.value.complete(!1)}finally{setTimeout((()=>{clearTimeout(y.value),[-1,1].includes(h.value)&&c.value.some((e=>1===e.status))&&(y.value=setTimeout((()=>{_()}),6e3))}),100)}},_=()=>{var e;null==(e=p.value)||e.refresh()};return e.watch(h,(()=>{_()})),e.onUnmounted((()=>{clearTimeout(y.value)})),(o,u)=>e.e({a:o.$theme.navColor,b:o.$theme.navBgColor,c:o.$theme.pageStyle,d:e.f(m,((t,s,o)=>({a:e.t(t.name),b:t.type===h.value?1:"",c:e.o((e=>h.value=t.type),t.type),d:t.type}))),e:e.f(c.value,((o,u,r)=>e.e({a:1===o.status},1===o.status?{b:"39eee475-1-"+r+",39eee475-0",c:e.p({mode:"flower",size:"80"})}:{},{d:2===o.status||3===o.status},2===o.status||3===o.status?e.e({e:2===o.status},2===o.status?{f:"39eee475-2-"+r+",39eee475-0",g:e.p({text:o.status_desc,"border-color":"transparent",type:"success"})}:{},{h:3===o.status},3===o.status?{i:"39eee475-3-"+r+",39eee475-0",j:e.p({text:o.status_desc,"border-color":"transparent",type:"error"})}:{},{k:2===o.status},2===o.status?{l:e.unref(i._imports_1$2),m:e.o((t=>e.unref(d)(o.prompt)),o.id),n:e.unref(i.IconDownload),o:e.o((e=>(e=>{s.isWeixinClient()?(q.show=!0,q.item=e):a.downloadFile(e.video_url,"视频","video")})(o)),o.id)}:{},{p:e.unref(i.IconReload),q:e.o((t=>(async t=>{const s={type:t.type,prompt:t.prompt,scale:t.scale,image:t.image,style_id:t.style_id};getCurrentPages().length>1?(await n.navigateBack(),e.index.$emit("videoRegenerate",s)):await n.redirectTo({path:"/packages/pages/video/video",query:{data:JSON.stringify(s)}})})(o)),o.id),r:e.unref(l).getSquareConfig.video_award.is_open},e.unref(l).getSquareConfig.video_award.is_open?{s:e.unref(i.IconShare),t:e.o((t=>(async(t,s)=>{f.value.includes(t)||s?await e.index.showModal({title:"温馨提示",content:"该视频已分享过了！"}):(v.value=!0,await e.nextTick$1(),setTimeout((()=>g.value.open(t)),50))})(o.id,o.is_share)),o.id)}:{},{v:e.unref(i.IconDelete),w:e.o((s=>(async s=>{const{cancel:o}=await e.index.showModal({title:"温馨提示",content:"确定删除？"});o||(await t.deleteVideo({id:s}),_())})(o.id)),o.id),x:3===o.status},3===o.status?e.e({y:e.unref(i.ImageError),z:o.fail_reason},o.fail_reason?{A:e.t(o.fail_reason)}:{}):2===o.status?{C:o.video_url}:{},{B:2===o.status,D:e.t(o.prompt),E:e.t(o.create_time),F:"39eee475-4-"+r+",39eee475-0",G:e.p({text:o.type_desc,size:"mini","border-color":"transparent"})}):{},{H:o.id}))),f:e.sr(p,"39eee475-0",{k:"pagingRef"}),g:e.o(j),h:e.o((e=>c.value=e)),i:e.p({"auto-clean-list-when-reload":!1,"safe-area-inset-bottom":!0,fixed:!0,modelValue:c.value}),j:e.o(w),k:e.p({type:"primary",shape:"circle"}),l:e.o((e=>q.show=e)),m:e.p({mode:"center","border-radius":"15",closeable:!0,modelValue:q.show}),n:v.value},v.value?{o:e.sr(g,"39eee475-7",{k:"shareRef"}),p:e.o((e=>v.value=!1)),q:e.o((e=>f.value.push(e)))}:{})}});wx.createPage(n);
