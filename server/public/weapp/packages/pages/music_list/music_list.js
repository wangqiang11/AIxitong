"use strict";const e=require("../../../common/vendor.js"),a=require("../../../common/assets.js"),s=require("../../../api/music.js"),u=require("../../../hooks/useCopy.js"),t=require("../../../stores/app.js");if(require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../stores/user.js"),require("../../../api/user.js"),require("../../../enums/constantEnums.js"),require("../../../utils/auth.js"),require("../../../utils/cache.js"),require("../../../utils/unique-id.js"),require("../../../router/index.js"),require("../../../config/index.js"),require("../../../utils/client.js"),require("../../../enums/appEnums.js"),require("../../../api/app.js"),require("../../../api/shop.js"),!Array){(e.resolveComponent("u-image")+e.resolveComponent("u-icon")+e.resolveComponent("u-loading")+e.resolveComponent("z-paging")+e.resolveComponent("u-action-sheet")+e.resolveComponent("u-button")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../uni_modules/vk-uview-ui/components/u-image/u-image.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-loading/u-loading.js")+(()=>"../../../node-modules/z-paging/components/z-paging/z-paging.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-action-sheet/u-action-sheet.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js")+o)();const o=()=>"./_components/music-share.js",i=e.defineComponent({__name:"music_list",setup(o){const i=e.useRouter(),n=t.useAppStore(),r=e.shallowRef(),{copy:l}=u.useCopy(),m=e.ref([]),p=[{name:"全部",type:-1},{name:"生成中",type:1},{name:"生成成功",type:2},{name:"生成失败",type:3}],c=e.ref(!1),d=e.shallowRef(null),v=e.ref([]),f=e.ref(-1),h=e.reactive({show:!1,item:{}}),g=e.computed((()=>{const e=[{value:"delete",text:"删除",color:"#EA0000"}];return 2==h.item.status&&e.unshift({value:"download",text:"下载"}),e})),w=e=>{h.show=!0,h.item=e},j=e.ref(),q=async a=>{const u=g.value[a].value,t=h.item;switch(u){case"delete":(async a=>{const{cancel:u}=await e.index.showModal({title:"温馨提示",content:"确定删除？"});u||(await s.deleteMusic({id:a}),C())})(t.id);break;case"download":j.value=!0}},_=async()=>{await l(h.item.audio_url),j.value=!1},y=e.shallowRef(),k=async(e,a)=>{try{const{lists:u}=await s.getMusicLists({page_no:e,page_size:a,status:f.value});r.value.complete(u)}catch(u){r.value.complete(!1)}finally{setTimeout((()=>{clearTimeout(y.value),[-1,1].includes(f.value)&&m.value.some((e=>1===e.status))&&(y.value=setTimeout((()=>{C()}),6e3))}),100)}},C=()=>{var e;null==(e=r.value)||e.refresh()};return e.watch(f,(()=>{C()})),e.onUnmounted((()=>{clearTimeout(y.value)})),(s,u)=>e.e({a:s.$theme.navColor,b:s.$theme.navBgColor,c:s.$theme.pageStyle,d:e.f(p,((a,s,u)=>({a:e.t(a.name),b:a.type===f.value?1:"",c:e.o((e=>f.value=a.type),a.type),d:a.type}))),e:e.f(m.value,((s,u,t)=>e.e({a:"5df6aa96-1-"+t+",5df6aa96-0",b:e.p({src:s.image_url,width:"100%",height:"100%"}),c:e.t(s.duration)},e.unref(n).getSquareConfig.music_award.is_open?{d:"5df6aa96-2-"+t+",5df6aa96-0",e:e.p({name:"share"}),f:e.o((a=>(async(a,s)=>{v.value.includes(a)||s?await e.index.showModal({title:"温馨提示",content:"该音乐已分享过了！"}):(c.value=!0,await e.nextTick$1(),setTimeout((()=>d.value.open(a)),50))})(s.id,s.is_share)),s.id)}:{},{g:e.t(s.title),h:e.t(s.create_time),i:"5df6aa96-3-"+t+",5df6aa96-0",j:e.o((e=>w(s)),s.id),k:3==s.status||1==s.status},3==s.status||1==s.status?e.e({l:1==s.status},1==s.status?{m:"5df6aa96-4-"+t+",5df6aa96-0",n:e.p({size:50,mode:"flower"})}:{o:"5df6aa96-5-"+t+",5df6aa96-0",p:e.p({name:e.unref(a.music_fail),size:50}),q:e.t(s.create_time),r:"5df6aa96-6-"+t+",5df6aa96-0",s:e.p({name:"more-dot-fill",size:32}),t:e.o((e=>w(s)),s.id)}):{},{v:e.o((e=>{return a=s.id,void i.navigateTo({path:"/packages/pages/music_player/music_player",query:{id:a}});var a}),s.id),w:s.id}))),f:a._imports_0$4,g:e.unref(n).getSquareConfig.music_award.is_open,h:e.p({name:"more-dot-fill",size:32}),i:e.sr(r,"5df6aa96-0",{k:"pagingRef"}),j:e.o(k),k:e.o((e=>m.value=e)),l:e.p({"auto-clean-list-when-reload":!1,"safe-area-inset-bottom":!0,fixed:!0,modelValue:m.value}),m:e.o(q),n:e.o((e=>h.show=e)),o:e.p({"safe-area-inset-bottom":!0,list:e.unref(g),modelValue:h.show}),p:e.o(_),q:e.p({type:"primary",shape:"circle"}),r:e.o((e=>j.value=e)),s:e.p({mode:"center","border-radius":"15",closeable:!0,modelValue:j.value}),t:c.value},c.value?{v:e.sr(d,"5df6aa96-10",{k:"shareRef"}),w:e.o((e=>c.value=!1)),x:e.o((e=>v.value.push(e)))}:{})}});wx.createPage(i);
