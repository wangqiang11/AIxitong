"use strict";const e=require("../../../common/vendor.js"),o=require("../../../api/recharge.js"),r=require("../../../api/pay.js"),a=require("../../../enums/appEnums.js"),t=require("../../../hooks/useLockFn.js"),n=require("../../../stores/app.js");if(require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../stores/user.js"),require("../../../api/user.js"),require("../../../enums/constantEnums.js"),require("../../../utils/auth.js"),require("../../../utils/cache.js"),require("../../../utils/unique-id.js"),require("../../../router/index.js"),require("../../../config/index.js"),require("../../../utils/client.js"),require("../../../api/app.js"),require("../../../api/shop.js"),!Array){(e.resolveComponent("price")+e.resolveComponent("router-navigate")+e.resolveComponent("u-empty")+e.resolveComponent("u-icon")+e.resolveComponent("u-popup")+e.resolveComponent("page-status")+e.resolveComponent("tabbar"))()}Math||((()=>"../../../components/price/price.js")+(()=>"../../../node-modules/uniapp-router-next/components/router-navigate/router-navigate.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-empty/u-empty.js")+s+(()=>"../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js")+(()=>"../../../components/page-status/page-status.js")+(()=>"../../../components/tabbar/tabbar.js"))();const s=()=>"../../components/payment/payment.js",i=e.defineComponent({__name:"recharge",setup(s){const i=n.useAppStore(),u=e.ref(a.PageStatusEnum.LOADING),c=e.ref({lists:[]}),p=e.index.getSystemInfoSync(),l=e.ref({is_open:1,tips:"立即支付"}),m=e.ref(),d=e.reactive({orderId:"",from:"recharge",showPay:!1,orderAmount:"",showCheck:!1,showPaySuccess:!1}),{isLock:h,lockFn:g}=t.useLockFn((async()=>{e.index.showLoading({mask:!0,title:"请稍后..."});try{const e=await o.recharge({package_id:m.value});d.orderId=e.order_id,d.showPay=!0,d.orderAmount=e.order_amount}catch(r){}finally{e.index.hideLoading()}})),v=async()=>{d.showPay=!1,d.showPaySuccess=!0},f=async()=>{var e;c.value=await o.getRechargeConfig({page_type:0}),m.value=(null==(e=c.value.lists.find((e=>e.is_recommend)))?void 0:e.id)||""},y=async()=>{try{await Promise.all([f()]),u.value=a.PageStatusEnum.NORMAL}catch(e){u.value=a.PageStatusEnum.ERROR}};return e.onShow((async()=>{y(),-1!==p.system.indexOf("iOS")&&await(async()=>{try{l.value=await r.getIosPayConfig(),console.log(l.value),0==l.value.is_open&&e.index.showModal({title:"提示",content:l.value.tips,showCancel:!1,success:()=>e.index.navigateBack()})}catch(o){console.log("获取支付设置错误=>",o)}})()})),e.onLoad((e=>{((null==e?void 0:e.id)||e["amp;id"])&&(e.from||e["amp;from"])&&(d.orderId=(null==e?void 0:e.id)||e["amp;id"],d.from=e.from||e["amp;from"]),(null==e?void 0:e.checkPay)&&(d.showCheck=!0)})),e.onPullDownRefresh((async()=>{try{await y()}catch(o){}e.index.stopPullDownRefresh()})),(o,r)=>{var a,t;return e.e({a:o.$theme.navColor,b:o.$theme.navBgColor,c:o.$theme.pageStyle,d:l.value.is_open},l.value.is_open?e.e({e:e.unref(i).getSwitchConfig.recharge_status},e.unref(i).getSwitchConfig.recharge_status?{f:e.t(null==(a=c.value.extend)?void 0:a.balance),g:e.t(e.unref(i).getTokenUnit),h:e.t(null==(t=c.value.extend)?void 0:t.robot_num),i:e.f(c.value.lists,((o,r,a)=>e.e({a:o.tags},o.tags?{b:e.t(o.tags)}:{},{c:"11aaf855-1-"+a+",11aaf855-0",d:e.p({content:o.sell_price,color:"#000",fontWeight:"500",mainSize:"42rpx",minorSize:"32rpx"}),e:o.line_price>0},o.line_price>0?{f:"11aaf855-2-"+a+",11aaf855-0",g:e.p({color:"#999999",lineThrough:!0,content:o.line_price,mainSize:"28rpx",minorSize:"28rpx"})}:{},{h:e.t(o.name),i:e.t(o.chat_balance),j:e.t(o.robot_number),k:o.is_give},o.is_give?e.e({l:o.give_chat_balance},o.give_chat_balance?{m:e.t(o.give_chat_balance),n:e.t(e.unref(i).getTokenUnit),o:e.t(o.give_robot_number?"，":"")}:{},{p:o.give_robot_number},o.give_robot_number?{q:e.t(o.give_robot_number)}:{}):{},{r:o.id,s:o.id==m.value?1:"",t:e.o((e=>m.value=o.id),o.id)}))),j:e.t(e.unref(i).getTokenUnit),k:e.o(((...o)=>e.unref(g)&&e.unref(g)(...o))),l:e.p({to:"/packages/pages/agreement/agreement?type=payment"})}:{m:e.p({text:"功能未开启"})},{n:e.p({text:"加载出错～"}),o:e.o(v),p:e.o((e=>d.showPay=e)),q:e.o((e=>d.showCheck=e)),r:e.p({"order-id":d.orderId,from:d.from,redirect:"/mobile/packages/pages/recharge/recharge","order-amount":d.orderAmount,show:d.showPay,showCheck:d.showCheck}),s:e.p({name:"checkmark-circle-fill",size:"100"}),t:e.o((e=>d.showPaySuccess=!1)),v:e.p({to:"/pages/index/index","nav-type":"reLaunch"}),w:e.o((e=>d.showPaySuccess=e)),x:e.p({"safe-area-inset-bottom":!0,"mask-close-able":!1,"border-radius":"14","z-index":899,round:!0,mode:"center",width:"600",modelValue:d.showPaySuccess}),y:e.p({status:u.value})}):{})}}});wx.createPage(i);
