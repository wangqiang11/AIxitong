"use strict";const e=require("../../../common/vendor.js"),a=require("../../../stores/app.js"),o=require("../../../stores/user.js"),s=require("../../../hooks/useLockFn.js"),r=require("../../../api/draw.js"),t=require("./enum/index.js"),n=require("../../../utils/util.js");if(require("../../../api/app.js"),require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../router/index.js"),require("../../../utils/cache.js"),require("../../../enums/constantEnums.js"),require("../../../config/index.js"),require("../../../utils/client.js"),require("../../../enums/appEnums.js"),require("../../../api/shop.js"),require("../../../api/user.js"),require("../../../utils/auth.js"),require("../../../utils/unique-id.js"),!Array){(e.resolveComponent("u-empty")+e.resolveComponent("tabbar")+e.resolveComponent("u-icon")+e.resolveComponent("router-navigate")+e.resolveComponent("u-navbar")+e.resolveComponent("u-form")+e.resolveComponent("u-button"))()}Math||((()=>"../../../uni_modules/vk-uview-ui/components/u-empty/u-empty.js")+(()=>"../../../components/tabbar/tabbar.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../node-modules/uniapp-router-next/components/router-navigate/router-navigate.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+d+u+i+m+l+p+(()=>"../../../uni_modules/vk-uview-ui/components/u-form/u-form.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-button/u-button.js"))();const u=()=>"./components/prompt.js",i=()=>"./components/sd/sd-size.js",m=()=>"./components/sd/sd-model.js",l=()=>"./components/sd/sd-lora.js",p=()=>"./components/sd/sd-options.js",d=()=>"./components/uploader-picture.js",c=e.defineComponent({__name:"sd",setup(u){const i=e.useRouter(),m=e.useRoute(),l=e.shallowRef(),p=a.useAppStore(),d=o.useUserStore(),c=e.ref([{mode:t.DrawTypeEnum.TEXT,name:"文生图"},{mode:t.DrawTypeEnum.IMAGE,name:"图生图"}]),v=e.ref({draw_api:t.DrawModeEnum.SD,draw_type:t.DrawTypeEnum.TEXT,draw_model:"",draw_loras:"",denoising_strength:.75,size:"512x512",prompt:"",negative_prompt:"",action:"generate",image_mask:"",image_id:"",complex_params:{step:20,sampler_name:"Euler a",seed:-1,cfg_scale:7}}),g=e.reactive({model:{cate:[],list:[]},config:{},loras:[],samplers:[]}),w=async()=>{g.config=await r.getSdConfig({draw_api:t.DrawModeEnum.SD}),e.index.setNavigationBarTitle({title:g.config.diy_name})},_=async()=>r.getModelCategoryList().then((async e=>{const a=e.map((e=>({value:e.id,label:e.name})));g.model.cate=[{label:"全部",value:0},...a],await f()})),f=async(e=0)=>{const a=await r.getModelList({category_id:e});g.model.list=a},j=async()=>{g.samplers=await r.getSdSamplersList()},y=n.series(w,_,f,j),{lockFn:q,isLock:b}=s.useLockFn((async()=>{try{if(v.value.draw_type===t.DrawTypeEnum.IMAGE&&""===v.value.image_mask)return e.index.$u.toast("请上传参考图");if(console.log(v.value.prompt),""===v.value.prompt)return e.index.$u.toast("请输入提示词");if(""===v.value.draw_api)return e.index.$u.toast("请选择主要模型");"img2img"!==v.value.draw_type&&(v.value.image_mask=""),await r.drawing({...v.value}),v.value.prompt="",i.navigateTo("/packages/pages/draw_list/draw_list?model=sd")}catch(a){}}));return y(),e.onLoad((()=>{e.index.$on("drawRegenerate",(e=>{Object.assign(v.value,e)}));const a=m.query;try{const e=JSON.parse(a.data);Object.assign(v.value,e)}catch(o){}})),(a,o)=>e.e({a:a.$theme.navColor,b:a.$theme.navBgColor,c:a.$theme.pageStyle,d:!e.unref(p).config.switch.sd_status},e.unref(p).config.switch.sd_status?e.e({f:e.p({name:"clock",size:32}),g:e.p({to:"/packages/pages/draw_list/draw_list?model=sd"}),h:e.p({"back-text":"绘画工作台"}),i:e.f(c.value,((a,o,s)=>({a:e.t(a.name),b:a.mode,c:v.value.draw_type===a.mode?1:"",d:e.o((e=>v.value.draw_type=a.mode),a.mode)}))),j:v.value.draw_type===e.unref(t.DrawTypeEnum).IMAGE},v.value.draw_type===e.unref(t.DrawTypeEnum).IMAGE?{k:e.o((e=>v.value.image_mask=e)),l:e.p({modelValue:v.value.image_mask})}:{},{m:e.o((e=>v.value.prompt=e)),n:e.o((e=>v.value.negative_prompt=e)),o:e.p({model:e.unref(t.DrawModeEnum).SD,"is-negative":!0,example:g.example,typeEnum:e.unref(t.DrawTypeEnum),showTranslate:!!g.config.translate_switch,modelValue:v.value.prompt,negative:v.value.negative_prompt}),p:e.o((e=>v.value.size=e)),q:e.p({modelValue:v.value.size}),r:e.o((e=>f(e))),s:e.o((e=>v.value.draw_model=e)),t:e.p({"cate-list":g.model.cate,"model-list":g.model.list,modelValue:v.value.draw_model}),v:e.o((e=>v.value.draw_loras=e)),w:e.p({"model-list":g.model.list,"current-lora":v.value.draw_model,modelValue:v.value.draw_loras}),x:e.o((e=>v.value.complex_params=e)),y:e.p({samplers:g.samplers,modelValue:v.value.complex_params}),z:e.sr(l,"30986942-5",{k:"uFormRef"}),A:e.p({model:v.value,"label-position":"top","border-bottom":!1}),B:g.config.is_member},(g.config.is_member,{}),{C:0!=g.config.power&&!g.config.is_member&&e.unref(d).isLogin},0!=g.config.power&&!g.config.is_member&&e.unref(d).isLogin?{D:e.t(g.config.power||"--"),E:e.t(e.unref(p).getTokenUnit)}:{},{F:e.o(e.unref(q)),G:e.p({type:"primary",loading:e.unref(b)})}):{e:e.p({text:"绘画功能未开启",mode:"favor"})})}});wx.createPage(c);
