"use strict";const e=require("../../../common/vendor.js"),o=require("../../../stores/app.js"),n=require("../../../stores/user.js"),r=require("../../../hooks/useLockFn.js"),a=require("../../../api/draw.js"),s=require("./enum/index.js"),t=require("../../../utils/util.js");if(require("../../../api/app.js"),require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../router/index.js"),require("../../../utils/cache.js"),require("../../../enums/constantEnums.js"),require("../../../config/index.js"),require("../../../utils/client.js"),require("../../../enums/appEnums.js"),require("../../../api/shop.js"),require("../../../api/user.js"),require("../../../utils/auth.js"),require("../../../utils/unique-id.js"),!Array){(e.resolveComponent("u-empty")+e.resolveComponent("tabbar")+e.resolveComponent("u-icon")+e.resolveComponent("router-navigate")+e.resolveComponent("u-navbar")+e.resolveComponent("u-form")+e.resolveComponent("u-button"))()}Math||((()=>"../../../uni_modules/vk-uview-ui/components/u-empty/u-empty.js")+(()=>"../../../components/tabbar/tabbar.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../node-modules/uniapp-router-next/components/router-navigate/router-navigate.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+i+u+m+l+p+c+v+(()=>"../../../uni_modules/vk-uview-ui/components/u-form/u-form.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-button/u-button.js"))();const i=()=>"./components/prompt.js",u=()=>"./components/uploader-picture.js",m=()=>"./components/mj/mj-size.js",l=()=>"./components/mj/mj-model.js",p=()=>"./components/mj/mj-version.js",c=()=>"./components/mj/mj-styles.js",v=()=>"./components/mj/mj-options.js",d=e.defineComponent({__name:"mj",setup(i){const u=e.useRouter(),m=e.useRoute(),l=e.shallowRef(),p=o.useAppStore(),c=n.useUserStore(),v=e.ref({draw_api:s.DrawModeEnum.MJ,draw_type:s.DrawTypeEnum.TEXT,draw_model:"mj",size:"1:1",prompt:"",negative_prompt:"",action:"generate",image_mask:"",image_id:"",complex_params:{seed:"",iw:1,q:"1",s:100,c:0},style:"",version:"",origin_task_id:""}),d=e.reactive({config:{mj_version:{},mj_style:{},mj_quality:{}}}),j=async()=>{d.config=await a.getSdConfig({draw_api:s.DrawModeEnum.MJ}),e.index.setNavigationBarTitle({title:d.config.diy_name})},g=t.series(j),{lockFn:_,isLock:w}=r.useLockFn((async o=>{try{if(o&&(v.value.action=o),""===v.value.prompt)return e.index.$u.toast("请输入提示词");await a.drawing({...v.value}),v.value.prompt="",u.navigateTo({path:"/packages/pages/draw_list/draw_list",query:{model:s.DrawModeEnum.MJ}})}catch(n){}}));return g(),e.onLoad((()=>{e.index.$on("drawRegenerate",(e=>{Object.assign(v.value,e),"generate"!==e.action&&_(e.action)}));const o=m.query;try{const e=JSON.parse(o.data);Object.assign(v.value,e),"generate"!==e.action&&_(e.action)}catch(n){}})),(o,n)=>{var r,a;return e.e({a:o.$theme.navColor,b:o.$theme.navBgColor,c:o.$theme.pageStyle,d:!e.unref(p).config.switch.mj_status},e.unref(p).config.switch.mj_status?e.e({f:e.p({name:"clock",size:32}),g:e.p({to:{path:"/packages/pages/draw_list/draw_list",query:{model:e.unref(s.DrawModeEnum).MJ}}}),h:e.p({"back-text":"绘画工作台"}),i:e.o((e=>v.value.prompt=e)),j:e.o((e=>v.value.negative_prompt=e)),k:e.p({"is-negative":!0,model:e.unref(s.DrawModeEnum).MJ,example:d.example,typeEnum:e.unref(s.DrawTypeEnum),showTranslate:!!d.config.translate_switch,modelValue:v.value.prompt,negative:v.value.negative_prompt}),l:e.o((e=>v.value.image_mask=e)),m:e.p({modelValue:v.value.image_mask}),n:e.o((e=>v.value.size=e)),o:e.p({modelValue:v.value.size}),p:e.o((e=>v.value.draw_model=e)),q:e.p({modelValue:v.value.draw_model}),r:e.o((e=>v.value.version=e)),s:e.p({"draw-model":v.value.draw_model,versionList:null==(r=d.config)?void 0:r.mj_version[v.value.draw_model],modelValue:v.value.version}),t:5==v.value.version&&"niji"==v.value.draw_model},5==v.value.version&&"niji"==v.value.draw_model?{v:e.o((e=>v.value.style=e)),w:e.p({"styles-list":null==(a=d.config)?void 0:a.mj_style,modelValue:v.value.style})}:{},{x:e.o((e=>v.value.complex_params=e)),y:e.p({"q-list":d.config.mj_quality,modelValue:v.value.complex_params}),z:e.sr(l,"26afe28e-5",{k:"uFormRef"}),A:e.p({model:v.value,"label-position":"top","border-bottom":!1}),B:d.config.is_member},(d.config.is_member,{}),{C:0!=d.config.power&&!d.config.is_member&&e.unref(c).isLogin},0!=d.config.power&&!d.config.is_member&&e.unref(c).isLogin?{D:e.t(d.config.power||"--"),E:e.t(e.unref(p).getTokenUnit)}:{},{F:e.o((o=>e.unref(_)("generate"))),G:e.p({type:"primary",loading:e.unref(w)})}):{e:e.p({text:"绘画功能未开启",mode:"favor"})})}}});wx.createPage(d);
