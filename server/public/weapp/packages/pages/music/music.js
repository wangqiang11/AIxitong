"use strict";const e=require("../../../common/vendor.js"),o=require("../../../common/assets.js"),t=require("../../../api/music.js"),s=require("../../../stores/app.js"),i=require("../../../stores/user.js"),u=require("../../../hooks/useLockFn.js");if(require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../router/index.js"),require("../../../utils/cache.js"),require("../../../enums/constantEnums.js"),require("../../../config/index.js"),require("../../../utils/client.js"),require("../../../enums/appEnums.js"),require("../../../api/app.js"),require("../../../api/shop.js"),require("../../../api/user.js"),require("../../../utils/auth.js"),require("../../../utils/unique-id.js"),!Array){(e.resolveComponent("u-icon")+e.resolveComponent("router-navigate")+e.resolveComponent("u-navbar")+e.resolveComponent("u-input")+e.resolveComponent("u-form-item")+e.resolveComponent("u-loading")+e.resolveComponent("l-textarea")+e.resolveComponent("u-switch")+e.resolveComponent("u-image")+e.resolveComponent("u-form")+e.resolveComponent("u-button")+e.resolveComponent("u-empty")+e.resolveComponent("tabbar"))()}Math||((()=>"../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../node-modules/uniapp-router-next/components/router-navigate/router-navigate.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-form-item/u-form-item.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-loading/u-loading.js")+(()=>"../../../components/l-textarea/l-textarea.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-switch/u-switch.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-image/u-image.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-form/u-form.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-empty/u-empty.js")+(()=>"../../../components/tabbar/tabbar.js"))();const n=e.defineComponent({__name:"music",setup(n){const r=e.useRouter();e.useRoute();const l=e.shallowRef(),a=s.useAppStore(),m=i.useUserStore(),c=e.ref([{mode:0,name:"灵感模式",tips:"只需输入一段歌曲描述，即可生成一首歌"},{mode:1,name:"歌词模式",tips:"输入自己的歌词，即可生成一首歌"}]),p=e.reactive({channel:"go_api",custom_mode:0,title:"",prompt:"",style_id:[],is_style_custom:0,style_custom:"",make_instrumental:0,version:""}),d=e.computed((()=>0===p.custom_mode)),f=e.ref(8),v=e=>y.value.style.slice(f.value*e,f.value*(e+1)),_=e.computed((()=>Math.ceil(y.value.style.length/f.value))),g=()=>{m.isLogin||r.navigateTo("/pages/login/login")},h=()=>{p.is_style_custom=p.is_style_custom?0:1},b=(o,t)=>{e.index.showModal({title:o,content:t,showCancel:!1})},y=e.ref({model:{},style:[],imagine:{}}),j=e.computed((()=>!d.value&&y.value.imagine.status)),w=e.computed((()=>y.value.model[p.channel]||{})),{lockFn:k,isLock:q}=u.useLockFn((async()=>{if(!p.title)return e.index.$u.toast("请输入歌曲名称");const o=await t.postMusicImagine({prompt:p.title});p.prompt=o.content})),{lockFn:x,isLock:C}=u.useLockFn((async()=>{try{if(!p.title)return e.index.$u.toast("请输入歌曲名称");if(!p.prompt)return e.index.$u.toast("请输入"+(d.value?"歌曲描述":"歌词"));await t.postMusicGenerate({...p,style_id:p.is_style_custom?[]:p.style_id}),p.prompt="",p.title="",p.style_id=[],p.style_custom="",r.navigateTo("/packages/pages/music_list/music_list")}catch(o){}}));return e.onShow((()=>{(async()=>{y.value=await t.getMusicConfig(),p.channel=y.value.channel,p.version||(p.version=Object.keys(w.value.version)[0]||"")})()})),(t,s)=>e.e({a:t.$theme.navColor,b:t.$theme.navBgColor,c:t.$theme.pageStyle,d:e.unref(a).config.switch.music_status>0},e.unref(a).config.switch.music_status>0?e.e({e:e.p({name:"clock",size:32}),f:e.p({to:"/packages/pages/music_list/music_list"}),g:e.p({"back-text":"音乐"}),h:e.f(c.value,((o,t,s)=>({a:e.t(o.name),b:"756e7cfe-3-"+s,c:e.o((e=>b(o.name,o.tips)),o.mode),d:o.mode,e:p.custom_mode===o.mode?1:"",f:e.o((e=>p.custom_mode=o.mode),o.mode)}))),i:e.p({name:"error-circle",size:32}),j:e.o(g),k:e.o((e=>p.title=e)),l:e.p({"placeholder-style":"color: #9CA3AF;",height:80,placeholder:"给你的歌曲起个好听的名字",border:!0,modelValue:p.title}),m:e.p({label:"歌曲名称",prop:"title",required:!0}),n:!e.unref(d)},e.unref(d)?{}:{o:e.p({name:"error-circle",size:32}),p:e.o((e=>b("温馨提示","建议歌词长度100-1250，太长或太短容易生成失败")))},{q:e.p({name:"trash"}),r:e.o((e=>p.prompt="")),s:e.p({label:e.unref(d)?"歌曲描述":"歌词","label-position":"left",required:!0,"label-width":e.unref(d)?250:70}),t:e.unref(j)},e.unref(j)?e.e({v:e.unref(q)},e.unref(q)?{w:e.p({mode:"flower",color:t.$theme.primaryColor,size:"24"})}:{x:o._imports_0$3},{y:y.value.imagine.price>0},y.value.imagine.price>0?{z:e.t(y.value.imagine.price),A:e.t(e.unref(a).getTokenUnit)}:{},{B:e.o(((...o)=>e.unref(k)&&e.unref(k)(...o)))}):{},{C:e.o(g),D:e.o((e=>p.prompt=e)),E:e.p({maxlength:"1300",rows:4,"show-word-limit":!0,"custom-class":{background:"#fff",paddingBottom:"70rpx",fontSize:"28rpx"},placeholder:"请输入"+(e.unref(d)?"灵感，例如写一首关于夏天的歌曲":"歌词"),modelValue:p.prompt}),F:e.f(e.unref(w).version,((o,t,s)=>({a:e.t(o),b:o,c:p.version===String(t)?1:"",d:e.o((e=>p.version=String(t)),o)}))),G:e.p({prop:"version",label:"选择版本",required:!0}),H:e.unref(d)},e.unref(d)?{I:e.o((e=>p.make_instrumental=e)),J:e.p({modelValue:p.make_instrumental}),K:e.p({label:"纯音乐","label-position":"left","label-width":"150"})}:{},{L:!e.unref(d)},e.unref(d)?{}:e.e({M:e.t(p.is_style_custom?"系统风格":"自定义风格"),N:e.o(h),O:e.p({label:"音乐风格","label-position":"left","label-width":"200"}),P:!p.is_style_custom},p.is_style_custom?{T:e.o((e=>p.style_custom=e)),U:e.p({maxlength:"1024",rows:4,"show-word-limit":!1,"custom-class":{background:"#fff",paddingBottom:"70rpx",fontSize:"28rpx"},placeholder:"请输入自定义风格，多个风格以,隔开",modelValue:p.style_custom})}:{Q:e.f(e.unref(_),((o,t,s)=>({a:e.f(v(t),((o,t,i)=>e.e({a:"756e7cfe-18-"+s+"-"+i+",756e7cfe-17",b:e.p({src:o.image,width:"100%",height:"100%"}),c:p.style_id.includes(o.id)},p.style_id.includes(o.id)?{d:"756e7cfe-19-"+s+"-"+i+",756e7cfe-17",e:e.p({name:"checkmark-circle-fill",size:40})}:{},{f:e.t(o.name),g:e.o((e=>(e=>{const o=p.style_id.findIndex((o=>o===e));-1!==o?p.style_id.splice(o,1):p.style_id.push(e)})(o.id)),o.id),h:o.id}))),b:t}))),R:e.unref(_)>1,S:t.$theme.primaryColor}),{V:e.sr(l,"756e7cfe-4",{k:"uFormRef"}),W:e.p({model:p,"label-position":"top","border-bottom":!1}),X:y.value.is_member},y.value.is_member?{}:e.unref(w).price>0?{Z:e.t(e.unref(w).price),aa:e.t(e.unref(a).getTokenUnit)}:{},{Y:e.unref(w).price>0,ab:e.o(e.unref(x)),ac:e.p({type:"primary",loading:e.unref(C)})}):{ad:e.p({text:"功能未开启",mode:"list"})})}});wx.createPage(n);
