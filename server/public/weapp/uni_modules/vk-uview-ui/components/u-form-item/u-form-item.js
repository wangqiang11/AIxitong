"use strict";const t=require("../../libs/util/emitter.js"),e=require("../../libs/util/async-validator.js"),i=require("../../../../common/vendor.js");e.Schema.warning=function(){};const l={name:"u-form-item",mixins:[t.Emitter],inject:{uForm:{default:()=>null}},props:{label:{type:String,default:""},prop:{type:String,default:""},customStyle:{type:Object,default:()=>({})},borderBottom:{type:[String,Boolean],default:""},labelPosition:{type:String,default:""},labelWidth:{type:[String,Number],default:""},labelStyle:{type:Object,default:()=>({})},labelAlign:{type:String,default:""},rightIcon:{type:String,default:""},leftIcon:{type:String,default:""},leftIconStyle:{type:Object,default:()=>({})},rightIconStyle:{type:Object,default:()=>({})},required:{type:Boolean,default:!1},inputAlign:{type:String,default:""}},data:()=>({initialValue:"",validateState:"",validateMessage:"",errorType:["message"],fieldValue:"",parentData:{borderBottom:!0,labelWidth:90,labelPosition:"left",labelStyle:{},labelAlign:"left",inputAlign:"left"}}),watch:{validateState(t){this.broadcastInputError()},"uForm.errorType"(t){this.errorType=t,this.broadcastInputError()}},computed:{uLabelWidth(){return"left"==this.elLabelPosition?"true"===this.label||""===this.label?"auto":this.$u.addUnit(this.elLabelWidth):"100%"},showError(){return t=>!(this.errorType.indexOf("none")>=0)&&this.errorType.indexOf(t)>=0},elLabelWidth(){return 0!=this.labelWidth||""!=this.labelWidth?this.labelWidth:this.parentData.labelWidth?this.parentData.labelWidth:90},elLabelStyle(){return Object.keys(this.labelStyle).length?this.labelStyle:this.parentData.labelStyle?this.parentData.labelStyle:{}},elLabelPosition(){return this.labelPosition?this.labelPosition:this.parentData.labelPosition?this.parentData.labelPosition:"left"},elLabelAlign(){return this.labelAlign?this.labelAlign:this.parentData.labelAlign?this.parentData.labelAlign:"left"},elBorderBottom(){return""!==this.borderBottom?this.borderBottom:!!this.parentData.borderBottom&&this.parentData.borderBottom},elInputAlign(){return this.inputAlign?this.inputAlign:this.parentData.inputAlign?this.parentData.inputAlign:"left"}},methods:{broadcastInputError(){this.broadcast("u-input","onFormItemError","error"===this.validateState&&this.showError("border"))},setRules(){},getRules(){let t=this.parent.rules;return t=t?t[this.prop]:[],[].concat(t||[])},onFieldBlur(){this.validation("blur")},onFieldChange(){this.validation("change")},getFilteredRule(t=""){let e=this.getRules();return t?e.filter((e=>e.trigger&&-1!==e.trigger.indexOf(t))):e},getData(t,e,i){let l;if(t){l=JSON.parse(JSON.stringify(t));let i="",a=".",r="[",s="]";e=e.replace(/\s+/g,i)+a;let n=i;for(let t=0;t<e.length;t++){let o=e.charAt(t);o!=a&&o!=r&&o!=s?n+=o:l&&(n!=i&&(l=l[n]),n=i)}}return void 0===l&&void 0!==i&&(l=i),l},setData(t,e,i){let l;l="object"==typeof i?JSON.parse(JSON.stringify(i)):i;let a=new RegExp("([\\w$]+)|\\[(:\\d)\\]","g");const r=e.match(a);for(let s=0;s<r.length-1;s++){let e=r[s];"object"!=typeof t[e]&&(t[e]={}),t=t[e]}t[r[r.length-1]]=l},validation(t,i=()=>{}){this.fieldValue=this.getData(this.parent.model,this.prop);let l=this.getFilteredRule(t);if(!l||0===l.length)return i("");this.validateState="validating",new e.Schema({[this.prop]:l}).validate({[this.prop]:this.fieldValue},{firstFields:!0},((t,e)=>{this.validateState=t?"error":"success",this.validateMessage=t?t[0].message:"";let l=t?t[0].field:"";i(this.validateMessage,{state:this.validateState,key:l,msg:this.validateMessage})}))},resetField(){this.setData(this.parent.model,this.prop,this.initialValue),this.validateState="success"}},mounted(){this.parent=this.$u.$parent.call(this,"u-form"),this.parent&&(Object.keys(this.parentData).map((t=>{this.parentData[t]=this.parent[t]})),this.prop&&(this.parent.fields.push(this),this.errorType=this.parent.errorType,this.initialValue=this.fieldValue,this.$nextTick((()=>{this.setRules()}))))},beforeUnmount(){this.parent&&this.prop&&this.parent.fields.map(((t,e)=>{t===this&&this.parent.fields.splice(e,1)}))}};if(!Array){i.resolveComponent("u-icon")()}Math;const a=i._export_sfc(l,[["render",function(t,e,l,a,r,s){return i.e({a:l.required||l.leftIcon||l.label},l.required||l.leftIcon||l.label?i.e({b:l.required},(l.required,{}),{c:l.leftIcon},l.leftIcon?{d:i.p({name:l.leftIcon,"custom-style":l.leftIconStyle})}:{},{e:i.t(l.label),f:i.s(s.elLabelStyle),g:i.s({"justify-content":"left"==s.elLabelAlign?"flex-start":"center"==s.elLabelAlign?"center":"flex-end"})}):{},{h:s.uLabelWidth,i:`0 0 ${s.uLabelWidth}`,j:"left"==s.elLabelPosition?0:"10rpx",k:i.s("left"==s.elLabelPosition&&"right"==s.elInputAlign?"text-align:right;display: inline-block;line-height:initial;":""),l:t.$slots.right||l.rightIcon},t.$slots.right||l.rightIcon?i.e({m:l.rightIcon},l.rightIcon?{n:i.p({"custom-style":l.rightIconStyle,name:l.rightIcon})}:{}):{},{o:"left"==s.elLabelPosition?"row":"column",p:"error"===r.validateState&&s.showError("message")},"error"===r.validateState&&s.showError("message")?{q:i.t(r.validateMessage),r:"left"==s.elLabelPosition?t.$u.addUnit(s.elLabelWidth):"0",s:"right"==s.elInputAlign?"right":"left"}:{},{t:i.s(l.customStyle),v:s.elBorderBottom?1:"",w:"error"===r.validateState&&s.showError("border-bottom")?1:""})}],["__scopeId","data-v-cdceb1c8"]]);wx.createComponent(a);
