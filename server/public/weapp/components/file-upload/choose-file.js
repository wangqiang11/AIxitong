"use strict";const e=require("../../common/vendor.js"),t="chooseFile:fail";function s(e,t){return e.tempFiles.forEach((e=>{e.name||(e.name=e.path.substring(e.path.lastIndexOf("/")+1)),t&&(e.fileType=t)})),e.tempFilePaths||(e.tempFilePaths=e.tempFiles.map((e=>e.path))),e}const i=e=>{const t=e.lastIndexOf("."),s=e.length;return{name:e.substring(0,t),ext:e.substring(t+1,s)}};exports.chooseFile=function(i={type:"file"}){return"image"===i.type?function(i){const{count:n,sizeType:o=["original","compressed"],sourceType:r,extension:a}=i;return new Promise(((i,l)=>{e.index.chooseImage({count:n,sizeType:o,sourceType:r,extension:a,success(e){i(s(e,"image"))},fail(e){l({errMsg:e.errMsg.replace("chooseImage:fail",t)})}})}))}(i):"video"===i.type?function(i){const{camera:n,compressed:o,maxDuration:r,sourceType:a,extension:l}=i;return new Promise(((i,p)=>{e.index.chooseVideo({camera:n,compressed:o,maxDuration:r,sourceType:a,extension:l,success(e){const{tempFilePath:t,duration:n,size:o,height:r,width:a}=e;i(s({errMsg:"chooseVideo:ok",tempFilePaths:[t],tempFiles:[{name:e.tempFile&&e.tempFile.name||"",path:t,size:o,type:e.tempFile&&e.tempFile.type||"",width:a,height:r,duration:n,fileType:"video"}]},"video"))},fail(e){p({errMsg:e.errMsg.replace("chooseVideo:fail",t)})}})}))}(i):function(i){const{count:n,extension:o}=i;return new Promise(((i,r)=>{let a=e.index.chooseFile;if(void 0!==e.wx$1&&"function"==typeof e.wx$1.chooseMessageFile&&(a=e.wx$1.chooseMessageFile),"function"!=typeof a)return r({errMsg:t+" 请指定 type 类型，该平台仅支持选择 image 或 video。"});a({type:"all",count:n,extension:o,success(e){i(s(e))},fail(e){r({errMsg:e.errMsg.replace("chooseFile:fail",t)})}})}))}(i)},exports.getFileName=e=>{const t=e.lastIndexOf("."),s=e.lastIndexOf("/");return-1===t?e:e.substring(s+1)},exports.getFilesByExtname=(t,s=[])=>{const n=[],o=[];return s.length?(t.tempFiles.forEach((e=>{const t=i(e.name).ext.toLowerCase();-1!==s.indexOf(t)&&(o.push(e),n.push(e.path))})),o.length!==t.tempFiles.length&&e.index.showToast({title:`当前选择了${t.tempFiles.length}个文件 ，${t.tempFiles.length-o.length} 个文件格式不正确`,icon:"none",duration:5e3}),{filePaths:n,files:o}):{filePaths:t.tempFilePaths,files:t.tempFiles}},exports.normalizeFileData=e=>{const t=i(e.name).ext.toLowerCase();return{name:e.name,uuid:e.uuid,extname:t||"",fileType:e.fileType,path:e.path,url:e.path,size:e.size,progress:0,status:"ready",errMsg:""}};
