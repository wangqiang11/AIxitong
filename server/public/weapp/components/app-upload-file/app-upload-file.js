"use strict";const e=require("../../common/vendor.js"),i=require("../../api/app.js");if(require("../../utils/request/index.js"),require("../../utils/request/http.js"),require("../../enums/requestEnums.js"),require("../../utils/request/cancel.js"),require("../../stores/user.js"),require("../../api/user.js"),require("../../enums/constantEnums.js"),require("../../utils/auth.js"),require("../../utils/cache.js"),require("../../utils/unique-id.js"),require("../../router/index.js"),require("../../config/index.js"),require("../../utils/client.js"),require("../../enums/appEnums.js"),!Array){e.resolveComponent("uni-file-picker")()}Math;const a=e.defineComponent({__name:"app-upload-file",props:{modelValue:{default:()=>[]},fileExtname:{default:()=>[]},data:{default:()=>({})},header:{default:()=>({})},limit:{default:9},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(a,{emit:l}){const s=a,t=e.shallowRef(),u=e.ref([]),r=e.ref(!0),n=async i=>{e.index.showLoading({title:"正在上传中。。。"}),r.value=!1;const{tempFilePaths:a}=i,l=a.map((async e=>{await o(e)}));await Promise.all(l),e.index.hideLoading(),r.value=!0},d=async i=>{var a,l;e.index.showLoading({title:"正在上传中，请稍后。。。"}),r.value=!1;const[{item:s}]=i,u=null==s?void 0:s.path,n=null==(l=null==(a=t.value)?void 0:a.filesList)?void 0:l.find((e=>e.path==u));n.progress=0,n.status="ready",await o(u),e.index.hideLoading(),r.value=!0},o=async e=>{var a,u;const r=null==(u=null==(a=t.value)?void 0:a.filesList)?void 0:u.find((i=>i.path==e));try{const{uri:a,name:t}=await i.uploadFile({filePath:e,formData:s.data,header:s.header},(e=>{r&&(r.progress=e)}));r.status="success",r.url=a,l("update:modelValue",[...s.modelValue.slice(),{url:a,name:t}])}catch(n){r&&(r.progress=0,r.status="error")}},m=e=>{r.value=!1;const{tempFilePath:i}=e,a=s.modelValue.findIndex((e=>e.url==i));if(a>-1){const e=s.modelValue.slice();e.splice(a,1),l("update:modelValue",e)}setTimeout((()=>{r.value=!0}))};return e.watch((()=>s.modelValue),(e=>{r.value&&(u.value=e)}),{immediate:!0}),(i,l)=>({a:e.sr(t,"81cbe73a-0",{k:"filePickerRef"}),b:e.o(d),c:e.o(n),d:e.o(m),e:e.o((e=>u.value=e)),f:e.p({limit:a.limit,"file-mediatype":"all",mode:"list","del-icon":!0,"list-styles":{display:"none"},fileExtname:a.fileExtname,disabled:a.disabled,modelValue:u.value})})}});wx.createComponent(a);
