"use strict";const e=require("../../../../common/vendor.js"),a=require("../../../../api/robot.js"),i=require("../../../../stores/user.js"),u=require("../../../../stores/app.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../router/index.js"),require("../../../../utils/cache.js"),require("../../../../enums/constantEnums.js"),require("../../../../config/index.js"),require("../../../../utils/client.js"),require("../../../../enums/appEnums.js"),require("../../../../api/user.js"),require("../../../../utils/auth.js"),require("../../../../utils/unique-id.js"),require("../../../../api/app.js"),require("../../../../api/shop.js"),!Array){(e.resolveComponent("u-search")+e.resolveComponent("u-tag")+e.resolveComponent("u-icon")+e.resolveComponent("u-image")+e.resolveComponent("z-paging")+e.resolveComponent("u-action-sheet"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-search/u-search.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-tag/u-tag.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-image/u-image.js")+(()=>"../../../../node-modules/z-paging/components/z-paging/z-paging.js")+s+t+(()=>"../../../../uni_modules/vk-uview-ui/components/u-action-sheet/u-action-sheet.js")+o)();const s=()=>"../add-btn.js",t=()=>"./add-popup.js",o=()=>"./share-popup.js",r=e.defineComponent({__name:"index",props:{tabIndex:null,currentIndex:null},setup(s,{expose:t}){var o;const r=s,n=i.useUserStore(),l=u.useAppStore(),c=e.ref([]),d=e.shallowRef(),p=e.ref(!1),v=e.ref(!1),h=e.ref(!1),m=e.ref(""),g=e.reactive({show:!1,currentId:-1,isShare:-1,isPublic:-1}),f=e.shallowRef([{value:"begin",text:"开始对话"},{value:"release",text:"发布智能体"},{value:"dialogue",text:"对话数据"},{value:"share",text:"分享至广场",show:!(null==(o=l.getSquareConfig.robot_award)?void 0:o.is_open)},{value:"delete",text:"删除"}]),w=e.ref(!1),j=e.shallowRef(null),x=e.ref([]),q=e=>{x.value.push(e),C()},b=async i=>{const u=f.value[i].value,s=g.currentId;switch(u){case"delete":(async i=>{const{cancel:u}=await e.index.showModal({title:"温馨提示",content:"确定删除？"});if(u)return;await a.delRobot({id:i});const s=c.value.findIndex((e=>e.id==i));c.value.splice(s,1)})(s);break;case"dialogue":case"release":k(s,u);break;case"share":g.isPublic?await a.cancelShare({id:s}):(async(a,i)=>{if((x.value.includes(a)||i)&&(await e.index.showModal({title:"温馨提示",content:"该智能体已分享过，是否确认重复分享？"})).cancel)return;w.value=!0,await e.nextTick$1(),setTimeout((()=>j.value.open(a)),50)})(s,g.isShare),C();break;case"begin":_.navigateTo({path:"/packages/pages/robot_chat/robot_chat",query:{id:s}})}},_=e.useRouter(),k=(e,a)=>{_.navigateTo({path:"/packages/pages/robot_info/robot_info",query:{id:e,type:a||null}})},y=async()=>{if(!n.isLogin)return _.navigateTo("/pages/login/login");if(n.userInfo.robot_num<=0){if(l.getIsShowRecharge){const{cancel:a}=await e.index.showModal({title:"温馨提示",content:"智能体数量已用完，请前往充值"});if(a)return;_.navigateTo({path:"/packages/pages/recharge/recharge"})}else e.index.$u.toast("智能体数量已用完。请联系客服增加");return Promise.reject()}h.value=!0},I=async(e,i)=>{var u,s;try{const{lists:s=[]}=await a.getRobotLists({page_size:i,page_no:e,keyword:m.value});null==(u=d.value)||u.complete(s)}catch(t){null==(s=d.value)||s.complete(!1)}},C=()=>{e.nextTick$1((()=>{d.value&&d.value.refresh()}))};return e.watch((()=>r.currentIndex),(a=>{a===r.tabIndex&&(p.value||e.nextTick$1((()=>{setTimeout((()=>{v.value=!0}),100)})))}),{immediate:!0}),t({reload:C}),(a,i)=>e.e({a:p.value||v.value},p.value||v.value?{b:e.o((a=>e.unref(d).reload())),c:e.o((a=>e.unref(d).reload())),d:e.o((a=>e.unref(d).reload())),e:e.o((e=>m.value=e)),f:e.p({placeholder:"请输入关键词搜索",height:"72","bg-color":"#F7F8F9",modelValue:m.value}),g:e.f(c.value,((a,i,u)=>e.e({a:a.is_public},a.is_public?{b:"9c3d3604-2-"+u+",9c3d3604-0",c:e.p({type:"warning",text:"公开",size:"mini"})}:{d:"9c3d3604-3-"+u+",9c3d3604-0",e:e.p({type:"primary",text:"私有",size:"mini"})},{f:"9c3d3604-4-"+u+",9c3d3604-0",g:e.o((e=>(e=>{g.show=!0,g.currentId=e.id,g.isPublic=e.is_public,g.isShare=e.is_share,e.is_public?f.value[3].text="取消发布广场":f.value[3].text="分享至广场"})(a)),a.id),h:e.o((()=>{}),a.id),i:"9c3d3604-5-"+u+",9c3d3604-0",j:e.p({src:a.image,width:"100",height:"100",shape:"circle"}),k:e.t(a.name),l:e.t(a.intro||"这个智能体还没介绍呢"),m:e.o((e=>k(a.id)),a.id),n:a.id}))),h:e.p({name:"more-dot-fill"}),i:e.sr(d,"9c3d3604-0",{k:"pagingRef"}),j:e.o(I),k:e.o((e=>c.value=e)),l:e.p({"auto-clean-list-when-reload":!1,fixed:!1,modelValue:c.value})}:{},{m:e.o(y),n:e.o((a=>e.unref(d).reload())),o:e.o((e=>h.value=e)),p:e.p({modelValue:h.value}),q:e.o(b),r:e.o((e=>g.show=e)),s:e.p({list:e.unref(f),modelValue:g.show}),t:w.value},w.value?{v:e.sr(j,"9c3d3604-9",{k:"shareRef"}),w:e.o((e=>w.value=!1)),x:e.o(q)}:{})}});wx.createComponent(r);
