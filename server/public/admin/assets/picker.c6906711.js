import{P as B}from"./index.c487cb65.js";import{E as R}from"./element-plus.6d5d7657.js";import{_ as D}from"./index.ec37127a.js";import{u as M,b as j}from"./index.fc6caf68.js";import{_ as G}from"./index.410c53ff.js";import{D as K}from"./vuedraggable.0170ba82.js";import{_ as O,a as Q}from"./preview.vue_vue_type_script_setup_true_lang.6702fed0.js";import{d as Y,r as i,a2 as Z,b as U,w as q,B as $,n as H,a3 as k,o as J,c as W,T as u,a8 as X,K as m,a as n,Y as P,M as I,Q as x,L as ee,G as ae,Z as le,U as te,bk as oe,bj as se}from"./@vue.7946e41b.js";import{f as ie}from"./@vueuse.927bd09a.js";import{_ as ne}from"./vue-drag-resize.1871ee6b.js";const ue=Y({components:{Popup:B,Draggable:K,FileItem:O,Material:D,Preview:Q},props:{modelValue:{type:[String,Array],default:()=>[]},type:{type:String,default:"image"},size:{type:String,default:"100px"},fileSize:{type:String,default:"100px"},limit:{type:Number,default:1},disabled:{type:Boolean,default:!1},hiddenUpload:{type:Boolean,default:!1},uploadClass:{type:String,default:""},excludeDomain:{type:Boolean,default:!1},withName:{type:Boolean,default:!1},data:{type:Object,default:()=>({})}},emits:["change","update:modelValue"],setup(e,{emit:t}){const _=i(),g=i(),w=i(""),y=i(!1),l=i([]),d=i([]),r=i(!0),c=i(-1),{disabled:C,limit:p,modelValue:b}=Z(e),{getImageUrl:f}=M(),o=U(()=>{switch(e.type){case"image":return"\u56FE\u7247";case"video":return"\u89C6\u9891";case"audio":return"\u97F3\u4E50";default:return""}}),v=U(()=>e.limit-l.value.length>0),h=U(()=>r.value?p.value==-1?null:p.value-l.value.length:1),S=i([]),L=ie(()=>{const a=d.value.map(s=>e.excludeDomain?s.url:s.uri);S.value=d.value.map(s=>({uri:e.excludeDomain?s.url:s.uri,name:s.name})),r.value?l.value=[...l.value,...a]:l.value.splice(c.value,1,a.shift()),z()},1e3,!1),N=a=>{var s;C.value||(a>=0?(r.value=!1,c.value=a):r.value=!0,(s=_.value)==null||s.open())},A=a=>{d.value=a},z=()=>{const a=p.value!=1?l.value:l.value[0]||"";t("update:modelValue",a),e.withName?t("change",S.value):t("change",a),V()},F=a=>{l.value.splice(a,1),S.value.splice(a,1),z()},T=a=>{w.value=e.excludeDomain?f(a):a,y.value=!0},V=()=>{H(()=>{var a;e.hiddenUpload&&(l.value=[]),(a=g.value)==null||a.clearSelect()})};return q(b,a=>{l.value=Array.isArray(a)?a:a==""?[]:[a]},{immediate:!0}),$("limit",e.limit),$("hiddenUpload",e.hiddenUpload),{popupRef:_,materialRef:g,fileList:l,tipsText:o,handleConfirm:L,meterialLimit:h,showUpload:v,showPopup:N,selectChange:A,deleteImg:F,previewUrl:w,showPreview:y,handlePreview:T,handleClose:V,getImageUrl:f}}});const E=e=>(oe("data-v-8faf5bf2"),e=e(),se(),e),re={class:"material-select"},de=["onClick"],pe={class:"operation-btns text-xs text-center"},me=E(()=>n("span",null,"\u4FEE\u6539",-1)),ce=["onClick"],fe=E(()=>n("span",null,"\u6DFB\u52A0",-1)),ve={class:"material-wrap"};function he(e,t,_,g,w,y){const l=k("file-item"),d=G,r=k("draggable"),c=j,C=D,p=R,b=B,f=k("preview");return J(),W("div",re,[u(b,{ref:"popupRef",width:"830px","custom-class":"body-padding",title:`\u9009\u62E9${e.tipsText}`,"destroy-on-close":!0,onConfirm:e.handleConfirm,onClose:e.handleClose},X({default:m(()=>[u(p,null,{default:m(()=>[n("div",ve,[u(C,{ref:"materialRef",type:e.type,"file-size":e.fileSize,limit:e.meterialLimit,data:e.data,onChange:e.selectChange},null,8,["type","file-size","limit","data","onChange"])])]),_:1})]),_:2},[e.hiddenUpload?void 0:{name:"trigger",fn:m(()=>[n("div",{class:"material-select__trigger clearfix",onClick:t[2]||(t[2]=P(()=>{},["stop"]))},[u(r,{class:"draggable",modelValue:e.fileList,"onUpdate:modelValue":t[0]||(t[0]=o=>e.fileList=o),animation:"300","item-key":"id"},{item:m(({element:o,index:v})=>[n("div",{class:I(["material-preview",{"is-disabled":e.disabled,"is-one":e.limit==1}]),onClick:h=>e.showPopup(v)},[u(d,{onClose:h=>e.deleteImg(v)},{default:m(()=>[u(l,{uri:e.excludeDomain?e.getImageUrl(o):o,"file-size":e.size,type:e.type},null,8,["uri","file-size","type"])]),_:2},1032,["onClose"]),n("div",pe,[me,x(" | "),n("span",{onClick:P(h=>e.handlePreview(o),["stop"])},"\u67E5\u770B",8,ce)])],10,de)]),_:1},8,["modelValue"]),ee(n("div",{class:I(["material-upload",{"is-disabled":e.disabled,"is-one":e.limit==1,[e.uploadClass]:!0}]),onClick:t[1]||(t[1]=o=>e.showPopup(-1))},[ae(e.$slots,"upload",{},()=>[n("div",{class:"upload-btn",style:le({width:e.size,height:e.size})},[u(c,{size:25,name:"el-icon-Plus"}),fe],4)],!0)],2),[[te,e.showUpload]])])]),key:"0"}]),1032,["title","onConfirm","onClose"]),u(f,{modelValue:e.showPreview,"onUpdate:modelValue":t[3]||(t[3]=o=>e.showPreview=o),url:e.previewUrl,type:e.type},null,8,["modelValue","url","type"])])}const $e=ne(ue,[["render",he],["__scopeId","data-v-8faf5bf2"]]);export{$e as _};
