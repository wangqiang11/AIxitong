import{K as R,I as U,J as M,C as T,t as I,w as N,L as $,D as J,F as K}from"./element-plus.6d5d7657.js";import{f as L,b as O}from"./index.fc6caf68.js";import{f as j}from"./model.7491be3a.js";import{h as q}from"./@vueuse.927bd09a.js";import{S as z}from"./sortablejs.65032496.js";import{k as Q}from"./lodash-es.0dcbbec0.js";import{d as G,s as H,b as P,i as W,n as X,o as r,c as v,T as e,K as t,u as m,a as B,Q as _,R as Y,S as Z,a6 as ee,J as le}from"./@vue.7946e41b.js";const ae={class:"move-icon cursor-move"},oe=B("div",{class:"flex items-center"},"1000\u5B57\u7B26\u6D88\u8017\u7535\u529B\u503C",-1),re=G({__name:"model-lists",props:{data:{},models:{}},emits:["update:data"],setup(F,{emit:C}){const p=F,A=C,{data:d}=q(p,A),f=H(),D=()=>{const n=f.value.$el.querySelector(".el-table__body tbody");z.create(n,{animation:150,handle:".move-icon",onEnd:({newIndex:u,oldIndex:s})=>{console.log(u,s);const a=d.value,i=a.splice(s,1)[0];a.splice(u,0,i),d.value=a}})},c=P(()=>{const n=Object.values(Q(p.models))||[];return n.forEach(u=>{d.value.findIndex(a=>a.name===u.model)!==-1&&(u.disabled=!0)}),n}),V=(n,u)=>{const s=c.value.find(a=>a.model===n);u.channel=s.channel,u.name=s.model,u.alias=s.name},k=()=>{const n=c.value.find(u=>!u.disabled);console.log(c),n&&d.value.push({channel:n.channel,name:n.model,alias:n.name,price:"",status:0})},g=async(n,u)=>{if((await j({model:n.name})).use_count>0)return L.msgError("\u8BE5\u6A21\u578B\u5DF2\u88AB\u524D\u53F0\u7528\u6237\u4F7F\u7528\uFF0C\u65E0\u6CD5\u5220\u9664");d.value.splice(u,1)};return W(async()=>{X(()=>{D()})}),(n,u)=>{const s=O,a=R,i=U,y=M,h=T,w=I,b=N,x=$,E=J,S=K;return r(),v("div",null,[e(S,{"label-width":"120px",ref:"formRef"},{default:t(()=>[e(E,{label:"\u6A21\u578B\u8BBE\u7F6E"},{default:t(()=>[e(x,{ref_key:"tableRef",ref:f,size:"large","row-key":"name",data:m(d)},{default:t(()=>[e(a,{width:"50"},{default:t(()=>[B("div",ae,[e(s,{name:"el-icon-Rank"})])]),_:1}),e(a,{label:"\u5E8F\u53F7",width:"60"},{default:t(({$index:l})=>[_(Y(l+1),1)]),_:1}),e(a,{label:"\u6A21\u578B\u540D\u79F0",prop:"name","min-width":"200"},{default:t(({row:l})=>[e(y,{class:"w-full","model-value":l.name,filterable:"",onChange:o=>V(o,l)},{default:t(()=>[(r(!0),v(Z,null,ee(m(c),o=>(r(),le(i,{value:o.model,label:o.name,key:o.model,disabled:o.disabled&&o.model!==l.name},null,8,["value","label","disabled"]))),128))]),_:2},1032,["model-value","onChange"])]),_:1}),e(a,{label:"\u522B\u540D",prop:"alias","min-width":"180"},{default:t(({row:l})=>[e(h,{modelValue:l.alias,"onUpdate:modelValue":o=>l.alias=o,placeholder:"\u4E3A\u7A7A\u65F6\u663E\u793A\u9ED8\u8BA4\u540D\u5B57"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(a,{prop:"price","min-width":"160"},{header:t(()=>[oe]),default:t(({row:l})=>[e(h,{modelValue:l.price,"onUpdate:modelValue":o=>l.price=o,placeholder:"\u4E3A\u7A7A\u9ED8\u8BA4\u4E3A0\uFF0C\u652F\u63013\u4F4D\u5C0F\u6570\u70B9"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(a,{label:"\u72B6\u6001",width:"100"},{default:t(({row:l})=>[e(w,{modelValue:l.status,"onUpdate:modelValue":o=>l.status=o,"active-value":1,"inactive-value":0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(a,{label:"\u64CD\u4F5C",width:"100",fixed:"right"},{default:t(({row:l,$index:o})=>[e(b,{type:"danger",link:"",onClick:te=>g(l,o)},{default:t(()=>[_(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(E,null,{default:t(()=>[e(b,{type:"primary",link:"",onClick:k,disabled:m(d).length===m(c).length},{default:t(()=>[_(" +\u6DFB\u52A0\u6A21\u578B ")]),_:1},8,["disabled"])]),_:1})]),_:1},512)])}}});export{re as _};
