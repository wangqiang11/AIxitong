import{E as X}from"./DNezjcFP.js";import{E as Y}from"./BvqcBhuh.js";import{_ as ee}from"./BUR_EBmg.js";import{E as te}from"./DU1sy8XN.js";import{_ as oe}from"./BkahHhpk.js";import{E as se}from"./EBDLdqoz.js";import{E as ae}from"./CgvUZmt4.js";import{E as re}from"./C9b0D_sp.js";import{b as le,v as ne,bA as ie,f as E,d as ce}from"./C3C96yZa.js";import{E as de}from"./DXLUFY5i.js";/* empty css        */import"./l0sNRNKZ.js";/* empty css        *//* empty css        *//* empty css        */import{b as pe}from"./WTCUdrt7.js";import{D as ue}from"./C7LFSW0h.js";import{d as me}from"./DwnTXu8b.js";import{d as fe,g as _e}from"./B5TkE_dZ.js";import ge from"./C8TfnX6L.js";import{E as ve}from"./B8A6LEAg.js";import{l as be,r as he,b as S,j as C,k as ye,M as r,N as c,O as a,Z as l,u as n,y as ke,aa as R,a3 as _,a0 as i,a7 as d,_ as D,aq as xe,a4 as B,a5 as g,n as we}from"./D5LW44Rr.js";import{_ as Ee}from"./DlAUqK2U.js";import"./DCTLXrZ8.js";import"./Ibp_VyKw.js";import"./-zT6HmgG.js";import"./Cpg3PDWZ.js";import"./Cczi60Tx.js";import"./v3hwjf8i.js";import"./BYIy1x1Y.js";import"./B3O-Pehw.js";import"./D0z3eKdY.js";import"./DqyG3WEP.js";import"./BanEqy-I.js";import"./A_tEgBSR.js";import"./DtUW6dPj.js";/* empty css        *//* empty css        */import"./DjwCd26w.js";import"./CquxfLG0.js";import"./DZCnEkJy.js";import"./B-LKCL5c.js";/* empty css        */import"./CfIJWwds.js";const Se={class:"bg-body h-full flex-1 rounded-[12px] p-4 flex flex-col gap-4 relative"},Ce={class:"sticky top-0"},Re={class:"mt-4",style:{"--el-border-radius-base":"12px"}},Ne={key:0,"infinite-scroll-distance":"50"},ze={class:"grid grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4"},Ve={class:"flex justify-between"},Te={key:0,class:"flex items-center"},$e=["onClick"],De=["onClick"],Be=["onClick"],Le=["onClick"],je=["onClick"],Ie={class:"relative flex-1"},Ue={class:"bg-[var(--el-bg-color-page)] rounded-[12px] overflow-hidden"},qe={key:0,class:"w-full pb-[75%]"},Ae={class:"w-full h-full px-4 flex flex-col justify-center items-center absolute left-0 top-0"},Me=["src"],Oe={class:"text-xs text-[#798696] dark:text-white line-clamp-3 w-full break-all text-center"},Pe={key:1,class:"video-loading w-full pb-[75%]","element-loading-text":"正在生成中..."},Fe={class:"w-full box-border"},He={class:"line-clamp-1"},Ge={class:"flex justify-between items-center"},Ze={class:"text-[#8794A3]"},Je={key:1,class:"h-full flex items-center justify-center"},Ke=be({__name:"video-result",emits:["regenerate"],setup(Qe,{expose:L,emit:j}){const I=le(),U=j,o=he({pageNo:1,count:0,pageSize:10,loading:!0,lists:[]}),N={1:{label:"生成中",type:"warning"},3:{label:"生成失败",type:"danger"},2:{label:"生成成功",type:"success"}},u=S(-1),q=[{label:"全部",value:-1},{label:"生成中",value:1},{label:"生成成功",value:2},{label:"生成失败",value:3}],h=S(!1),z=C(null),V=S([]),A=async s=>{u.value=s,T()},y=C(),M=async()=>{clearTimeout(y.value),o.lists.filter(t=>t.status===1).map(t=>t.id).length>0&&(y.value=setTimeout(()=>{x()},6e3))},O=async s=>{await E.confirm("确定删除？"),await fe({id:s}),ce.success("删除成功"),x()},P=async(s,t)=>{if(V.value.includes(s)||t){E.msgError("该视频已分享过了！");return}h.value=!0,await we(),z.value.open(s)},F=async(s,t)=>{try{const m=await $request.get({url:s,responseType:"blob",baseURL:""},{isReturnDefaultResponse:!0,apiPrefix:""});console.log(m);const v=new Blob([m._data],{type:m.headers.get("Content-Type")}),p=window.URL.createObjectURL(v);pe(p,t)}catch{E.msgError("文件下载失败")}},k=async()=>{try{const s=await _e({status:u.value,page_no:o.pageNo,page_size:o.pageSize});o.count=s.count,o.pageNo===1&&(o.lists=[]),o.lists.push(...s.lists)}catch{}finally{o.loading=!1,M()}},H=()=>{o.count>=o.pageNo*o.pageSize&&(o.pageNo++,k())},G=s=>{const t={type:s.type,prompt:s.prompt,scale:s.scale,image:s.image,style_id:s.style_id};U("regenerate",t)},x=async()=>{o.pageSize=o.pageNo*o.pageSize,o.pageNo=1,await k()},w=C(),T=async()=>{var s;o.loading=!0,o.pageSize=10,o.pageNo=1,await k(),(s=w.value)==null||s.setScrollTop(0)};return T(),ye(()=>{clearTimeout(y.value)}),L({refresh:async()=>{u.value=-1,await x(),w.value.setScrollTop(0)}}),(s,t)=>{const m=X,v=Y,p=ee,f=te,Z=oe,J=se,K=ae,Q=re,$=ne,W=de;return r(),c("div",Se,[a("div",Ce,[t[3]||(t[3]=a("div",{class:"border-b border-b-[#eff0f2] dark:border-[#333333] pb-4 text-2xl font-medium"}," 生成记录 ",-1)),a("div",Re,[l(m,{class:"task-type !bg-[transparent]",modelValue:n(u),"onUpdate:modelValue":t[0]||(t[0]=e=>ke(u)?u.value=e:null),options:q,onChange:A},null,8,["modelValue"])])]),R((r(),_(n(ve),{class:"video-result flex-1",ref_key:"scrollBarRef",ref:w},{default:i(()=>[n(o).lists.length>0?R((r(),c("div",Ne,[a("div",ze,[(r(!0),c(D,null,xe(n(o).lists,(e,We)=>(r(),c("div",{key:e.id,class:"rounded-[12px] p-4 flex flex-col gap-2 border border-[#eff0f2] dark:border-[#333333]"},[a("div",Ve,[l(v,{type:N[e.status].type,effect:"light"},{default:i(()=>[B(g(N[e.status].label),1)]),_:2},1032,["type"]),e.status!==1||e.status===0?(r(),c("div",Te,[e.status===2?(r(),_(f,{key:0,effect:"dark",content:"复制提示词",placement:"bottom"},{default:i(()=>[a("div",{onClick:b=>n(ie)(e.prompt)},[l(p,{class:"cursor-pointer dark:hover:bg-[rgba(255,255,255,0.05)] hover:bg-[rgba(0,0,0,0.05)] rounded-md p-1 box-content",name:"el-icon-CopyDocument",size:"18",color:"#556477"})],8,$e)]),_:2},1024)):d("",!0),e.status===2?(r(),c(D,{key:1},[l(f,{effect:"dark",content:"下载视频",placement:"bottom"},{default:i(()=>[a("div",{onClick:b=>F(e.video_url,"视频")},[l(p,{class:"cursor-pointer dark:hover:bg-[rgba(255,255,255,0.05)] hover:bg-[rgba(0,0,0,0.05)] rounded-md p-1 box-content",name:"el-icon-Download",size:"18",color:"#556477"})],8,De)]),_:2},1024),n(I).getSquareConfig.video_award.is_open?(r(),_(f,{key:0,effect:"dark",content:"分享至广场",placement:"bottom"},{default:i(()=>[a("div",{class:"cursor-pointer dark:hover:bg-[rgba(255,255,255,0.05)] hover:bg-[rgba(0,0,0,0.05)] rounded-md pb-[7px] p-1 box-content",onClick:b=>P(e.id,e.is_share)},[l(p,{name:"local-icon-share",size:"17",color:"#556477"})],8,Be)]),_:2},1024)):d("",!0)],64)):d("",!0),l(f,{effect:"dark",content:"重新生成",placement:"bottom"},{default:i(()=>[a("div",{onClick:b=>G(e)},[l(p,{class:"cursor-pointer dark:hover:bg-[rgba(255,255,255,0.05)] hover:bg-[rgba(0,0,0,0.05)] rounded-md p-1 box-content",name:"el-icon-RefreshRight",size:"18",color:"#556477"})],8,Le)]),_:2},1024),l(f,{effect:"dark",content:"删除",placement:"bottom"},{default:i(()=>[a("div",{onClick:b=>O(e.id)},[l(p,{class:"cursor-pointer dark:hover:bg-[rgba(255,255,255,0.05)] hover:bg-[rgba(0,0,0,0.05)] rounded-md p-1 box-content",name:"el-icon-Delete",size:"18",color:"#556477"})],8,je)]),_:2},1024)])):d("",!0)]),a("div",Ie,[a("div",Ue,[e.status===2?(r(),_(Z,{key:0,src:e.video_url,type:"video",ratio:[4,3]},null,8,["src"])):d("",!0)]),e.status===3?(r(),c("div",qe,[a("div",Ae,[a("img",{class:"w-1/2 mb-4",src:n(me),alt:"生成视频失败"},null,8,Me),t[4]||(t[4]=a("div",{class:"my-[10px]"},"生成视频失败",-1)),a("div",Oe," 错误信息："+g(e.fail_reason),1)])])):d("",!0),e.status===0||e.status===1?R((r(),c("div",Pe,null,512)),[[$,!0]]):d("",!0)]),l(J,{placement:"bottom",title:"提示词","show-arrow":!1,transition:"custom-popover",width:"300px",trigger:"hover",content:e.prompt},{reference:i(()=>[a("div",Fe,[a("div",He,g(e.prompt),1)])]),_:2},1032,["content"]),a("div",Ge,[a("span",Ze,g(e.create_time),1),l(v,null,{default:i(()=>[B(g(e.type_desc),1)]),_:2},1024)])]))),128))])])),[[W,H]]):n(o).loading?d("",!0):(r(),c("div",Je,[l(Q,null,{icon:i(()=>[l(K,{class:"w-[150px] dark:opacity-60",src:n(ue)},null,8,["src"])]),title:i(()=>t[5]||(t[5]=[a("div",{class:"text-xl"},"当前任务是空的哦",-1)])),"sub-title":i(()=>t[6]||(t[6]=[a("div",{class:"text-info"}," 在左侧输入描述，创建你的作品吧! ",-1)])),_:1})]))]),_:1})),[[$,n(o).loading]]),n(h)?(r(),_(ge,{key:0,ref_key:"shareRef",ref:z,onClose:t[1]||(t[1]=e=>h.value=!1),onSuccess:t[2]||(t[2]=e=>n(V).push(e))},null,512)):d("",!0)])}}}),Ot=Ee(Ke,[["__scopeId","data-v-05d8ce9d"]]);export{Ot as default};
