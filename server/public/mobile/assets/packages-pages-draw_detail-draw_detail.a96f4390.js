import{_ as e}from"./page-meta.d751427a.js";import{d as t,u as l,A as a,Y as s,s as r,o as i,k as u,b as o,w as n,g as p,e as c,cP as d,f,B as m,F as x,a4 as _,cQ as g,a6 as v,r as y,a as b,j as h,D as w,aB as j,cu as k,K as C,J as F,C as z,$ as I,t as S,c as T,p as $,m as q,n as O,ae as D,z as N,h as R,V as J}from"./index-d6d2a33a.js";import{_ as L}from"./u-loading.d153dd1a.js";import{_ as P}from"./u-image.9574760c.js";import{_ as V}from"./u-icon.992584aa.js";import{_ as A}from"./u-button.97a3d07f.js";import{F as B}from"./floating-menu.85d77f2f.js";import{_ as H}from"./page-status.451737f8.js";import{u as Q}from"./useCopy.4954d67d.js";import{j as U}from"./draw.cfe8756a.js";import{h as E,d as G}from"./square.95eaea5a.js";import{_ as K}from"./l-painter-image.027bd37e.js";import{a as M,b as W,_ as Y,c as X}from"./l-painter.cecf0579.js";import{_ as Z}from"./u-popup.21776ef7.js";import{_ as ee}from"./_plugin-vue_export-helper.1b428a4d.js";const te=t({__name:"draw-poster",emits:["close"],setup(e,{expose:t,emit:j}){const{copy:k}=Q(),C=l(),F=a(),{primaryColor:z}=s(),I=r(!1),S=r(),T=r({});r("");const $=r(""),q=r(""),O=async()=>{_({title:"生成中"});try{$.value=await g(),setTimeout((()=>{N()}),500)}catch(e){v(),console.log(e)}},D=async()=>{k(await g())},N=async()=>{var e;null==(e=S.value)||e.canvasToTempFilePathSync({fileType:"png",quality:1,pathType:"base64",success:e=>{v(),q.value=e.tempFilePath},fail:e=>{console.log(e),v(),uni.$u.toast("调用海报错误",e)}})},R=()=>{uni.$u.toast("请长按图片保存")};return t({open:e=>{I.value=!0,T.value=e,O()}}),(e,t)=>{const l=y(b("l-painter-image"),K),a=y(b("l-painter-view"),M),s=y(b("l-painter-text"),W),r=y(b("l-painter-qrcode"),Y),_=y(b("l-painter"),X),g=h,v=w,j=y(b("u-button"),A),k=y(b("u-popup"),Z);return i(),u(x,null,[o(_,{ref_key:"painterRef",ref:S,isCanvasToTempFilePath:!1,"custom-style":"position: fixed; left: 200%;"},{default:n((()=>[o(a,{css:"\n            border-radius: 14rpx;\n            overflow: hidden;\n            background-color: #F2F3F6;\n            "},{default:n((()=>[o(a,{css:"\n                width: 100%;\n                "},{default:n((()=>{var e;return[o(l,{src:null==(e=T.value)?void 0:e.image,css:"width: 100%;object-fit:contain;"},null,8,["src"])]})),_:1}),o(a,{css:"margin-top: 20rpx;padding-left: 20rpx;padding-right: 20rpx;margin-bottom: 20rpx;"},{default:n((()=>[o(a,null,{default:n((()=>{var e,t,l;return[o(s,{css:"display: block;font-weight: bold;font-size: 34rpx;text-align: left;color: #101010;lineClamp: 2;",text:(null==(t=null==(e=T.value)?void 0:e.original_prompts)?void 0:t.prompt)||(null==(l=T.value)?void 0:l.prompt)},null,8,["text"])]})),_:1}),p("                <l-painter-view>"),p("                    <l-painter-text"),p('                        css="font-size: 28rpx;text-align: left;color: #101010;margin-top:20rpx;lineClamp: 1;"'),p('                        :text="imgContent?.original_prompts?.prompt_en"'),p("                    />"),p("                </l-painter-view>")])),_:1}),o(a,{css:"height:10rpx;border-top-width:1px;border-top-style:dashed;border-top-color:#D6D3D3;"}),o(a,null,{default:n((()=>[o(a,{css:"margin-top: 20rpx;height: 220rpx; padding-left: 20rpx;padding-right: 20rpx;margin-bottom: 20rpx;display:block;width:60%"},{default:n((()=>[o(a,{css:"display:flex;align-items: center;"},{default:n((()=>[o(l,{css:"width:68rpx;height:68rpx;border-radius: 50%;",src:c(F).userInfo.avatar},null,8,["src"]),o(s,{css:";font-size: 28rpx;text-align: left;color: #666666;margin-left: 20rpx; lineClamp: 1;",text:c(F).userInfo.nickname},null,8,["text"])])),_:1}),o(a,{css:"margin-top:20rpx"},{default:n((()=>[o(s,{css:"font-size: 32rpx;text-align: left;color: #101010;",text:c(C).getWebsiteConfig.pc_name},null,8,["text"])])),_:1}),o(a,{css:"margin-top:20rpx;margin-bottom:20rpx"},{default:n((()=>[o(s,{css:`font-size: 30rpx;text-align: left;color: ${c(z)};`,text:c(d)(c(C).config.current_domain)},null,8,["css","text"])])),_:1})])),_:1}),o(a,{css:"position: absolute;top:20rpx;right:20px;background-color:#fff;padding:15rpx;border-radius: 10rpx;"},{default:n((()=>[p("  H5二维码  "),o(r,{text:$.value,css:"width: 180rpx; height: 180rpx"},null,8,["text"]),p("  小程序二维码  ")])),_:1})])),_:1})])),_:1})])),_:1},512),o(k,{modelValue:I.value,"onUpdate:modelValue":t[0]||(t[0]=e=>I.value=e),mode:"bottom",closeable:!0,closeIconColor:"#000","safe-area-inset-bottom":!0,height:"90%","border-radius":"14",onClose:t[1]||(t[1]=t=>e.$emit("close"))},{default:n((()=>[o(g,{class:"flex flex-col relative h-full"},{default:n((()=>[o(g,{class:"title text-xl font-medium text-center py-[30rpx]"},{default:n((()=>[f(" 生成海报 ")])),_:1}),o(g,{class:"mb-[120rpx] flex-1 min-h-0"},{default:n((()=>[o(v,{"scroll-y":"true",class:"h-full"},{default:n((()=>[o(g,{class:"px-[60rpx]"},{default:n((()=>[m("img",{class:"w-full",src:q.value},null,8,["src"])])),_:1})])),_:1})])),_:1}),o(g,{class:"w-full absolute bottom-0 px-[30rpx] py-[20rpx] flex justify-center"},{default:n((()=>[o(j,{class:"flex-1 mr-2",type:"primary",size:"default",customStyle:{padding:"0 30rpx",height:"82rpx",border:"none",backgroundColor:"#f4f4f8",color:"#333"},onClick:D},{default:n((()=>[f(" 复制链接 ")])),_:1}),o(j,{type:"primary",class:"flex-1",size:"default",customStyle:{padding:"0 30rpx",height:"82rpx"},onClick:R},{default:n((()=>[f(" 长按保存图片到相册 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}}),le=ee(t({__name:"draw_detail",setup(t){const l=j.baseUrl,s={1:"文生图",2:"图生图",3:"选中放大",4:"选中变换"},{copy:d}=Q(),m=D(),_=N(),g=a(),v=r(k.LOADING),w=r({id:-1,task_id:"",prompt:"",prompt_en:"",prompt_desc:"",prompt_other:"",status:3,image:"",image_base:"",thumbnail:"",model:"",nickname:"",image_url:"",image_id:-1,scale:"",able_actions:null,fail_reason:"",negative_prompt:"",version:"",style:"",engine:"",quality:"",censor_status:-1,create_time:"",loras:[],type:1,complex_params:""}),K=C({id:""}),M=F(),W=r(!1),Y=z((()=>{var e,t,l;return(null==(t=null==(e=w.value)?void 0:e.complex_params)?void 0:t.length)?JSON.parse(null==(l=w.value)?void 0:l.complex_params):{}})),X=async()=>{if(g.isLogin)try{await G({records_id:K.id,status:w.value.is_collect?0:1}),w.value.is_collect=w.value.is_collect?0:1}catch(e){console.error(e),uni.$u.toast(JSON.stringify(e))}else _.navigateTo("/pages/login/login")};return I((async()=>{const e=m.query.id;await(async e=>{try{if(m.query.collectId){const t=await E({id:e});t.loras=JSON.parse(t.loras),w.value=t}else{const t=await U({id:e});t.loras=JSON.parse(t.loras),w.value=t}v.value=k.NORMAL}catch(t){v.value=k.ERROR}})(e),K.id=m.query.collectId})),(t,a)=>{const r=y(b("page-meta"),e),m=y(b("u-loading"),L),j=h,k=y(b("u-image"),P),C=R,F=y(b("u-icon"),V),z=y(b("u-button"),A),I=y(b("floating-menu"),B),D=y(b("page-status"),H);return i(),u(x,null,[o(r,{"page-style":t.$theme.pageStyle},null,8,["page-style"]),o(D,{class:"h-full",status:v.value},{default:n((()=>[o(j,{class:"h-full flex flex-col"},{default:n((()=>[o(j,{class:"flex-1 min-h-0"},{default:n((()=>[o(j,{class:"px-[20rpx] bg-white",style:{"padding-bottom":"50px"}},{default:n((()=>[p("      绘画图片      "),o(j,{class:"pt-[24rpx]"},{default:n((()=>[o(k,{src:w.value.image,width:"100%",height:"100%",mode:"widthFix","border-radius":"30"},{loading:n((()=>[o(j,{class:"flex flex-col justify-center items-center w-[640rpx] h-[640rpx] bg-[#F7F9FD]"},{default:n((()=>[o(m,{mode:"circle",color:t.$theme.primaryColor,size:"40"},null,8,["color"]),o(j,{class:"text-primary text-sm mt-[20rpx]"},{default:n((()=>[f(" 加载中 ")])),_:1})])),_:1})])),_:1},8,["src"])])),_:1}),p("      绘画描述词      "),o(j,{class:"mt-[30rpx]"},{default:n((()=>[o(j,{class:"flex items-center justify-between"},{default:n((()=>[o(C,{class:"text-lg font-medium"},{default:n((()=>[f("描述词")])),_:1}),o(C,{class:"text-primary text-base",onClick:a[0]||(a[0]=e=>c(d)(w.value.prompt_en))},{default:n((()=>[f("复制")])),_:1})])),_:1}),o(j,{class:"min-h-[150rpx] mt-[20rpx] p-[20rpx] bg-page rounded-lg"},{default:n((()=>[o(C,{class:"text-base leading-4",style:{"letter-spacing":"1px"}},{default:n((()=>[f(S(w.value.prompt),1)])),_:1})])),_:1})])),_:1}),p("      绘画反向词      "),o(j,{class:"mt-[30rpx]"},{default:n((()=>[o(j,{class:"flex items-center justify-between"},{default:n((()=>[o(C,{class:"text-lg font-medium"},{default:n((()=>[f("反向词")])),_:1}),o(C,{class:"text-primary text-base",onClick:a[1]||(a[1]=e=>c(d)(w.value.negative_prompt))},{default:n((()=>[f("复制")])),_:1})])),_:1}),o(j,{class:"min-h-[150rpx] mt-[20rpx] p-[20rpx] bg-page rounded-lg"},{default:n((()=>[o(C,{class:"text-base"},{default:n((()=>[f(S(w.value.negative_prompt||"未填写"),1)])),_:1})])),_:1})])),_:1}),p("      创作信息      "),o(j,{class:"mt-[30rpx]",style:{"padding-bottom":"100rpx"}},{default:n((()=>[o(j,{class:"text-lg font-medium"},{default:n((()=>[f("创作信息")])),_:1}),o(j,{class:"mt-[20rpx] p-[20rpx] bg-page rounded-lg text-main text-base"},{default:n((()=>[o(j,{class:"flex items-center justify-between"},{default:n((()=>[o(C,null,{default:n((()=>[f("创作者")])),_:1}),o(C,null,{default:n((()=>{var e,t;return[f(S(w.value.nickname||(null==(t=null==(e=c(g))?void 0:e.userInfo)?void 0:t.nickname)),1)]})),_:1})])),_:1}),o(j,{class:"flex items-center justify-between mt-[20rpx]"},{default:n((()=>[o(C,null,{default:n((()=>[f("生成时间")])),_:1}),o(C,null,{default:n((()=>[f(S(w.value.create_time),1)])),_:1})])),_:1}),o(j,{class:"flex items-center justify-between mt-[20rpx]"},{default:n((()=>[o(C,null,{default:n((()=>[f("绘画类型")])),_:1}),o(C,null,{default:n((()=>[f(S(s[w.value.type]),1)])),_:1})])),_:1}),o(j,{class:"flex items-center justify-between mt-[20rpx]"},{default:n((()=>[o(C,null,{default:n((()=>[f("绘画模型")])),_:1}),o(C,null,{default:n((()=>[f(S(w.value.engine),1)])),_:1})])),_:1}),"sd"==w.value.model?(i(),T(j,{key:0,class:"flex items-center justify-between mt-[20rpx]"},{default:n((()=>[o(C,null,{default:n((()=>[f("微调模型")])),_:1}),o(j,{class:"w-[400rpx] text-right line-clamp-1"},{default:n((()=>[f(S(w.value.loras.join("、")),1)])),_:1})])),_:1})):p("v-if",!0),o(j,{class:"flex items-center justify-between mt-[20rpx]"},{default:n((()=>[o(C,null,{default:n((()=>[f("图片尺寸")])),_:1}),o(C,null,{default:n((()=>[f(S(w.value.scale),1)])),_:1})])),_:1})])),_:1}),"sd"==w.value.model?(i(),T(j,{key:0,class:"mt-[20rpx] p-[20rpx] bg-page rounded-lg text-main text-base"},{default:n((()=>[o(j,{class:"flex items-center justify-between"},{default:n((()=>[o(C,null,{default:n((()=>[f("绘画步数")])),_:1}),o(C,null,{default:n((()=>[f(S(c(Y).step||"-"),1)])),_:1})])),_:1}),o(j,{class:"flex items-center justify-between mt-[20rpx]"},{default:n((()=>[o(C,null,{default:n((()=>[f("文本强度")])),_:1}),o(C,null,{default:n((()=>[f(S(c(Y).cfg_scale||"-"),1)])),_:1})])),_:1}),o(j,{class:"flex items-center justify-between mt-[20rpx]"},{default:n((()=>[o(C,null,{default:n((()=>[f("采样模式")])),_:1}),o(C,null,{default:n((()=>[f(S(c(Y).sampler_name||"-"),1)])),_:1})])),_:1}),o(j,{class:"flex items-center justify-between mt-[20rpx]"},{default:n((()=>[o(C,null,{default:n((()=>[f("随机种子")])),_:1}),o(C,null,{default:n((()=>[f(S(c(Y).seed||"-"),1)])),_:1})])),_:1})])),_:1})):p("v-if",!0)])),_:1}),K.id?(i(),T(j,{key:0,class:"draw-detail-footer flex justify-between items-center px-[60rpx]"},{default:n((()=>[o(j,{class:"flex text-xs text-[#666]"},{default:n((()=>[o(j,{class:"text-center",onClick:$(X,["stop"])},{default:n((()=>[o(j,{class:"praise"},{default:n((()=>[o(j,{class:q(["praise-animate",[w.value.is_collect?"praise-entry":"praise-leave"]]),style:O({backgroundImage:`url(${c(l)}resource/image/api/default/praise02.png)`})},null,8,["style","class"])])),_:1}),o(j,{class:"text-[22rpx] text-content"},{default:n((()=>[f("收藏")])),_:1})])),_:1},8,["onClick"]),o(j,{class:"ml-7 text-center",onClick:a[2]||(a[2]=$((e=>(async e=>{var t;g.isLogin?(W.value=!0,await J(),null==(t=null==M?void 0:M.value)||t.open(e)):_.navigateTo("/pages/login/login")})(w.value)),["stop"]))},{default:n((()=>[o(j,{class:"mt-[2rpx] mb-[4rpx]"},{default:n((()=>[o(F,{name:"photo",size:"42"})])),_:1}),o(j,{class:"text-[22rpx] text-content"},{default:n((()=>[f("生成海报")])),_:1})])),_:1})])),_:1}),o(z,{type:"primary",size:"default",customStyle:{padding:"0 30rpx",height:"82rpx",width:"300rpx",margin:"0"}},{default:n((()=>[f(" 长按图片保存 ")])),_:1})])),_:1})):p("v-if",!0)])),_:1})])),_:1}),W.value?(i(),T(te,{key:0,ref_key:"posterRef",ref:M,onClose:a[3]||(a[3]=e=>W.value=!1)},null,512)):p("v-if",!0)])),_:1}),p("    悬浮菜单    "),o(I)])),_:1},8,["status"])],64)}}}),[["__scopeId","data-v-74106801"]]);export{le as default};
