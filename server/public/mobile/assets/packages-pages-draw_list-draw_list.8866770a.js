import{s as e,d as a,u as l,K as t,o as s,k as o,b as i,w as n,f as r,t as c,e as u,F as p,j as m,r as d,a as _,aC as f,cO as x,J as g,x as k,aF as y,$ as v,l as b,g as C,aH as w,aI as h,ae as A,z as j,m as V,c as B,p as F,U as z,V as I,a4 as U,a6 as S,av as D,ai as E,aw as R,a$ as L,i as O,h as Z}from"./index-d6d2a33a.js";import{_ as M}from"./page-meta.d751427a.js";import{_ as T}from"./u-loading.d153dd1a.js";import{_ as W}from"./u-tag.fd761889.js";import{_ as N}from"./u-image.9574760c.js";import{_ as G}from"./u-icon.992584aa.js";import{_ as Q}from"./z-paging.6c8c2edf.js";import{_ as q}from"./u-button.97a3d07f.js";import{_ as H}from"./u-popup.21776ef7.js";import{a as J,d as P}from"./draw.cfe8756a.js";import{u as X}from"./useCopy.4954d67d.js";import{a as K}from"./download.954a43dc.js";import{I as Y}from"./icon_copy.36709540.js";import{I as $,a as ee}from"./icon_delete.577abfad.js";import{a as ae,I as le,b as te}from"./error.b4c7b708.js";import{_ as se}from"./u-select.65c5ee75.js";import{u as oe}from"./useLockFn.3b1f86f9.js";import{F as ie}from"./floating-menu.85d77f2f.js";import{_ as ne}from"./_plugin-vue_export-helper.1b428a4d.js";const re=a({__name:"draw-share",emits:["success","close"],setup(a,{expose:g,emit:k}){l();const y=e(!1),v=e(!1),b=e([]),C=t({base64:"",is_base64:0,image:"",prompts:"",category_id:"",category_name:"",records_id:""}),{lockFn:w,isLock:h}=oe((async()=>{await x(C),y.value=!1,k("success",C.records_id)})),A=e=>{C.category_id=e[0].value,C.category_name=e[0].label},j=()=>{k("close")};return g({open:e=>{(async()=>{try{const e=await f({type:1,share:1});e.unshift({name:"全部",id:""}),b.value=e}catch(e){console.log("获取绘画分类失败=>",e)}})(),y.value=!0,C.base64=e.base64,C.is_base64=e.is_base64,C.image=e.image,C.records_id=e.records_id,C.prompts=e.prompt_en||e.prompt}}),(e,a)=>{const l=m,t=d(_("u-icon"),G),f=d(_("u-button"),q),x=d(_("u-popup"),H),g=d(_("u-select"),se);return s(),o(p,null,[i(x,{modelValue:y.value,"onUpdate:modelValue":a[1]||(a[1]=e=>y.value=e),mode:"center","border-radius":"14",duration:"16",onClose:j},{default:n((()=>[i(l,{class:"w-[650rpx]"},{default:n((()=>[i(l,{class:"p-[30rpx] text-center text-lg font-medium"},{default:n((()=>[r("分享至广场")])),_:1}),i(l,{class:"h-[230rpx] p-[30rpx]"},{default:n((()=>[i(l,{class:"flex items-center justify-between rounded-[12rpx] p-[20rpx] text-content bg-[#eeeeee]",onClick:a[0]||(a[0]=e=>v.value=!0)},{default:n((()=>[r(c(C.category_name?C.category_name:"全部")+" ",1),i(t,{name:"arrow-right"})])),_:1})])),_:1}),i(l,{class:"flex justify-center mt-[30rpx] pb-[20rpx]"},{default:n((()=>[i(f,{type:"primary",customStyle:{width:"220rpx"},loading:u(h),onClick:u(w)},{default:n((()=>[r(" 确定 ")])),_:1},8,["loading","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),i(g,{modelValue:v.value,"onUpdate:modelValue":a[2]||(a[2]=e=>v.value=e),list:b.value,valueName:"id",labelName:"name",confirmColor:e.$theme.primaryColor,onConfirm:A},null,8,["modelValue","list","confirmColor"])],64)}}}),ce=ne(a({__name:"draw_list",setup(a){const f={1:"文生图",2:"图生图",3:"选中放大",4:"选中变换"},x=A(),se=j(),oe=g(),ne=l(),{copy:ce}=X(),ue=e([]),pe={0:{label:"生成中",type:"warning"},1:{label:"生成中",type:"warning"},2:{label:"生成失败",type:"error"},3:{label:"生成成功",type:"success"}},me=[{name:"全部",type:-1},{name:"生成中",type:1},{name:"生成成功",type:3},{name:"生成失败",type:2}],de=e(!1),_e=g(null),fe=e([]),xe=e(""),ge=e(-1),ke=t({show:!1,item:{}}),ye=async(e,a)=>{const l={image:e.image,prompts:e.prompt,records_id:e.id};if(a&&(l.is_base64=1,l.base64=a),fe.value.includes(e.id)||e.is_share){if((await z({title:"温馨提示",content:"该图片已分享过，是否确认重复分享？"})).cancel)return}de.value=!0,await I(),setTimeout((()=>_e.value.open(l)),50)},{images:ve,splitImage:be}=(()=>{const a=e([]);return{images:a,splitImage:e=>new Promise(((l,t)=>{const s=document.createElement("canvas"),o=s.getContext("2d"),i=new Image;i.setAttribute("crossOrigin",""),i.onload=()=>{const{width:e,height:t}=i,n=e/2,r=t/2;s.width=n,s.height=r,a.value=[];for(let l=0;l<2;l++)for(let e=0;e<2;e++)null==o||o.clearRect(0,0,n,r),null==o||o.drawImage(i,-l*n,-e*r),a.value.push(null==s?void 0:s.toDataURL());l(a.value)},i.onerror=e=>{t(e)},i.src=e}))}})(),Ce=(e,a)=>{D({urls:e,current:a})},we=async(e,a)=>{const l={action:a,draw_model:e.engine,image_mask:e.image_base,negative_prompt:e.negative_prompt,prompt:e.prompt,size:e.scale,origin_task_id:e.task_id,complex_params:JSON.parse(e.complex_params)};e.image_base&&(l.draw_type="img2img");E().length>1?(await se.navigateBack(),R("drawRegenerate",l)):await se.redirectTo({path:"/packages/pages/draw/mj",query:{data:JSON.stringify(l)}})},he=async()=>{await ce(ke.item.image),ke.show=!1},Ae=g(),je=async(e,a)=>{try{const{lists:l}=await J({model:xe.value,page_no:e,page_size:a,status:ge.value});oe.value.complete(l)}catch(l){oe.value.complete(!1)}finally{setTimeout((()=>{clearTimeout(Ae.value),[-1,1].includes(ge.value)&&ue.value.some((e=>1===e.status))&&(Ae.value=setTimeout((()=>{Ve()}),6e3))}),100)}},Ve=()=>{var e;null==(e=oe.value)||e.refresh()};return k(ge,(()=>{Ve()})),y((()=>{clearTimeout(Ae.value)})),v((()=>{const e=x.query.model;e&&(xe.value=e)})),(e,a)=>{const l=d(_("page-meta"),M),t=m,x=d(_("u-loading"),T),g=d(_("u-tag"),W),k=O,y=d(_("u-image"),N),v=d(_("u-icon"),G),A=Z,j=d(_("z-paging"),Q),I=d(_("u-button"),q),D=d(_("u-popup"),H);return s(),o(p,null,[i(l,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),i(j,{ref_key:"pagingRef",ref:oe,modelValue:ue.value,"onUpdate:modelValue":a[1]||(a[1]=e=>ue.value=e),"auto-clean-list-when-reload":!1,"safe-area-inset-bottom":!0,onQuery:je,fixed:!0},{top:n((()=>[i(t,{class:"p-[20rpx] flex mx-[-10rpx]"},{default:n((()=>[(s(),o(p,null,b(me,(e=>i(t,{class:"flex-1 px-[10rpx]",key:e.type},{default:n((()=>[i(t,{class:V(["bg-white py-[16rpx] rounded-[10rpx] shadow-light text-center",{"!bg-primary text-white":e.type===ge.value}]),onClick:a=>ge.value=e.type},{default:n((()=>[r(c(e.name),1)])),_:2},1032,["class","onClick"])])),_:2},1024))),64))])),_:1})])),default:n((()=>[i(t,{class:"px-[20rpx]"},{default:n((()=>[(s(!0),o(p,null,b(ue.value,(l=>(s(),B(t,{class:"mb-[20rpx] rounded-[12rpx] shadow-[0px_3px_16px_0px_#EBEEFD] bg-white",key:l.id},{default:n((()=>[1===l.status?(s(),B(t,{key:0,class:"flex flex-col items-center justify-center h-[768rpx] px-[130rpx] text-center"},{default:n((()=>[i(x,{mode:"flower",size:"80"}),i(t,{class:"text-xl font-medium my-[26rpx]"},{default:n((()=>[r(" 正在生成中 ")])),_:1}),i(t,{class:"text-muted"},{default:n((()=>[r(" 预计花费30~60s时间，可离开后再回来查看效果喔～ ")])),_:1})])),_:1})):C("v-if",!0),2===l.status||3===l.status?(s(),B(t,{key:1,class:"px-[30rpx]",onClick:e=>(e=>{2!==e.status&&se.navigateTo({path:"/packages/pages/draw_detail/draw_detail",query:{id:e.id}})})(l)},{default:n((()=>[i(t,{class:"py-[30rpx] flex"},{default:n((()=>[i(g,{text:pe[l.status].label,"border-color":"transparent",type:pe[l.status].type},null,8,["text","type"]),i(t,{class:"ml-auto flex items-center"},{default:n((()=>[3===l.status?(s(),o(p,{key:0},[i(k,{class:"w-[32rpx] h-[32rpx] ml-[34rpx]",src:u(Y),alt:"复制",onClick:F((e=>u(ce)(l.prompt)),["stop"])},null,8,["src","onClick"]),i(k,{class:"w-[32rpx] h-[32rpx] ml-[34rpx]",src:u($),alt:"下载",onClick:F((e=>(e=>{L()?(ke.show=!0,ke.item=e):K(e.image,"图片","image")})(l)),["stop"])},null,8,["src","onClick"]),u(ne).getSquareConfig.draw_award.is_open?(s(),B(k,{key:0,class:"w-[32rpx] h-[32rpx] ml-[34rpx]",src:u(ae),alt:"分享",onClick:F((e=>ye(l)),["stop"])},null,8,["src","onClick"])):C("v-if",!0),"mj"===l.engine&&(null==l?void 0:l.able_cut)?(s(),B(k,{key:1,class:"w-[32rpx] h-[32rpx] ml-[34rpx]",src:u("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAHlBMVEUAAABhYWFlZWVmZmZlZWVlZWVkZGRlZWVlZWVmZmafBDthAAAACXRSTlMAEdB75bk5m1hVoknkAAABHElEQVQ4y3WUvUvEQBDFX1BPy2AKsbzSTlCE6wRBSHfFoaazEMHO0nQHVnaanB/vv3WzN8fsFG+aZWf2N5PMF5I0K96vUUrV3wE4YZJNsBzzG5i1nOS3BM5I4IlbWZZAeldNwMoQB+Y4JIc1mmSuC2CocUq+IjtcBgALDkgyI78CgI5/+drn0wG0/Mz3D44BwM73C8cAgLx2QwGgs6ALjgFAby9b/jiwDbp5BLCXXAYA++Rt9sTzAOCI5MPzJcnaAQtiMg8AcGD6pCqAiAQAqDqSN5PSALe8X1zluCUQ6hkBL6gBwiBd6eDyc/UPypToJHra32LadaFkaXUzyPbRDadbVDe1jYGdjujBkaMmh1OOs14AemWgEUtGrKV/L6701Xe2Wh4AAAAASUVORK5CYII="),alt:"一键切图",onClick:F((e=>(async e=>{if(!Array.isArray(e.image)){U({title:"图片拆分中..."});try{await be(e.image),console.log(ve.value),e.image=ve.value}finally{S()}}})(l)),["stop"])},null,8,["src","onClick"])):C("v-if",!0)],64)):C("v-if",!0),i(k,{class:"w-[32rpx] h-[32rpx] ml-[34rpx]",src:u(le),alt:"重新生成",onClick:F((e=>(async e=>{const a={draw_model:e.engine,image_mask:e.image_base,negative_prompt:e.negative_prompt,prompt:e.prompt,size:e.scale,draw_loras:e.loras};e.image_base&&(a.draw_type="img2img"),E().length>1?(await se.navigateBack(),R("drawRegenerate",a)):await se.redirectTo({path:"/packages/pages/draw/mj",query:{data:JSON.stringify(a)}})})(l)),["stop"])},null,8,["src","onClick"]),i(k,{class:"w-[32rpx] h-[32rpx] ml-[34rpx]",src:u(ee),alt:"删除",onClick:F((e=>(async e=>{const{cancel:a}=await z({title:"温馨提示",content:"确定删除？"});a||(await P({ids:[e]}),Ve())})(l.id)),["stop"])},null,8,["src","onClick"])])),_:2},1024)])),_:2},1024),2===l.status?(s(),B(t,{key:0,class:"flex min-h-[472rpx] flex-col justify-center items-center"},{default:n((()=>[i(k,{class:"w-[300rpx] h-[300rpx]",src:u(te)},null,8,["src"]),i(t,{class:"text-xl font-medium"},{default:n((()=>[r(" 绘图失败 ")])),_:1}),l.fail_reason?(s(),B(t,{key:0,class:"text-muted mt-[26rpx]"},{default:n((()=>[r(" 错误信息："+c(l.fail_reason),1)])),_:2},1024)):C("v-if",!0)])),_:2},1024)):3===l.status?(s(),B(t,{key:1,class:"preview-picture",onClick:a[0]||(a[0]=F((()=>{}),["stop"]))},{default:n((()=>[C("    单张图片    "),Array.isArray(l.image)?(s(),o(p,{key:1},[C("    多张图片    "),(s(!0),o(p,null,b(l.image,((e,a)=>(s(),B(t,{class:"image__item relative inline-block",key:a},{default:n((()=>[i(y,{class:"inline-block",width:"280",mode:"widthFix",src:e,onClick:e=>Ce(l.image,a)},{loading:n((()=>[i(t,{class:"bg-[#F7F9FD]",style:{width:"280rpx",height:"300rpx"}})])),_:2},1032,["src","onClick"]),i(t,{class:"image__item__icon",onClick:a=>ye(l,e)},{default:n((()=>[i(v,{name:"share",color:"#ffffff",size:"34"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))],64)):(s(),B(y,{key:0,src:l.thumbnail||l.image,width:"640rpx",height:"640rpx",mode:"aspectFit","border-radius":"0",onClick:e=>Ce([l.image],0)},{loading:n((()=>[i(t,{class:"flex flex-col justify-center items-center w-[640rpx] h-[640rpx] bg-[#F7F9FD]"},{default:n((()=>[i(x,{mode:"circle",color:e.$theme.primaryColor,size:"40"},null,8,["color"]),i(t,{class:"text-primary text-sm mt-[20rpx]"},{default:n((()=>[r(" 加载中 ")])),_:1})])),_:1})])),_:2},1032,["src","onClick"]))])),_:2},1024)):C("v-if",!0),i(t,{class:"line-clamp-2 mt-[20rpx]"},{default:n((()=>[r(c(l.prompt),1)])),_:2},1024),3===l.status&&"mj"==l.engine?(s(),B(t,{key:2,class:"mt-4"},{default:n((()=>{var e,a,c,u;return[!(null==(e=null==l?void 0:l.able_actions)?void 0:e.includes("low_variation"))&&(null==(a=null==l?void 0:l.able_actions)?void 0:a.length)?(s(),o(p,{key:0},[i(t,{class:"flex flex-none min-w-[272px]"},{default:n((()=>[i(A,{class:"text-xs"},{default:n((()=>[r("放大图片")])),_:1}),i(A,{class:"opt-btn",onClick:e=>we(l,"upscale1")},{default:n((()=>[r("左上")])),_:2},1032,["onClick"]),i(A,{class:"opt-btn",onClick:e=>we(l,"upscale2")},{default:n((()=>[r("右上")])),_:2},1032,["onClick"]),i(A,{class:"opt-btn",onClick:e=>we(l,"upscale3")},{default:n((()=>[r("左下")])),_:2},1032,["onClick"]),i(A,{class:"opt-btn",onClick:e=>we(l,"upscale4")},{default:n((()=>[r("右下")])),_:2},1032,["onClick"])])),_:2},1024),i(t,{class:"flex flex-none min-w-[272px] mt-[15px]"},{default:n((()=>[i(A,{class:"text-xs"},{default:n((()=>[r("变体图片")])),_:1}),i(t,{class:"opt-btn",onClick:e=>we(l,"variation1")},{default:n((()=>[r("左上")])),_:2},1032,["onClick"]),i(t,{class:"opt-btn",onClick:e=>we(l,"variation2")},{default:n((()=>[r("右上")])),_:2},1032,["onClick"]),i(t,{class:"opt-btn",onClick:e=>we(l,"variation3")},{default:n((()=>[r("左下")])),_:2},1032,["onClick"]),i(t,{class:"opt-btn",onClick:e=>we(l,"variation4")},{default:n((()=>[r("右下")])),_:2},1032,["onClick"])])),_:2},1024)],64)):(null==(c=null==l?void 0:l.able_actions)?void 0:c.length)?(s(),o(p,{key:1},[i(t,null,{default:n((()=>[i(A,null,{default:n((()=>[r("调整")])),_:1}),i(t,{class:"opt-btn",onClick:e=>we(l,"high_variation")},{default:n((()=>[r("微调(强)")])),_:2},1032,["onClick"]),i(t,{class:"opt-btn",onClick:e=>we(l,"low_variation")},{default:n((()=>[r("微调(弱)")])),_:2},1032,["onClick"]),C('                        <view class="opt-btn" @click="onLocalityReDrawing(item)">局部重绘</view>')])),_:2},1024),i(t,{class:"flex flex-none min-w-[272px] mt-[15px]"},{default:n((()=>{var e,a,c;return[i(A,null,{default:n((()=>[r("变化")])),_:1}),(null==(e=null==l?void 0:l.able_actions)?void 0:e.includes("outpaint_1.5x"))?(s(),o(p,{key:0},[i(t,{class:"opt-btn",onClick:e=>we(l,"outpaint_1.5x")},{default:n((()=>[r("变焦1.5x")])),_:2},1032,["onClick"]),i(t,{class:"opt-btn",onClick:e=>we(l,"outpaint_2x")},{default:n((()=>[r("变焦2x")])),_:2},1032,["onClick"])],64)):C("v-if",!0),(null==(a=null==l?void 0:l.able_actions)?void 0:a.includes("upscale_2x"))?(s(),o(p,{key:1},[i(t,{class:"opt-btn",onClick:e=>we(l,"upscale_2x")},{default:n((()=>[r("高清2x")])),_:2},1032,["onClick"]),i(t,{class:"opt-btn",onClick:e=>we(l,"upscale_4x")},{default:n((()=>[r("高清4x")])),_:2},1032,["onClick"])],64)):C("v-if",!0),(null==(c=null==l?void 0:l.able_actions)?void 0:c.includes("upscale_subtle"))?(s(),o(p,{key:2},[i(t,{class:"opt-btn",onClick:e=>we(l,"upscale_subtle")},{default:n((()=>[r("弱变化")])),_:2},1032,["onClick"]),i(t,{class:"opt-btn",onClick:e=>we(l,"upscale_creative")},{default:n((()=>[r("强变化")])),_:2},1032,["onClick"])],64)):C("v-if",!0)]})),_:2},1024),C("    第一次放大    "),(null==(u=null==l?void 0:l.able_actions)?void 0:u.includes("pan_left"))?(s(),B(t,{key:0,class:"flex flex-none min-w-[272px] mt-[15px]"},{default:n((()=>[i(A,null,{default:n((()=>[r("拉伸")])),_:1}),i(t,{class:"opt-btn",onClick:e=>we(l,"pan_left")},{default:n((()=>[r("⬅️")])),_:2},1032,["onClick"]),i(t,{class:"opt-btn",onClick:e=>we(l,"pan_right")},{default:n((()=>[r(" ➡️")])),_:2},1032,["onClick"]),i(t,{class:"opt-btn",onClick:e=>we(l,"pan_up")},{default:n((()=>[r("⬆️")])),_:2},1032,["onClick"]),i(t,{class:"opt-btn",onClick:e=>we(l,"pan_down")},{default:n((()=>[r("⬇️")])),_:2},1032,["onClick"])])),_:2},1024)):C("v-if",!0)],64)):C("v-if",!0)]})),_:2},1024)):C("v-if",!0),i(t,{class:"flex items-center py-[30rpx]"},{default:n((()=>[i(t,{class:"text-muted mr-auto"},{default:n((()=>[r(" 时间："+c(l.create_time),1)])),_:2},1024),i(t,{class:"ml-[20rpx]"},{default:n((()=>[i(g,{text:f[l.type],size:"mini","border-color":"transparent"},null,8,["text"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])):C("v-if",!0)])),_:2},1024)))),128))])),_:1})])),_:1},8,["modelValue"]),C("    悬浮菜单    "),i(ie),i(D,{modelValue:ke.show,"onUpdate:modelValue":a[2]||(a[2]=e=>ke.show=e),mode:"center","border-radius":"15",closeable:""},{default:n((()=>[i(t,{class:"w-[650rpx] p-[40rpx]"},{default:n((()=>[i(t,{class:"text-lg font-bold text-center mb-[40rpx]"},{default:n((()=>[r(" 下载图片 ")])),_:1}),i(t,{class:"mb-[40rpx]"},{default:n((()=>[r(" 当前环境不支持下载，请复制链接到浏览器打开下载 ")])),_:1}),i(I,{type:"primary",shape:"circle",onClick:he},{default:n((()=>[r(" 复制链接 ")])),_:1})])),_:1})])),_:1},8,["modelValue"]),w(i(re,{ref_key:"shareRef",ref:_e,onClose:a[3]||(a[3]=e=>de.value=!1),onSuccess:a[4]||(a[4]=e=>fe.value.push(e))},null,512),[[h,de.value]])],64)}}}),[["__scopeId","data-v-33af47b4"]]);export{ce as default};
