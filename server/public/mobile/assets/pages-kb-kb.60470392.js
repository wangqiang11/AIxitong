import{_ as e}from"./page-meta.d751427a.js";import{M as a,o as l,c as t,w as s,g as o,O as u,b as r,m as i,n as d,j as n,d as p,r as m,a as c,J as f,C as _,s as x,x as g,f as v,e as b,P as h,Q as y,D as w,u as k,K as V,k as C,t as j,F as I,R as z,T as U,A as q,z as S,l as T,p as R,U as $,V as B,h as L,W as F,B as A,L as W,q as E,S as M}from"./index-d6d2a33a.js";import{_ as O}from"./u-tabs.f14aec5a.js";import{c as P,_ as Q}from"./z-paging.6c8c2edf.js";import{_ as D}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as K}from"./tabbar.vue_vue_type_script_setup_true_lang.e2e30d1a.js";import{_ as N}from"./u-search.7e682473.js";import{_ as G}from"./u-tag.fd761889.js";import{_ as J}from"./u-icon.992584aa.js";import{_ as H}from"./u-image.9574760c.js";import{_ as X}from"./u-action-sheet.29883fbc.js";import{p as Y,c as Z,g as ee,d as ae}from"./robot.627d8f7e.js";import{_ as le}from"./dragon-button.79847554.js";import{_ as te}from"./app-upload.vue_vue_type_script_setup_true_lang.13b099e0.js";import{_ as se}from"./u-form-item.36bcbf1f.js";import{_ as oe}from"./u-input.e3cf3beb.js";import{_ as ue}from"./u-form.f207500c.js";import{_ as re}from"./u-button.97a3d07f.js";import{_ as ie}from"./u-popup.21776ef7.js";import{_ as de}from"./u-select.65c5ee75.js";import{u as ne}from"./useLockFn.3b1f86f9.js";import{_ as pe}from"./app-select.66776d41.js";import{_ as me}from"./model-picker.594cca17.js";import{a as ce,g as fe}from"./kb.9f6bd434.js";import{_ as _e}from"./u-avatar.b94cdf10.js";import{p as xe,d as ge,g as ve}from"./digital.91569775.js";import"./u-badge.f9b9ebb9.js";import"./uv-popup.0236847c.js";import"./mixin.91a2f735.js";import"./isString.6d1f126a.js";import"./emitter.1571a5d9.js";import"./u-radio-group.5e4decfb.js";import"./u-checkbox.0fdc3635.js";import"./u-collapse.5c69f838.js";const be=D({name:"z-paging-swiper",mixins:[P],data:()=>({swiperContentStyle:{}}),props:{fixed:{type:Boolean,default:!0},safeAreaInsetBottom:{type:Boolean,default:!1},swiperStyle:{type:Object,default:function(){return{}}}},mounted(){this.$nextTick((()=>{this.systemInfo=a(),setTimeout(this.updateFixedLayout,100)})),this._getCssSafeAreaInsetBottom(),this.updateLeftAndRightWidth(),this.swiperContentStyle={flex:"1"},this.swiperContentStyle={width:"100%",height:"100%"}},computed:{finalSwiperStyle(){const e={...this.swiperStyle};if(!this.systemInfo)return e;const a=this.windowTop,l=this.systemInfo.windowBottom;if(this.fixed&&(a&&!e.top&&(e.top=a+"px"),!e.bottom)){let a=l||0;a+=this.safeAreaInsetBottom?this.safeAreaBottom:0,a>0&&(e.bottom=a+"px")}return e}},methods:{updateLeftAndRightWidth(){this.isOldWebView&&this.$nextTick((()=>this._updateLeftAndRightWidth(this.swiperContentStyle,"zp-swiper")))}}},[["render",function(e,a,p,m,c,f){const _=n;return l(),t(_,{class:i(p.fixed?"zp-swiper-container zp-swiper-container-fixed":"zp-swiper-container"),style:d([f.finalSwiperStyle])},{default:s((()=>[-1===e.cssSafeAreaInsetBottom?(l(),t(_,{key:0,class:"zp-safe-area-inset-bottom"})):o("v-if",!0),e.zSlots.top?u(e.$slots,"top",{key:1},void 0,!0):o("v-if",!0),r(_,{class:"zp-swiper-super"},{default:s((()=>[e.zSlots.left?(l(),t(_,{key:0,class:i({"zp-swiper-left":!0,"zp-absoulte":e.isOldWebView})},{default:s((()=>[u(e.$slots,"left",{},void 0,!0)])),_:3},8,["class"])):o("v-if",!0),r(_,{class:i({"zp-swiper":!0,"zp-absoulte":e.isOldWebView}),style:d([c.swiperContentStyle])},{default:s((()=>[u(e.$slots,"default",{},void 0,!0)])),_:3},8,["class","style"]),e.zSlots.right?(l(),t(_,{key:1,class:i({"zp-swiper-right":!0,"zp-absoulte zp-right":e.isOldWebView})},{default:s((()=>[u(e.$slots,"right",{},void 0,!0)])),_:3},8,["class"])):o("v-if",!0)])),_:3}),e.zSlots.bottom?u(e.$slots,"bottom",{key:2},void 0,!0):o("v-if",!0)])),_:3},8,["class","style"])}],["__scopeId","data-v-bebf1a15"]]),he=D(p({__name:"add-btn",props:{yEdge:{default:200}},emits:["click"],setup:(e,{emit:a})=>(o,u)=>{const i=m(c("u-icon"),J),d=n,p=m(c("dragon-button"),le);return l(),t(p,{size:88,xEdge:10,yEdge:e.yEdge},{default:s((()=>[r(d,{class:"add-btn",onClick:u[0]||(u[0]=e=>a("click"))},{default:s((()=>[r(i,{name:"plus",size:40})])),_:1})])),_:1},8,["yEdge"])}}),[["__scopeId","data-v-4cbdd12d"]]),ye=p({__name:"add-popup",props:{modelValue:{type:Boolean}},emits:["update:modelValue","update"],setup(e,{emit:a}){const o=e,u=f(),i=_({get:()=>o.modelValue,set(e){a("update:modelValue",e)}}),d=x({image:"",name:"",intro:""}),p={image:[{required:!0,message:"请选择智能体图标",trigger:["change"]}],name:[{required:!0,message:"请输入智能体名称",trigger:["change"]}]},k=()=>{u.value.validate((async e=>{if(e){const{id:e}=await Y(d.value);a("update"),setTimeout((()=>{i.value=!1,y.navigateTo({path:"/packages/pages/robot_info/robot_info",query:{id:e}})}),1e3)}}))};return g(i,(e=>{if(e){setTimeout((()=>{u.value.setRules(p)}));const e=window.origin,a=x(e+"/resource/image/adminapi/default/robot_icon.gif");d.value={image:a.value,name:"",intro:""}}})),(e,a)=>{const o=n,p=m(c("app-upload"),te),f=m(c("u-form-item"),se),_=m(c("u-input"),oe),x=m(c("u-form"),ue),g=w,y=m(c("u-button"),re),V=m(c("u-popup"),ie);return l(),t(V,{modelValue:b(i),"onUpdate:modelValue":a[3]||(a[3]=e=>h(i)?i.value=e:null),closeable:"","border-radius":"16",mode:"bottom"},{default:s((()=>[r(o,{class:"h-[70vh] flex flex-col"},{default:s((()=>[r(o,{class:"text-xl mx-[20rpx] py-[28rpx] font-bold border-b border-solid border-light border-0"},{default:s((()=>[v(" 新增智能体 ")])),_:1}),r(o,{class:"flex-1 min-h-0"},{default:s((()=>[r(g,{class:"h-full","scroll-y":""},{default:s((()=>[r(o,{class:"p-[20rpx]"},{default:s((()=>[r(x,{model:d.value,ref_key:"uFormRef",ref:u,"label-position":"top","border-bottom":!1},{default:s((()=>[r(f,{label:"智能体图标",prop:"image",required:""},{default:s((()=>[r(o,{class:"mx-[-10rpx] flex-1 min-w-0"},{default:s((()=>[r(p,{modelValue:d.value.image,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value.image=e)},null,8,["modelValue"])])),_:1})])),_:1}),r(f,{label:"智能体名称",prop:"name",required:""},{default:s((()=>[r(o,{class:"flex-1"},{default:s((()=>[r(_,{modelValue:d.value.name,"onUpdate:modelValue":a[1]||(a[1]=e=>d.value.name=e),placeholder:"给你的智能体取个响亮的名字",border:!0},null,8,["modelValue"])])),_:1})])),_:1}),r(f,{label:"智能体简介",prop:"intro"},{default:s((()=>[r(o,{class:"flex-1"},{default:s((()=>[r(_,{modelValue:d.value.intro,"onUpdate:modelValue":a[2]||(a[2]=e=>d.value.intro=e),type:"textarea",height:200,placeholder:"请简单描述下给你的智能体",border:!0},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1})])),_:1}),r(o,{class:"flex p-[20rpx]"},{default:s((()=>[r(o,{class:"flex-1"},{default:s((()=>[r(y,{type:"primary",onClick:k},{default:s((()=>[v("保存")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])}}}),we=p({__name:"share-popup",emits:["success","close"],setup(e,{expose:a,emit:t}){k();const o=x(!1),u=x(!1),i=x([]),d=V({cate_id:"",id:"",cate_name:""}),{lockFn:p,isLock:f}=ne((async()=>{await z(d),o.value=!1,t("success",d.id)})),_=e=>{d.cate_id=e[0].value,d.cate_name=e[0].label},g=()=>{t("close")};return a({open:e=>{(async()=>{try{const e=await U();e.unshift({name:"全部",id:""}),i.value=e}catch(e){console.log("获取机器人分类失败=>",e)}})(),o.value=!0,d.id=e}}),(e,a)=>{const t=n,x=m(c("u-icon"),J),h=m(c("u-button"),re),y=m(c("u-popup"),ie),w=m(c("u-select"),de);return l(),C(I,null,[r(y,{modelValue:o.value,"onUpdate:modelValue":a[1]||(a[1]=e=>o.value=e),mode:"center","border-radius":"14",duration:"16",onClose:g},{default:s((()=>[r(t,{class:"w-[650rpx]"},{default:s((()=>[r(t,{class:"p-[30rpx] text-center text-lg font-medium"},{default:s((()=>[v("分享至广场")])),_:1}),r(t,{class:"h-[230rpx] p-[30rpx]"},{default:s((()=>[r(t,{class:"flex items-center justify-between rounded-[12rpx] p-[20rpx] text-content bg-[#eeeeee]",onClick:a[0]||(a[0]=e=>u.value=!0)},{default:s((()=>[v(j(d.cate_name?d.cate_name:"全部")+" ",1),r(x,{name:"arrow-right"})])),_:1})])),_:1}),r(t,{class:"flex justify-center mt-[30rpx] pb-[20rpx]"},{default:s((()=>[r(h,{type:"primary",customStyle:{width:"220rpx"},loading:b(f),onClick:b(p)},{default:s((()=>[v(" 确定 ")])),_:1},8,["loading","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),r(w,{modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=e=>u.value=e),list:i.value,valueName:"id",labelName:"name",confirmColor:e.$theme.primaryColor,onConfirm:_},null,8,["modelValue","list","confirmColor"])],64)}}}),ke=D(p({__name:"index",props:{tabIndex:null,currentIndex:null},setup(e,{expose:a}){var u;const i=e,d=q(),p=k(),_=x([]),h=f(),y=x(!1),w=x(!1),z=x(!1),U=x(""),L=V({show:!1,currentId:-1,isShare:-1,isPublic:-1}),F=f([{value:"begin",text:"开始对话"},{value:"release",text:"发布智能体"},{value:"dialogue",text:"对话数据"},{value:"share",text:"分享至广场",show:!(null==(u=p.getSquareConfig.robot_award)?void 0:u.is_open)},{value:"delete",text:"删除"}]),A=x(!1),W=f(null),E=x([]),M=e=>{E.value.push(e),le()},O=async e=>{const a=F.value[e].value,l=L.currentId;switch(a){case"delete":(async e=>{const{cancel:a}=await $({title:"温馨提示",content:"确定删除？"});if(a)return;await ae({id:e});const l=_.value.findIndex((a=>a.id==e));_.value.splice(l,1)})(l);break;case"dialogue":case"release":D(l,a);break;case"share":L.isPublic?await Z({id:l}):(async(e,a)=>{if((E.value.includes(e)||a)&&(await $({title:"温馨提示",content:"该智能体已分享过，是否确认重复分享？"})).cancel)return;A.value=!0,await B(),setTimeout((()=>W.value.open(e)),50)})(l,L.isShare),le();break;case"begin":P.navigateTo({path:"/packages/pages/robot_chat/robot_chat",query:{id:l}})}},P=S(),D=(e,a)=>{P.navigateTo({path:"/packages/pages/robot_info/robot_info",query:{id:e,type:a||null}})},K=async()=>{if(!d.isLogin)return P.navigateTo("/pages/login/login");if(d.userInfo.robot_num<=0){if(p.getIsShowRecharge){const{cancel:e}=await $({title:"温馨提示",content:"智能体数量已用完，请前往充值"});if(e)return;P.navigateTo({path:"/packages/pages/recharge/recharge"})}else uni.$u.toast("智能体数量已用完。请联系客服增加");return Promise.reject()}z.value=!0},Y=async(e,a)=>{var l,t;try{const{lists:t=[]}=await ee({page_size:a,page_no:e,keyword:U.value});null==(l=h.value)||l.complete(t)}catch(s){null==(t=h.value)||t.complete(!1)}},le=()=>{B((()=>{h.value&&h.value.refresh()}))};return g((()=>i.currentIndex),(e=>{e===i.tabIndex&&(y.value||B((()=>{setTimeout((()=>{w.value=!0}),100)})))}),{immediate:!0}),a({reload:le}),(e,a)=>{const u=m(c("u-search"),N),i=n,d=m(c("u-tag"),G),p=m(c("u-icon"),J),f=m(c("u-image"),H),x=m(c("z-paging"),Q),g=m(c("u-action-sheet"),X);return l(),t(i,{class:"content"},{default:s((()=>[o('  :enable-back-to-top="currentIndex===tabIndex" 在微信小程序上可以多加这一句，因为默认是允许点击返回顶部的，但是这个页面有多个scroll-view，会全部返回顶部，所以需要控制是当前index才允许点击返回顶部 '),o(" 如果当前页已经加载过数据或者当前切换到的tab是当前页，才展示当前页数据（懒加载） "),y.value||w.value?(l(),t(x,{key:0,ref_key:"pagingRef",ref:h,modelValue:_.value,"onUpdate:modelValue":a[5]||(a[5]=e=>_.value=e),"auto-clean-list-when-reload":!1,onQuery:Y,fixed:!1},{top:s((()=>[r(i,{class:"py-[14rpx] px-[30rpx] bg-white"},{default:s((()=>[r(u,{modelValue:U.value,"onUpdate:modelValue":a[0]||(a[0]=e=>U.value=e),placeholder:"请输入关键词搜索",height:"72","bg-color":"#F7F8F9",onSearch:a[1]||(a[1]=e=>b(h).reload()),onCustom:a[2]||(a[2]=e=>b(h).reload()),onClear:a[3]||(a[3]=e=>b(h).reload())},null,8,["modelValue"])])),_:1})])),default:s((()=>[r(i,{class:"px-[20rpx] pt-[30rpx]"},{default:s((()=>[r(i,{class:"flex flex-wrap mx-[-15rpx]"},{default:s((()=>[(l(!0),C(I,null,T(_.value,(e=>(l(),t(i,{class:"item w-[50%] px-[15rpx] mb-[30rpx]",key:e.id},{default:s((()=>[r(i,{class:"h-full robot-item",onClick:a=>D(e.id)},{default:s((()=>[r(i,{class:"flex justify-end",onClick:a[4]||(a[4]=R((()=>{}),["stop"]))},{default:s((()=>[r(i,{class:"flex-1"},{default:s((()=>[e.is_public?(l(),t(d,{key:0,type:"warning",text:"公开",size:"mini"})):(l(),t(d,{key:1,type:"primary",text:"私有",size:"mini"}))])),_:2},1024),r(i,{onClick:a=>(e=>{L.show=!0,L.currentId=e.id,L.isPublic=e.is_public,L.isShare=e.is_share,e.is_public?F.value[3].text="取消发布广场":F.value[3].text="分享至广场"})(e)},{default:s((()=>[r(p,{name:"more-dot-fill"})])),_:2},1032,["onClick"])])),_:2},1024),r(i,{class:"flex flex-col items-center"},{default:s((()=>[r(f,{src:e.image,width:"100",height:"100",shape:"circle"},null,8,["src"]),r(i,{class:"text-2xl mt-[22rpx] mb-[16px] line-clamp-3"},{default:s((()=>[v(j(e.name),1)])),_:2},1024),r(i,{class:"text-muted leading-[40rpx] h-[120rpx] line-clamp-3"},{default:s((()=>[v(j(e.intro||"这个智能体还没介绍呢"),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1},8,["modelValue"])):o("v-if",!0),r(he,{onClick:K}),r(ye,{modelValue:z.value,"onUpdate:modelValue":a[6]||(a[6]=e=>z.value=e),onUpdate:a[7]||(a[7]=e=>b(h).reload())},null,8,["modelValue"]),r(g,{list:b(F),modelValue:L.show,"onUpdate:modelValue":a[8]||(a[8]=e=>L.show=e),onClick:O},null,8,["list","modelValue"]),A.value?(l(),t(we,{key:1,ref_key:"shareRef",ref:W,onClose:a[9]||(a[9]=e=>A.value=!1),onSuccess:M},null,512)):o("v-if",!0)])),_:1})}}}),[["__scopeId","data-v-f2973b37"]]),Ve=D(p({__name:"add-popup",props:{modelValue:{type:Boolean}},emits:["update:modelValue","close"],setup(e,{emit:a}){const u=e,i=k(),d=f(),p=_({get:()=>u.modelValue,set(e){a("update:modelValue",e)}}),y=V({chatModels:[],vectorModels:[]});V({document:"",embedding:""});const C=x({image:"",name:"",intro:"",embedding_model_id:"",documents_model_id:"",documents_model_sub_id:""}),I=V({image:[{required:!0,message:"请选择知识库图标",trigger:["change"]}],name:[{required:!0,message:"请输入知识库名称",trigger:["change"]}],embedding_model_id:[{required:!0,message:"请选择向量模型"}],documents_model_id:[{required:!0,message:"请选择文件处理模型"}]}),z=S(),U=()=>{d.value.validate((async e=>{if(e){const{id:e}=await ce(C.value);z.navigateTo({path:"/packages/pages/kb_info/kb_info",query:{id:e}}),a("close")}}))};return g(p,(e=>{e&&(setTimeout((async()=>{await(async()=>{const{vectorModels:e}=await F({queryKey:"modelLists"});y.vectorModels=e})(),d.value.setRules(I)})),C.value={image:"",name:"",intro:"",documents_model_id:"",documents_model_sub_id:"",embedding_model_id:""})})),(e,a)=>{const u=n,f=m(c("app-upload"),te),_=m(c("u-form-item"),se),x=m(c("u-input"),oe),g=m(c("app-select"),pe),k=L,V=m(c("u-icon"),J),I=m(c("model-picker"),me),z=m(c("u-form"),ue),q=w,S=m(c("u-button"),re),T=m(c("u-popup"),ie);return l(),t(T,{modelValue:b(p),"onUpdate:modelValue":a[7]||(a[7]=e=>h(p)?p.value=e:null),closeable:"","border-radius":"16",mode:"bottom"},{default:s((()=>[r(u,{class:"h-[70vh] flex flex-col"},{default:s((()=>[r(u,{class:"text-xl mx-[20rpx] py-[28rpx] font-bold border-b border-solid border-light border-0"},{default:s((()=>[v(" 创建知识库 ")])),_:1}),r(u,{class:"flex-1 min-h-0"},{default:s((()=>[r(q,{class:"h-full","scroll-y":""},{default:s((()=>[r(u,{class:"p-[20rpx]"},{default:s((()=>[r(z,{model:C.value,ref_key:"uFormRef",ref:d,"label-position":"top","border-bottom":!1},{default:s((()=>[r(_,{label:"知识库封面",prop:"image",required:""},{default:s((()=>[r(u,{class:"mx-[-10rpx] flex-1 min-w-0"},{default:s((()=>[r(f,{modelValue:C.value.image,"onUpdate:modelValue":a[0]||(a[0]=e=>C.value.image=e)},null,8,["modelValue"])])),_:1})])),_:1}),r(_,{label:"知识库名称",prop:"name",required:""},{default:s((()=>[r(u,{class:"flex-1"},{default:s((()=>[r(x,{modelValue:C.value.name,"onUpdate:modelValue":a[1]||(a[1]=e=>C.value.name=e),placeholder:"请输入知识库名称",border:!0},null,8,["modelValue"])])),_:1})])),_:1}),r(_,{label:"知识库简介",prop:"intro"},{default:s((()=>[r(u,{class:"flex-1"},{default:s((()=>[r(x,{modelValue:C.value.intro,"onUpdate:modelValue":a[2]||(a[2]=e=>C.value.intro=e),type:"textarea",height:200,placeholder:"请用一句话描述知识库",border:!0},null,8,["modelValue"])])),_:1})])),_:1}),r(_,{label:"向量模型",prop:"embedding_model_id",required:""},{default:s((()=>[r(u,{class:"flex-1"},{default:s((()=>[r(g,{modelValue:C.value.embedding_model_id,"onUpdate:modelValue":a[3]||(a[3]=e=>C.value.embedding_model_id=e),popupTitle:"向量模型",dataLists:y.vectorModels,placeholder:"请选择",name:"alias",value:"id"},{label:s((({item:e})=>[r(u,null,{default:s((()=>[r(u,null,{default:s((()=>[v(j(e.alias),1)])),_:2},1024)])),_:2},1024)])),_:1},8,["modelValue","dataLists"])])),_:1})])),_:1}),r(_,{label:"文件处理模型",prop:"documents_model_id",required:""},{default:s((()=>[r(u,{class:"flex-1"},{default:s((()=>[r(I,{setDefault:!1,id:C.value.documents_model_id,"onUpdate:id":a[5]||(a[5]=e=>C.value.documents_model_id=e),sub_id:C.value.documents_model_sub_id,"onUpdate:sub_id":a[6]||(a[6]=e=>C.value.documents_model_sub_id=e)},{default:s((({item:e})=>[r(u,{class:"input flex"},{default:s((()=>[r(u,{class:"flex-1 min-w-0"},{default:s((()=>[r(u,{class:"line-clamp-1"},{default:s((()=>[e.alias?(l(),t(k,{key:0},{default:s((()=>[v(j(e.alias),1)])),_:2},1024)):(l(),t(k,{key:1,class:"text-[#888]"},{default:s((()=>[v("请选择")])),_:1})),e.alias&&"0"==e.price?(l(),t(k,{key:2,class:"text-muted"},{default:s((()=>[v(" (免费) ")])),_:1})):e.alias?(l(),t(k,{key:3,class:"text-muted"},{default:s((()=>[v(" ("+j(`消耗${e.price}${b(i).getTokenUnit}/1000字符`)+") ",1)])),_:2},1024)):o("v-if",!0)])),_:2},1024)])),_:2},1024),C.value.documents_model_id?(l(),t(u,{key:0,class:"text-muted flex flex-none mx-[20rpx]",onClick:a[4]||(a[4]=R((e=>{C.value.documents_model_id="",C.value.documents_model_sub_id=""}),["stop"]))},{default:s((()=>[r(V,{name:"close-circle"})])),_:1})):o("v-if",!0),r(u,{class:"text-muted flex"},{default:s((()=>[r(V,{name:"arrow-down"})])),_:1})])),_:2},1024)])),_:1},8,["id","sub_id"])])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1})])),_:1}),r(u,{class:"flex p-[20rpx]"},{default:s((()=>[r(u,{class:"flex-1"},{default:s((()=>[r(S,{type:"primary",onClick:U},{default:s((()=>[v("保存")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-3fdd2ca2"]]),Ce=D(p({__name:"index",props:{tabIndex:null,currentIndex:null},setup(e){const a=q(),o=V({list:[{name:"全部知识库",type:0},{name:"我的知识库",type:1},{name:"共享给我",type:2}],current:0}),u=x(!1),d=x(),p=f(),_=S(),g=async(e,a)=>{var l,t;try{const{lists:t=[]}=await fe({page_size:a,page_no:e,type:o.current});null==(l=p.value)||l.complete(t)}catch(s){null==(t=p.value)||t.complete(!1)}},b=async()=>{if(!a.isLogin)return _.navigateTo("/pages/login/login");u.value=!0},h=()=>{B((()=>{p.value&&p.value.refresh()}))};return(e,a)=>{const f=n,x=m(c("u-image"),H),y=m(c("u-icon"),J),w=m(c("z-paging"),Q);return l(),t(f,{class:"content"},{default:s((()=>[r(w,{ref_key:"pagingRef",ref:p,modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),"auto-clean-list-when-reload":!1,onQuery:g,fixed:!1},{top:s((()=>[r(f,{class:"py-[20rpx] px-[20rpx]"},{default:s((()=>[r(f,{class:"bg-white p-[8rpx] flex rounded-[8rpx]"},{default:s((()=>[(l(!0),C(I,null,T(o.list,(e=>(l(),t(f,{key:e.type,class:i(["px-[9rpx] py-[14rpx] rounded-[8rpx] flex-1 text-center",{"tab-active":e.type==o.current}]),onClick:a=>{return l=e.type,o.current=l,void h();var l}},{default:s((()=>[v(j(e.name),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),default:s((()=>[r(f,{class:"grid grid-cols-2 gap-2 px-[20rpx]"},{default:s((()=>[(l(!0),C(I,null,T(d.value,(e=>(l(),t(f,{class:"bg-white rounded-lg overflow-hidden",key:e.id,onClick:a=>{return l=e.id,void _.navigateTo({path:`/packages/pages/kb_info/kb_info?id=${l}`});var l}},{default:s((()=>[r(f,{class:"flex relative"},{default:s((()=>[r(x,{class:"w-full",src:e.image,width:"100%",height:"272rpx"},null,8,["src"]),r(f,{class:"bg-[rgba(0,0,0,0.4)] text-white absolute px-[10rpx] py-[2rpx] right-[10rpx] bottom-[10rpx] rounded-[6rpx] flex items-center"},{default:s((()=>[r(y,{name:"man-add"}),r(f,{class:"ml-1 text-sm"},{default:s((()=>[v(j(e.team_people),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),r(f,{class:"p-[20rpx]"},{default:s((()=>[r(f,{class:"text-xl font-bold"},{default:s((()=>[v(j(null==e?void 0:e.name),1)])),_:2},1024),r(f,{class:"text-sm text-info mt-[24rpx] line-clamp-3"},{default:s((()=>[v(j((null==e?void 0:e.intro)||"这个知识库还没有介绍~"),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1},8,["modelValue"]),r(he,{onClick:b}),r(Ve,{modelValue:u.value,"onUpdate:modelValue":a[1]||(a[1]=e=>u.value=e),onClose:a[2]||(a[2]=()=>{u.value=!1,h()})},null,8,["modelValue"])])),_:1})}}}),[["__scopeId","data-v-3dd894b2"]]),je=p({__name:"add-popup",props:{modelValue:{type:Boolean}},emits:["update:modelValue","update"],setup(e,{emit:a}){const o=e,u=f(),i=_({get:()=>o.modelValue,set(e){a("update:modelValue",e)}}),d=x({image:"",name:"",avatar:""}),p={name:[{required:!0,message:"请输入形象名称"}],image:[{required:!0,message:"请选择形象封面"}],avatar:[{required:!0,message:"请选择形象头像"}]},k=()=>{u.value.validate((async e=>{if(e){const{id:e}=await xe(d.value);a("update"),i.value=!1,y.navigateTo({path:"/packages/pages/digital_setting/digital_setting",query:{id:e}})}}))};return g(i,(e=>{e&&(setTimeout((()=>{u.value.setRules(p)})),d.value={image:"",name:"",avatar:""})})),(e,a)=>{const o=n,p=m(c("u-input"),oe),f=m(c("u-form-item"),se),_=m(c("app-upload"),te),x=m(c("u-form"),ue),g=w,y=m(c("u-button"),re),V=m(c("u-popup"),ie);return l(),t(V,{modelValue:b(i),"onUpdate:modelValue":a[3]||(a[3]=e=>h(i)?i.value=e:null),"safe-area-inset-bottom":"",closeable:"","border-radius":"16",mode:"bottom"},{default:s((()=>[r(o,{class:"h-[70vh] flex flex-col"},{default:s((()=>[r(o,{class:"text-xl mx-[20rpx] py-[28rpx] font-bold border-b border-solid border-light border-0"},{default:s((()=>[v(" 新增形象 ")])),_:1}),r(o,{class:"flex-1 min-h-0"},{default:s((()=>[r(g,{class:"h-full","scroll-y":""},{default:s((()=>[r(o,{class:"p-[20rpx]"},{default:s((()=>[r(x,{model:d.value,ref_key:"uFormRef",ref:u,"label-position":"top","border-bottom":!1},{default:s((()=>[r(f,{label:"形象名称",prop:"name",required:""},{default:s((()=>[r(p,{modelValue:d.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value.name=e),placeholder:"请输入形象名称",border:!0},null,8,["modelValue"])])),_:1}),r(f,{label:"形象头像",prop:"avatar",required:""},{default:s((()=>[r(o,{class:"mx-[-10rpx] flex-1 min-w-0"},{default:s((()=>[r(_,{modelValue:d.value.avatar,"onUpdate:modelValue":a[1]||(a[1]=e=>d.value.avatar=e)},null,8,["modelValue"])])),_:1})])),_:1}),r(f,{label:"形象封面",prop:"image",required:""},{default:s((()=>[r(o,{class:"mx-[-10rpx] flex-1 min-w-0"},{default:s((()=>[r(_,{modelValue:d.value.image,"onUpdate:modelValue":a[2]||(a[2]=e=>d.value.image=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1})])),_:1}),r(o,{class:"flex p-[20rpx]"},{default:s((()=>[r(o,{class:"flex-1"},{default:s((()=>[r(y,{type:"primary",onClick:k},{default:s((()=>[v("保存")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])}}}),Ie=D(p({__name:"index",props:{tabIndex:null,currentIndex:null},setup(e,{expose:a}){const u=e,i=q(),d=x([]),p=f(),_=x(!1),h=x(!1),y=x(!1),w=S(),k=async()=>{if(!i.isLogin)return w.navigateTo("/pages/login/login");y.value=!0},V=async(e,a)=>{var l,t;try{const{lists:t=[]}=await ve({page_size:a,page_no:e});null==(l=p.value)||l.complete(t)}catch(s){null==(t=p.value)||t.complete(!1)}};return g((()=>u.currentIndex),(e=>{e===u.tabIndex&&(_.value||B((()=>{setTimeout((()=>{h.value=!0}),100)})))}),{immediate:!0}),a({reload:()=>{B((()=>{p.value&&p.value.refresh()}))}}),(e,a)=>{const u=n,i=m(c("u-image"),H),f=m(c("u-avatar"),_e),x=m(c("u-icon"),J),g=m(c("z-paging"),Q);return l(),t(u,{class:"content"},{default:s((()=>[o('  :enable-back-to-top="currentIndex===tabIndex" 在微信小程序上可以多加这一句，因为默认是允许点击返回顶部的，但是这个页面有多个scroll-view，会全部返回顶部，所以需要控制是当前index才允许点击返回顶部 '),o(" 如果当前页已经加载过数据或者当前切换到的tab是当前页，才展示当前页数据（懒加载） "),_.value||h.value?(l(),t(g,{key:0,ref_key:"pagingRef",ref:p,modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),"auto-clean-list-when-reload":!1,onQuery:V,fixed:!1},{default:s((()=>[o(" 如果希望其他view跟着页面滚动，可以放在z-paging标签内 "),r(u,{class:"px-[20rpx] pt-[30rpx]"},{default:s((()=>[r(u,{class:"flex flex-wrap mx-[-15rpx]"},{default:s((()=>[(l(!0),C(I,null,T(d.value,(e=>(l(),t(u,{class:"item w-[50%] px-[15rpx] mb-[30rpx]",key:e.id,onClick:a=>(e=>{e.is_disable||w.navigateTo({path:"/packages/pages/digital_setting/digital_setting",query:{id:e.id}})})(e)},{default:s((()=>[r(u,{class:"digital-item"},{default:s((()=>[e.is_disable?(l(),t(u,{key:0,class:"flex text-center items-center justify-center text-white absolute inset-0 bg-[rgba(0,0,0,0.5)] z-[100] text-xs"},{default:s((()=>[r(u,null,{default:s((()=>[v(" 该形象涉权违规，已禁用 "),A("br"),v(" 请重新创建形象 ")])),_:1})])),_:1})):o("v-if",!0),r(i,{src:e.image,width:"100%",height:"256rpx",mode:"aspectFill"},null,8,["src"]),r(u,{class:"digital-info"},{default:s((()=>[r(u,{class:"flex items-center"},{default:s((()=>[r(f,{size:70,src:e.avatar},null,8,["src"]),r(u,{class:"ml-[8rpx] line-clamp-1 flex-1 min-w-0 text-white"},{default:s((()=>[v(j(e.name),1)])),_:2},1024),r(u,{class:"p-[6rpx] bg-white rounded-[50%] flex items-center justify-center text-primary"},{default:s((()=>[r(x,{name:"arrow-right",size:20})])),_:1})])),_:2},1024)])),_:2},1024),r(u,{class:"absolute z-[10000] right-[20rpx] top-[20rpx] bg-white rounded-[50%] w-[40rpx] h-[40rpx] flex items-center justify-center",onClick:R((a=>(async e=>{const{cancel:a}=await $({title:"温馨提示",content:"确定删除？"});if(a)return;await ge({id:e});const l=d.value.findIndex((a=>a.id==e));d.value.splice(l,1)})(e.id)),["stop"])},{default:s((()=>[r(x,{name:"trash"})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1},8,["modelValue"])):o("v-if",!0),r(he,{onClick:k}),r(je,{modelValue:y.value,"onUpdate:modelValue":a[1]||(a[1]=e=>y.value=e),onUpdate:a[2]||(a[2]=e=>b(p).reload())},null,8,["modelValue"])])),_:1})}}}),[["__scopeId","data-v-7eb68fff"]]),ze=D(p({__name:"kb",setup(a){const u=V({list:[{name:"智能体应用",type:"robot"},{name:"知识库",type:"kb"},{name:"虚拟形象",type:"digital"}],current:0}),i=f(),d=e=>{u.current=e},p=e=>{u.current=e.detail.current};return W((()=>{setTimeout((()=>{var e;null==(e=i.value)||e.forEach((e=>{var a;null==(a=e.reload)||a.call(e)}))}))})),(a,f)=>{const _=m(c("page-meta"),e),x=m(c("u-tabs"),O),g=M,v=E,b=m(c("z-paging-swiper"),be),h=n,y=m(c("tabbar"),K);return l(),C(I,null,[r(_,{"page-style":a.$theme.pageStyle},null,8,["page-style"]),r(h,{class:"flex-1 min-h-0"},{default:s((()=>[r(b,{fixed:!1,"swiper-style":{height:"100%"}},{top:s((()=>[r(x,{"is-scroll":!1,ref:"tabs","active-color":a.$theme.primaryColor,list:u.list,current:u.current,onChange:d},null,8,["active-color","list","current"])])),default:s((()=>[r(v,{class:"h-full",current:u.current,onChange:p},{default:s((()=>[(l(!0),C(I,null,T(u.list,((e,a)=>(l(),t(g,{class:"swiper-item h-full",key:a},{default:s((()=>["robot"==e.type?(l(),t(ke,{key:0,ref_for:!0,ref_key:"tabsItemRef",ref:i,"tab-index":a,"current-index":u.current},null,8,["tab-index","current-index"])):o("v-if",!0),"kb"==e.type?(l(),t(Ce,{key:1,ref_for:!0,ref_key:"tabsItemRef",ref:i,"tab-index":a,"current-index":u.current},null,8,["tab-index","current-index"])):o("v-if",!0),"digital"==e.type?(l(),t(Ie,{key:2,ref_for:!0,ref_key:"tabsItemRef",ref:i,"tab-index":a,"current-index":u.current},null,8,["tab-index","current-index"])):o("v-if",!0)])),_:2},1024)))),128))])),_:1},8,["current"])])),_:1})])),_:1}),r(y)],64)}}}),[["__scopeId","data-v-cc34a169"]]);export{ze as default};
