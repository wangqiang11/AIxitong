import{_ as e}from"./page-meta.d751427a.js";import{d as l,s as a,r as t,a as s,o as n,c as u,w as o,b as r,O as d,b1 as i,j as c,J as p,B as m,t as f,p as A,f as x,V as g,e as v,g as h,k as b,F as _,l as y,a7 as w,m as k,C,P as V,K as B,D as E,aX as I,ab as U,Q as S,U as Q,i as K,b2 as j,a8 as F,u as D,ay as z,W as Y,h as R,z as q,A as L,$ as T,b3 as M,ae as P,aB as O}from"./index-d6d2a33a.js";import{_ as J}from"./u-navbar.d70905ec.js";import{_ as H}from"./u-tabs.f14aec5a.js";import{_ as X}from"./u-search.7e682473.js";import{_ as G}from"./u-tag.fd761889.js";import{_ as N}from"./u-icon.992584aa.js";import{_ as Z}from"./z-paging.6c8c2edf.js";import{_ as W}from"./u-input.e3cf3beb.js";import{_ as $}from"./u-modal.793c614f.js";import{_ as ee}from"./u-button.97a3d07f.js";import{_ as le}from"./u-popup.21776ef7.js";import{_ as ae}from"./u-loading.d153dd1a.js";import{_ as te}from"./uni-file-picker.87d7f36a.js";import{_ as se}from"./_plugin-vue_export-helper.1b428a4d.js";import{r as ne,a as ue,b as oe,c as re,d as de}from"./fileReader.617b57ea.js";import{u as ie}from"./index.3dd6f2ef.js";import{u as ce}from"./useLockFn.3b1f86f9.js";import{b as pe,f as me,w as fe,c as Ae,d as xe,e as ge,h as ve,i as he,j as be,k as _e,p as ye,t as we,l as ke,m as Ce,n as Ve}from"./kb.9f6bd434.js";import{_ as Be}from"./u-line-progress.6067a85b.js";import{_ as Ee}from"./app-upload.vue_vue_type_script_setup_true_lang.13b099e0.js";import{_ as Ie}from"./app-select.66776d41.js";import{_ as Ue}from"./model-picker.594cca17.js";import{_ as Se}from"./u-image.9574760c.js";import{_ as Qe,a as Ke}from"./u-radio-group.5e4decfb.js";import{_ as je}from"./u-action-sheet.29883fbc.js";import{_ as Fe}from"./u-checkbox.0fdc3635.js";import"./u-badge.f9b9ebb9.js";import"./emitter.1571a5d9.js";import"./_commonjsHelpers.157f59fb.js";import"./index.ccff8ee2.js";import"./index.22b2ad12.js";import"./uv-popup.0236847c.js";import"./mixin.91a2f735.js";import"./isString.6d1f126a.js";import"./u-collapse.5c69f838.js";var De=(e=>(e[e.DOC=1]="DOC",e[e.CVS=3]="CVS",e[e.QASplit=2]="QASplit",e[e.WEB_PAGE=4]="WEB_PAGE",e))(De||{});const ze=(e,l)=>new Promise(((a,t)=>{-1==l.findIndex((({name:l,lastModified:a,size:t})=>l===e.name&&t===e.size&&a==e.lastModified))?a(""):t("请勿选择相同文件！")})),Ye=se(l({__name:"app-file-picker",props:{fileExtname:{default:""}},emits:["importFile"],setup(e,{emit:l}){const p=e,m=a([]),f=e=>{if(p.fileExtname&&p.fileExtname.length>0){const l=e.tempFiles||[];for(const e of l){const l=e.name||"",a=l.substring(l.lastIndexOf(".")).toLowerCase();if(!p.fileExtname.includes(a))return void i({title:"不支持该文件类型",icon:"none"})}}l("importFile",e),m.value=[]};return(e,l)=>{const a=t(s("uni-file-picker"),te),i=c;return n(),u(i,null,{default:o((()=>[r(a,{modelValue:m.value,"onUpdate:modelValue":l[0]||(l[0]=e=>m.value=e),limit:"50","file-mediatype":"all",onProgress:e.onProgress,onSelect:f,mode:"list","del-icon":!0,"list-styles":{display:"none"}},{default:o((()=>[d(e.$slots,"default",{},void 0,!0)])),_:3},8,["modelValue","onProgress"])])),_:3})}}}),[["__scopeId","data-v-a6c1f1f1"]]),Re=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),qe=e=>{let{text:l="",chunkLen:a,overlapRatio:t=.2,customReg:s=[]}=e;const n="SPLIT_HERE_SPLIT_HERE",u="CODE_BLOCK_LINE_MARKER",o=Math.round(a*t);l=l.replace(/(```[\s\S]*?```|~~~[\s\S]*?~~~)/g,(function(e){return e.replace(/\n/g,u)})),l=l.replace(/(\r?\n|\r){3,}/g,"\n\n\n");const r=[...s.map((e=>({reg:new RegExp(`(${Re(e)})`,"g"),maxLen:1.4*a}))),{reg:/^(#\s[^\n]+)\n/gm,maxLen:1.2*a},{reg:/^(##\s[^\n]+)\n/gm,maxLen:1.2*a},{reg:/^(###\s[^\n]+)\n/gm,maxLen:1.2*a},{reg:/^(####\s[^\n]+)\n/gm,maxLen:1.2*a},{reg:/([\n]([`~]))/g,maxLen:4*a},{reg:/([\n](?!\s*[\*\-|>0-9]))/g,maxLen:2*a},{reg:/([\n])/g,maxLen:1.2*a},{reg:/([。]|([a-zA-Z])\.\s)/g,maxLen:1.2*a},{reg:/([！]|!\s)/g,maxLen:1.2*a},{reg:/([？]|\?\s)/g,maxLen:1.4*a},{reg:/([；]|;\s)/g,maxLen:1.6*a},{reg:/([，]|,\s)/g,maxLen:2*a}],d=s.length,i=e=>e<d,c=e=>e>=d&&e<=4+d,p=({text:e,step:l})=>{if(l>=r.length)return[{text:e,title:""}];const a=i(l),t=(e=>e>=d&&e<=3+d)(l),s=c(l),{reg:u}=r[l];return e.replace(u,a?n:s?`${n}$1`:`$1${n}`).split(`${n}`).filter((e=>e.trim())).map((e=>{var l;const a=t&&(null==(l=e.match(u))?void 0:l[0])||"";return{text:t?e.replace(a,""):e,title:a}})).filter((e=>e.text.trim()))},m=({text:e,step:l})=>{const t=(e=>e<=6+d)(l),s=.4*a;if(t||0===o||l>=r.length)return"";const n=p({text:e,step:l});let u="";for(let a=n.length-1;a>=0;a--){const e=n[a].text+u,t=e.length;if(t>o){if(t>s){return m({text:e,step:l+1})||u}return e}u=e}return u},f=({text:e="",step:l,lastText:t,mdTitle:s=""})=>{const n=c(l),u=i(l);if(l>=r.length){if(e.length<3*a)return[e];const l=[];for(let t=0;t<e.length;t+=a-o)l.push(`${s}${e.slice(t,t+a)}`);return l}const d=p({text:e,step:l}),A=d.length>1?r[l].maxLen:a,x=.7*a,g=[];for(let o=0;o<d.length;o++){const e=d[o],r=`${s}${e.title}`,i=e.text,c=i.length,p=t.length,v=t+i,h=p+c;if(h>A){if(p>x){g.push(`${r}${t}`),t=m({text:t,step:l}),o--;continue}const e=f({text:v,step:l+1,lastText:"",mdTitle:r}),a=e[e.length-1];!n&&a.length<x?(g.push(...e.slice(0,-1)),t=a):(g.push(...e),t=m({text:a,step:l}))}else t=v,(u||n&&h>30||h>=a)&&(g.push(`${r}${t}`),t=m({text:t,step:l}))}return t&&g[g.length-1]&&!g[g.length-1].endsWith(t)?t.length<.4*a?g[g.length-1]=g[g.length-1]+t:g.push(`${s}${t}`):t&&0===g.length&&g.push(t),g};try{const e=f({text:l,step:0,lastText:"",mdTitle:""}).map((e=>(null==e?void 0:e.replaceAll(u,"\n"))||"")),a=e.reduce(((e,l)=>e+l.length),0);return{chunks:e,chars:a}}catch(A){throw new Error(A)}},Le=e=>{const{text:l=""}=e,a=l.split("-----CUSTOM_SPLIT_SIGN-----").map((l=>(e=>{if(!e.includes("|"))return!1;const l=e.split("\n");if(l.length<2)return!1;const a=l[0].trim();if(!a.startsWith("|")||!a.endsWith("|"))return!1;const t=l[1].trim();if(!/^(\|[\s:]*-+[\s:]*)+\|$/.test(t))return!1;for(let s=2;s<l.length;s++){const e=l[s].trim();if(e&&(!e.startsWith("|")||!e.endsWith("|")))return!1}return!0})(l)?(e=>{const{text:l="",chunkLen:a}=e,t=l.split("\n"),s=t[0],n=s.split("|").length-2,u=`| ${new Array(n>0?n:1).fill(0).map((()=>"---")).join(" | ")} |`,o=[];let r=`${s}\n${u}\n`;for(let d=2;d<t.length;d++)r.length+t[d].length>1.2*a&&(o.push(r),r=`${s}\n${u}\n`),r+=`${t[d]}\n`;return r&&o.push(r),{chunks:o,chars:o.reduce(((e,l)=>e+l.length),0)}})(e):qe(e)));return a.map((e=>e.chunks)).flat()},Te=l({__name:"data-item",props:{index:null,name:null,data:null},emits:["delete","update:data"],setup(e,{emit:l}){const d=p(),i=a(!1),v=async()=>{i.value=!0,await g(),d.value.focus()},h=e=>{l("update:data",e.target.innerText)};return(a,p)=>{const g=t(s("u-icon"),N),b=c;return n(),u(b,null,{default:o((()=>[r(b,{class:"flex items-center"},{default:o((()=>[m("span",{class:"bg-white px-4 rounded"}," #"+f(e.index+1),1),m("span",{class:"mx-2 text-[#000] flex-1 line-clamp-1"},f(e.name),1),r(b,{class:"p-[6rpx] text-content",onClick:A(v,["stop"])},{default:o((()=>[r(g,{name:"edit-pen",size:"28"})])),_:1},8,["onClick"]),r(b,{class:"p-[6rpx] text-content",onClick:p[0]||(p[0]=A((e=>l("delete")),["stop"]))},{default:o((()=>[r(g,{name:"trash-fill",size:"28"})])),_:1})])),_:1}),r(b,{ref_key:"editRef",ref:d,class:"mt-2 whitespace-pre-line",contenteditable:i.value,onInput:h},{default:o((()=>[x(f(e.data),1)])),_:1},8,["contenteditable"])])),_:1})}}}),Me=se(l({__name:"doc",props:{modelValue:null},emits:["update:modelValue"],setup(e,{emit:l}){const d=ie(e,"modelValue",l),i=a([]),p=[".txt",".docx",".pdf",".md"];p.join(", ");const m=a(-1),{lockFn:g,isLock:C}=ce((async e=>{const l=e.tempFiles.map((async e=>{await(async e=>{try{await ze(e,i.value);const l=await B(e);if(!l)throw"解析结果为空，已自动忽略";d.value.push({name:e.name,path:"",data:[]}),e.data=l,i.value.push(e),I(i.value.length-1),V()}catch(l){console.log(l)}})(e.file)}));await Promise.all(l)})),V=()=>{d.value.forEach((e=>{e.data=[];const l=i.value.findIndex((l=>l.name==e.name));Le({text:i.value[l].data,chunkLen:E.value}).forEach((l=>{e.data.push({q:l,a:""})}))}))},B=async e=>{let l="";switch(e.name.substring(e.name.lastIndexOf(".")+1)){case"md":case"txt":default:l=await ne(e);break;case"pdf":l=await oe(e);break;case"doc":case"docx":l=await ue(e)}return l},E=a(512),I=e=>{m.value=e};return(e,l)=>{const a=c,B=t(s("u-loading"),ae),U=t(s("app-file-picker"),Ye),S=t(s("u-icon"),N),Q=w;return n(),u(a,null,{default:o((()=>[r(a,{class:"mt-2"},{default:o((()=>[r(U,{onImportFile:v(g),fileExtname:p},{default:o((()=>[r(a,{class:"text-center py-[100rpx] rounded-lg border border-dashed border-info bg-[#FCFCFC] relative"},{default:o((()=>[r(a,null,{default:o((()=>[x("选择文件")])),_:1}),r(a,null,{default:o((()=>[x("支持 .txt ,.docx ,.pdf ,.md文件")])),_:1}),v(C)?(n(),u(a,{key:0,class:"absolute inset-0 flex justify-center items-center bg-[rgba(0,0,0,0.4)]"},{default:o((()=>[r(B,{size:50,color:e.$theme.primaryColor},null,8,["color"])])),_:1})):h("v-if",!0)])),_:1})])),_:1},8,["onImportFile"])])),_:1}),v(d).length>0?(n(),b(_,{key:0},[r(a,{class:"mt-2"},{default:o((()=>[r(a,{class:"py-[20rpx] font-bold"},{default:o((()=>[x("文件（"+f(v(d).length)+"）",1)])),_:1}),r(a,{class:"px-[10rpx] py-[15rpx]"},{default:o((()=>[(n(!0),b(_,null,y(v(d),((e,l)=>(n(),u(a,{key:l,class:k(["fileItem flex items-center p-2 rounded-lg mt-1 hover:cursor-pointer bg-page transition duration-300",{"bg-page border border-solid border-primary rounded-lg":m.value==l}]),onClick:e=>I(l)},{default:o((()=>[r(a,{class:"ml-2"},{default:o((()=>[x(f(e.name),1)])),_:2},1024),r(a,{class:"ml-auto flex items-center",onClick:A((e=>(e=>{d.value.splice(e,1),i.value.splice(e,1)})(l)),["stop"])},{default:o((()=>[r(S,{name:"trash-fill",color:"#2979ff",size:"28"})])),_:2},1032,["onClick"])])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),r(a,{class:"mt-2"},{default:o((()=>[r(a,{class:"py-[20rpx] font-bold"},{default:o((()=>[x("文件长度")])),_:1}),r(a,{class:"px-[10rpx] py-[15rpx] border border-solid border-[#DCDFE6] rounded-lg"},{default:o((()=>[r(Q,{onInput:V,modelValue:E.value,"onUpdate:modelValue":l[0]||(l[0]=e=>E.value=e)},null,8,["modelValue"])])),_:1})])),_:1}),h(' <view\n                class="my-[40rpx] comsume py-[15rpx] text-center text-[#F7A40A]"\n            >\n                预计消耗：0.033积分\n            </view> '),r(a,null,{default:o((()=>[r(a,{class:"py-[20rpx] font-bold"},{default:o((()=>{var e;return[x("结果预览（"+f(null==(e=v(d)[m.value])?void 0:e.data.length)+"组）",1)]})),_:1}),r(a,{class:"px-[10rpx] pb-[20rpx]"},{default:o((()=>{var e;return[(n(!0),b(_,null,y(null==(e=v(d)[m.value])?void 0:e.data,((e,l)=>(n(),u(a,{class:"bg-page rounded p-[10px] mt-2",key:l},{default:o((()=>[r(Te,{index:l,name:v(d)[m.value].name,data:e.q,"onUpdate:data":l=>e.q=l,onDelete:e=>(async e=>{d.value[m.value].data.splice(e,1)})(l)},null,8,["index","name","data","onUpdate:data","onDelete"])])),_:2},1024)))),128))]})),_:1})])),_:1})],64)):h("v-if",!0)])),_:1})}}}),[["__scopeId","data-v-eb1c5d30"]]),Pe=l({__name:"cvs-data-item",props:{index:null,name:null,q:null,a:null},emits:["delete","update:q","update:a"],setup(e,{emit:l}){const d=p(),i=a(!1),v=async()=>{i.value=!0,await g(),d.value.focus()};return(a,p)=>{const g=t(s("u-icon"),N),b=c;return n(),u(b,null,{default:o((()=>[r(b,{class:"flex items-center"},{default:o((()=>[m("span",{class:"bg-white px-4 rounded"}," #"+f(e.index+1),1),m("span",{class:"mx-2 text-[#000] flex-1 line-clamp-1"},f(e.name),1),r(b,{class:"p-[6rpx] text-content",onClick:A(v,["stop"])},{default:o((()=>[r(g,{name:"edit-pen",size:"28"})])),_:1},8,["onClick"]),r(b,{class:"p-[6rpx] text-content",onClick:p[0]||(p[0]=A((e=>l("delete")),["stop"]))},{default:o((()=>[r(g,{name:"trash-fill",size:"28"})])),_:1})])),_:1}),r(b,{class:"mt-2"},{default:o((()=>[r(b,{class:"whitespace-pre-line"},{default:o((()=>[x(" q: "),m("span",{ref_key:"editRef",ref:d,contenteditable:i.value,onInput:p[1]||(p[1]=e=>l("update:q",e.target.innerText))},f(e.q),41,["contenteditable"])])),_:1}),r(b,{class:"whitespace-pre-line"},{default:o((()=>[x(" a: "),m("span",{contenteditable:i.value,onInput:p[2]||(p[2]=e=>l("update:a",e.target.innerText))},f(e.a),41,["contenteditable"])])),_:1})])),_:1}),h("        <view"),h('            ref="editRef"'),h('            class="mt-2 whitespace-pre-line"'),h('            :contenteditable="isEdit"'),h('            @input="handleDataChange"'),h("        >"),h("            {{ data }}"),h("        </view>")])),_:1})}}}),Oe=se(l({__name:"csv",props:{modelValue:null},emits:["update:modelValue"],setup(e,{emit:l}){const d=ie(e,"modelValue",l),i=a([]),p=[".csv",".xlsx"];p.join(", ");const m=a(-1),{lockFn:g,isLock:w}=ce((async e=>{const l=e.tempFiles.map((async e=>{await(async e=>{try{await ze(e,i.value);const l=await C(e);if(!l)throw"解析结果为空，已自动忽略";console.log(l),d.value.push({name:e.name,path:"",data:l}),e.data=l,i.value.push(e),console.log(d.value),V(i.value.length-1)}catch(l){console.log(l)}})(e.file)}));await Promise.all(l)})),C=async e=>{let l="";switch(e.name.substring(e.name.lastIndexOf(".")+1)){case"csv":l=await de(e);break;case"xlsx":l=await re(e)}return l};a(512);const V=e=>{m.value=e};return(e,l)=>{const a=c,C=t(s("u-loading"),ae),B=t(s("app-file-picker"),Ye),E=t(s("u-icon"),N);return n(),u(a,null,{default:o((()=>[r(a,{class:"mt-2"},{default:o((()=>[r(B,{onImportFile:v(g),fileExtname:p},{default:o((()=>[r(a,{class:"text-center py-[100rpx] rounded-lg border border-dashed border-info bg-[#FCFCFC] relative"},{default:o((()=>[r(a,null,{default:o((()=>[x("选择文件")])),_:1}),r(a,null,{default:o((()=>[x("支持 .csv,.xlsx文件")])),_:1}),v(w)?(n(),u(a,{key:0,class:"absolute inset-0 flex justify-center items-center bg-[rgba(0,0,0,0.4)]"},{default:o((()=>[r(C,{size:50,color:e.$theme.primaryColor},null,8,["color"])])),_:1})):h("v-if",!0)])),_:1})])),_:1},8,["onImportFile"])])),_:1}),v(d).length>0?(n(),b(_,{key:0},[r(a,{class:"mt-2"},{default:o((()=>[r(a,{class:"py-[20rpx] font-bold"},{default:o((()=>[x("文件（"+f(v(d).length)+"）",1)])),_:1}),r(a,{class:"px-[10rpx] py-[15rpx]"},{default:o((()=>[(n(!0),b(_,null,y(v(d),((e,l)=>(n(),u(a,{key:l,class:k(["fileItem flex items-center p-2 rounded-lg mt-1 hover:cursor-pointer bg-page transition duration-300",{"bg-page border border-solid border-primary rounded-lg":m.value==l}]),onClick:e=>V(l)},{default:o((()=>[r(a,{class:"ml-2"},{default:o((()=>[x(f(e.name),1)])),_:2},1024),r(a,{class:"ml-auto flex items-center",onClick:A((e=>(e=>{d.value.splice(e,1),i.value.splice(e,1)})(l)),["stop"])},{default:o((()=>[r(E,{name:"trash-fill",color:"#2979ff",size:"28"})])),_:2},1032,["onClick"])])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),h(' <view\n                class="my-[40rpx] comsume py-[15rpx] text-center text-[#F7A40A]"\n            >\n                预计消耗：0.033积分\n            </view> '),r(a,null,{default:o((()=>[r(a,{class:"py-[20rpx] font-bold"},{default:o((()=>{var e;return[x("结果预览（"+f(null==(e=v(d)[m.value])?void 0:e.data.length)+"组）",1)]})),_:1}),r(a,{class:"px-[10rpx] pb-[20rpx]"},{default:o((()=>{var e;return[(n(!0),b(_,null,y(null==(e=v(d)[m.value])?void 0:e.data,((e,l)=>(n(),u(a,{class:"bg-page rounded p-[10px] mt-2",key:l},{default:o((()=>[r(Pe,{index:l,name:v(d)[m.value].name,q:e.q,"onUpdate:q":l=>e.q=l,a:e.a,"onUpdate:a":l=>e.a=l,onDelete:e=>(async e=>{d.value[m.value].data.splice(e,1)})(l)},null,8,["index","name","q","onUpdate:q","a","onUpdate:a","onDelete"])])),_:2},1024)))),128))]})),_:1})])),_:1})],64)):h("v-if",!0)])),_:1})}}}),[["__scopeId","data-v-34d28d7b"]]),Je=a(),He=a(),Xe=a(""),Ge=()=>{const e=async()=>{Je.value=await pe({id:He.value}),Xe.value=Je.value.name};return{KBInfo:Je,KBId:He,setKBId:e=>{He.value=Number(e)},getKBInfo:e,reset:()=>{He.value=0,Xe.value=""},KBName:Xe,importData:async l=>{await me(l),e()}}},Ne=se(l({__name:"QASplit",props:{modelValue:null},emits:["update:modelValue"],setup(e,{emit:l}){const d=e,{KBInfo:i}=Ge(),p=ie(d,"modelValue",l),m=a([]),g=[".txt",".docx",".pdf",".md"];g.join(", ");const w=a(-1),{lockFn:C,isLock:V}=ce((async e=>{const l=e.tempFiles.map((async e=>{await(async e=>{try{await ze(e,m.value);const l=await E(e);if(!l)throw"解析结果为空，已自动忽略";p.value.push({name:e.name,path:"",data:[]}),e.data=l,m.value.push(e),I(m.value.length-1),B()}catch(l){console.log(l)}})(e.file)}));await Promise.all(l)})),B=()=>{p.value.forEach((e=>{e.data=[];const l=m.value.findIndex((l=>l.name==e.name));Le({text:m.value[l].data,chunkLen:i.value.qa_length}).forEach((l=>{e.data.push({q:l,a:""})}))}))},E=async e=>{let l="";switch(e.name.substring(e.name.lastIndexOf(".")+1)){case"md":case"txt":default:l=await ne(e);break;case"pdf":l=await oe(e);break;case"doc":case"docx":l=await ue(e)}return l},I=e=>{w.value=e};return(e,l)=>{const a=c,d=t(s("u-loading"),ae),i=t(s("app-file-picker"),Ye),B=t(s("u-icon"),N);return n(),u(a,null,{default:o((()=>[r(a,{class:"mt-2"},{default:o((()=>[r(i,{onImportFile:v(C),fileExtname:g},{default:o((()=>[r(a,{class:"text-center py-[100rpx] rounded-lg border border-dashed border-info bg-[#FCFCFC] relative"},{default:o((()=>[r(a,null,{default:o((()=>[x("选择文件")])),_:1}),r(a,null,{default:o((()=>[x("支持 .txt,.docx ,.pdf ,.md文件")])),_:1}),v(V)?(n(),u(a,{key:0,class:"absolute inset-0 flex justify-center items-center bg-[rgba(0,0,0,0.4)]"},{default:o((()=>[r(d,{size:50,color:e.$theme.primaryColor},null,8,["color"])])),_:1})):h("v-if",!0)])),_:1})])),_:1},8,["onImportFile"])])),_:1}),v(p).length>0?(n(),b(_,{key:0},[r(a,{class:"mt-2"},{default:o((()=>[r(a,{class:"py-[20rpx] font-bold"},{default:o((()=>[x("文件（"+f(v(p).length)+"）",1)])),_:1}),r(a,{class:"px-[10rpx] py-[15rpx]"},{default:o((()=>[(n(!0),b(_,null,y(v(p),((e,l)=>(n(),u(a,{key:l,class:k(["fileItem flex items-center p-2 rounded-lg mt-1 hover:cursor-pointer bg-page transition duration-300",{"bg-page border border-solid border-primary rounded-lg":w.value==l}]),onClick:e=>I(l)},{default:o((()=>[r(a,{class:"ml-2"},{default:o((()=>[x(f(e.name),1)])),_:2},1024),r(a,{class:"ml-auto flex items-center",onClick:A((e=>(e=>{p.value.splice(e,1),m.value.splice(e,1)})(l)),["stop"])},{default:o((()=>[r(B,{name:"trash-fill",color:"#2979ff",size:"28"})])),_:2},1032,["onClick"])])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),h(' <view\n                class="my-[40rpx] comsume py-[15rpx] text-center text-[#F7A40A]"\n            >\n                预计消耗：0.033积分\n            </view> '),r(a,null,{default:o((()=>[r(a,{class:"py-[20rpx] font-bold"},{default:o((()=>{var e;return[x("结果预览（"+f(null==(e=v(p)[w.value])?void 0:e.data.length)+"组）",1)]})),_:1}),r(a,{class:"px-[10rpx] pb-[20rpx]"},{default:o((()=>{var e;return[(n(!0),b(_,null,y(null==(e=v(p)[w.value])?void 0:e.data,((e,l)=>(n(),u(a,{class:"bg-page rounded p-[10px] mt-2",key:l},{default:o((()=>[r(Te,{index:l,name:v(p)[w.value].name,data:e.q,"onUpdate:data":l=>e.q=l,onDelete:e=>(async e=>{p.value[w.value].data.splice(e,1)})(l)},null,8,["index","name","data","onUpdate:data","onDelete"])])),_:2},1024)))),128))]})),_:1})])),_:1})],64)):h("v-if",!0)])),_:1})}}}),[["__scopeId","data-v-4aa1254f"]]),Ze=l({__name:"web-page",props:{modelValue:null},emits:["update:modelValue"],setup(e,{emit:l}){const d=ie(e,"modelValue",l),i=a(""),{lockFn:p,isLock:m}=ce((async()=>{if(!i.value)return uni.$u.toast("请输入网页链接");const e=await fe({url:i.value.split("\n").filter(Boolean)});d.value=[...e.map((e=>({data:[{a:"",q:e.content}],path:"",name:e.url}))),...d.value],i.value=""}));return(e,l)=>{const a=t(s("u-input"),W),A=c,g=t(s("u-button"),ee),w=t(s("u-icon"),N);return n(),u(A,{class:"web-page"},{default:o((()=>[r(A,{class:"py-[20rpx]"},{default:o((()=>[r(A,{class:"flex-1"},{default:o((()=>[h(' <el-input\n                            v-model="url"\n                            :placeholder="`请输入要解析的网页链接，添加多个请按回车键分隔`"\n                            type="textarea"\n                            resize="none"\n                            :rows="6"\n                        /> '),r(a,{modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=e=>i.value=e),type:"textarea",maxlength:-1,border:"",height:200,"auto-height":!1,placeholder:"请输入要解析的网页链接，添加多个请按回车键分隔"},null,8,["modelValue"])])),_:1}),r(A,{class:"inline-flex mt-[20rpx]"},{default:o((()=>[r(g,{type:"primary",loading:v(m),onClick:v(p),customStyle:{width:"180rpx"}},{default:o((()=>[x(" 解析 ")])),_:1},8,["loading","onClick"])])),_:1}),r(A,null,{default:o((()=>[(n(!0),b(_,null,y(v(d),((e,l)=>(n(),u(A,{key:l,class:"mt-[20rpx]"},{default:o((()=>[r(A,{class:"mb-[10rpx] font-medium text-lg"},{default:o((()=>[x(" #"+f(l+1)+" "+f(e.name)+" ",1),r(w,{class:"text-muted ml-[20rpx]",name:"trash",onClick:l=>(async e=>{const l=d.value.indexOf(e);-1!==l&&d.value.splice(l,1)})(e)},null,8,["onClick"])])),_:2},1024),(n(!0),b(_,null,y(e.data,((e,l)=>(n(),u(a,{key:l,modelValue:e.q,"onUpdate:modelValue":l=>e.q=l,type:"textarea",maxlength:-1,border:"",height:300,"auto-height":!1,placeholder:"文件内容，空内容会自动省略"},null,8,["modelValue","onUpdate:modelValue"])))),128))])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})}}}),We=se(l({__name:"fileImport",props:{modelValue:{type:Boolean}},emits:["update:modelValue","close"],setup(e,{emit:l}){const d=e,{importData:i,KBId:p}=Ge(),m=C({get:()=>d.modelValue,set(e){Q(),l("update:modelValue",e)}}),A=a(0),g=a([]),w=a([]),I=a([]),U=a([]),S=C((()=>B([{name:"文档导入",type:De.DOC,describe:"选择文本文件，直接将其按分段进行处理",show:!0,data:g},{name:"问答对导入",type:De.CVS,describe:"批量导入问答对，效果最佳",show:!0,data:w},{name:"自动拆分问答对",type:De.QASplit,describe:"选择文本文件，让大模型自动生成问答对",show:!0,data:I},{name:"网页解析",type:De.WEB_PAGE,describe:"输入网页链接，快速导入内容",show:!0,data:U}]).filter((({show:e})=>e)))),Q=()=>{var e;e=S.value[0].type,A.value=e},K=C((()=>{var e;return null==(e=S.value.find((({type:e})=>e===A.value)))?void 0:e.data})),j=async()=>{const e=S.value.find((({type:e})=>e===A.value)),{data:a,type:t}=e;console.log(a,t);const s={kb_id:p.value,method:t,documents:a};await i({...s}),l("close")};return(e,l)=>{const a=c,d=E,i=t(s("u-button"),ee),p=t(s("u-popup"),le);return n(),u(p,{modelValue:v(m),"onUpdate:modelValue":l[4]||(l[4]=e=>V(m)?m.value=e:null),"safe-area-inset-bottom":"",closeable:"","border-radius":"16",mode:"bottom"},{default:o((()=>[r(a,{class:"h-[80vh] flex flex-col"},{default:o((()=>[r(a,{class:"text-xl py-[28rpx] font-bold border-b border-solid border-light border-0 mx-[20rpx]"},{default:o((()=>[x(" 文件导入 ")])),_:1}),r(a,{class:"flex-1 min-h-0"},{default:o((()=>[r(d,{"scroll-y":"",class:"h-full"},{default:o((()=>[r(a,{class:"mx-[20rpx]"},{default:o((()=>[r(a,null,{default:o((()=>[(n(!0),b(_,null,y(v(S),((e,l)=>(n(),u(a,{key:l,class:k(["rounded-lg border border-solid border-[#E2E6EA] p-[30rpx] mt-2",{isSelect:e.type==A.value}]),onClick:l=>A.value=e.type},{default:o((()=>[r(a,null,{default:o((()=>[x(f(e.name),1)])),_:2},1024),r(a,{class:"text-info text-xs mt-[10rpx]"},{default:o((()=>[x(f(e.describe),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1}),r(a,{class:"flex-1"},{default:o((()=>[v(De).DOC==A.value?(n(),u(Me,{key:0,modelValue:v(K),"onUpdate:modelValue":l[0]||(l[0]=e=>V(K)?K.value=e:null)},null,8,["modelValue"])):h("v-if",!0),v(De).CVS==A.value?(n(),u(Oe,{key:1,modelValue:v(K),"onUpdate:modelValue":l[1]||(l[1]=e=>V(K)?K.value=e:null)},null,8,["modelValue"])):h("v-if",!0),v(De).QASplit==A.value?(n(),u(Ne,{key:2,modelValue:v(K),"onUpdate:modelValue":l[2]||(l[2]=e=>V(K)?K.value=e:null)},null,8,["modelValue"])):h("v-if",!0),v(De).WEB_PAGE==A.value?(n(),u(Ze,{key:3,modelValue:v(K),"onUpdate:modelValue":l[3]||(l[3]=e=>V(K)?K.value=e:null)},null,8,["modelValue"])):h("v-if",!0)])),_:1})])),_:1})])),_:1})])),_:1}),r(a,{class:"p-[20rpx]"},{default:o((()=>[r(i,{onClick:j,type:"primary"},{default:o((()=>[x(" 确认导入 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-3d995c30"]]),$e=l({__name:"dataStudy",setup(e){const{KBId:l,KBInfo:d}=Ge(),i=a(!1),m=a(),g=a([]),w=p(),k={doc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAFuUlEQVR4nO2bf0yUdRzHP88JxwlsHHMCLQ3ULawJcWghNhxmllbYOa0t02FrljPbXFauzcXp/KNZTFu1kf2RrKytaJCwRTaKhCL7w+OHY4IDFKEghncwfv+4p8/7oQfujnsODu4unuNe28N9nu+P5/t8Xt/v831uMASaAYvFkjA2Lpzl0MiHX7jR1GrT6bQVIbZBo8FgsHKRz3ArgJPXj44LZm6UQH6k/uYtAqEhIXeXhoyu8aUEgQ9FurosmSQIv3DoV2QBwNcSZhJgYgE5HPoVewHAlxJUIQD4SoJqBABfSFCVAOBtCaoTALwpQZUCgLckqFYA8IYEVQsA85WgegFgPhICQgCYq4SAEQDmIiGgBABPJQScAOCJhIAUAGYrYUEKuNnSRqNjYxzNj7DQkLaNG9at5FCRBSmgq9tKXXfdTtysiVgalrMh5YFTHLpkQQoAkNDbP0DDwyN8Nnd0Ydr8tNQHD5ACC1aA1xDFLcuXR5eTAkEBfCgSFBAUEBRgCgpYzAKq61veuzcm+jiHqqWm8U7W45uSSjh0iaIAXeqhA09vXpedd2JfJqmYp458mF/X+Hf50LW8C+QClwKQvI1sn2dtTi4PBAE1je3ZGtK85ErCNAFy8hxSIAngkFxJcBBgnzwINAHAWcKkAOfkQSAIWP/C6d86unsf5XASewmSgPCt558ZH2g9xqEDDyev1WesT0zhULVcLKms7OzqnvbLhSXh9+UOlL1SIgnQbb9oEkWVv+89RBDEk0OlL5qCAjj+XwRsTo6h5NV6johqm610pfYfjpR5aE00ZSQtp57+Ubrd2T9j+5mYtwAkcPnMVo4cud3ZR1/81EIfFzWQtW+USxzZuWkFvf+qgeJjI/lsCvQ7mHt1WmJI/PwbadKnPVdqO6X2kDEXvCagp3+EapqsXEKcVIR0gJomCz15vMxBgtwH1DZb6NLvbaSP1FJW+orJfk+8XcbJTUjQR4bSjQs7+VMrjYNya9+IJDEqQutyjNniNQG4Kdy0DBL5NieDl3c0r4RmaZZkGvKzuD6STn9Zx8d1Lpnis2NptH/bap7RPkrMLuaSqTLIeu5kBddNzDbEYGyM8dan1+ijwgYu9QyfCQCQ0JC/kyOiuD0F0gzt37aKE9ooJZGYfYlrHEFSVz/ZIfV9/lSFtDo6CnZzuVa6PsaxB+Of2JfE15t4dDzFpwIA6tAGdWhzYt86PpJ45qfPvox9m+KqdhaynUtxf1/zT+/idwHyubslay9A7oPl/8jhUq71Ln4X8MGhVDpiTJSSm80KQB9cA5te3J7vuNY1GAOS8Jh5gs8FyBte2mul0m79+q5Efv2lcvtObv8zt5jO5TOP8XVjpT0A7ToK9nDp1D5iD/YK7DN4O8TuVhakhE8FyMnab3jyDQO0Rz978Gr75t0MKSH0QcK4PsbBinBeNfKKcn7TzBavCcDs4rkGURGhXB4rCQCYSezmMvISB9gHiqsm6vA9QO6Da6EOyGMAlDm3t5flKV4ToMTB3D94dlo4ckSeOVfg2+ObeRMyZeTXpyuUxpgN8xaAJY2bcwbf1THrWP5KQB76Yo8AeJcjEefHQgZfg48Y73doj0fC3Rgz4SAgfMdXxnEbFXK4aFiioV0DP+wtkgTojYX6oaHBalGkeD5dDNQM/7g3hT9JEgAgYXBw0CQIJFWAhNiI+LjosARSMQ1tfdWWvpEeDv9DLNfpws9Zi3ZZ+YQmBbhi0f9lKCggKCAowBQUsJgFXK9vOhobs+wsh+plPgIq/6x7Z9XKuMPa0NAVfKo6BoaGG1rv/HUoI91QTgq4FfBrldnEj8DL98Qsa4+KjFir0WiiuHjBY7PZerqtvXVd3dYkDYnGOQuoqDJn2sj//zrrTVjAljkLMJvN+p4hqhZIiOdT1SGSWJOZbkjhUBG3AkBVlTlhRKRz/Cg8y6fqQRS/1wp0ND3dcIvc8C+lRwp90BqHdwAAAABJRU5ErkJggg==",pdf:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAACyUlEQVR4nO2bMUjjUBjH/1FwENo70EVQJ9FFsK5dxAZXrzc52sVFB+/Awe16u3C3u3R1K7oIWuktrnVwURw8FEVQEAU3yX3/exculLY2bWOT9PvBl3x5fUnf98tLCiWx0OOoAImeRgVI+MLJZj/i+XlZ0qxEsPT1fbUODk4kCwz/Amy7AsdJSfoePKK/fz5ICb4EOJnMF1n9QDIJjI9LGhAPD8DtrSR/CVSCPwG2XZCzv4zpaeDlRVoCgnLLZXgITII/AZlMGcBcFwSQQCRESQDpuISoCZARWydIJOatYvFRttomegJIByVEUwDpkIToCiAdkBBtAaRNCdEXQNqQEA8BpEUJ8RFAWpAQLwGG79bRUR5NogIkmubdBCQS/C9AEh/c3QE3N5LEQUArDA4Cp6eSqAAVoAJUgArIo0lUgETTqAAVoALKUAEqQAWoABWgAlSAClABVQImJ2VRxfX1/35DQya88EkQhguLGB2VpAbn57JoAPftqoDtbVPM/b1sCFNTps/ODnB8DCwuArYNXF2ZwY6NSSfh8ND0IdxnYwM4O5ONKra2ZNEAHrPrAvb2gN1d2fjH2pqZGevrRgBzbyGzs0AuB5RKZj9XwMoKfBNKASxwddUUVEsAYTtnBiXFSgAHlMuZolgcC60lgJ+z6M1NYHjY5O4xXHhp8TJqBL+v6wKqYZ9CAahU3hbgtjOvvgfwvuHeJ+oRCgE8SwwXbyH1BHgvE1cGc7+EQoD3EqimngAWTNgeewEzM2Yqc7D8GUynTc7iOc0jLYAD5/Rn1CKdNuGFNzcK45pQytKSEeKXrgvoNipABagAFaACghZg20U4zqfeFZDJ5AF8w8QEMDIiaYjgKzYXF1KR9dkqlYrS0hT+BPCNsaenSwAfJMLIbySTqcAelCTOwkIKr68/JZ2TCBO/MDCQs/b3L+ED3wLihgqQ6Gl6XsAfGqGLXxM1sLEAAAAASUVORK5CYII=",txt:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAD00lEQVR4nO2bT0gUURzHf2/+rIsRGVRS0db2HwS1gxoFVkR1sjzkoUNlhw5BUoeORVAdFYoOHVQyT0FdqlvRH+vUerAEISkKkwrDyBDM/eO8vm/8k7M7u85sI7szvQ/MvN9vZnm77zNv3rzd2WGUhWRveK9B/Bxx3oi0oCirzjzTN9zYj9BzbAUkYuFmTsZthEWBuvYiPtS3O1r0VjN5TIYA88hz4znCosEUAHhi+LIebb+C0DMyBMRjoS4iOomlaJgVIPBagp2APhTVWIqG+QIEXkqwE8BRFBXpAogbv9X4cAPb1PkU2T/hTwECjyT4V4DAAwn+FiAQEhIfd7KN3f3IXON/AYAZE8NKaLSGlXeMIHVFIAQI8pUQGAGCfCQESoDJ1K9eLdJWi8gRwRMAePKH4y9PgRQgcCrBFwKUFSeIlUQQucOJBF8IYKX1pCyvR+Sehb43+EIA52FSV7cQU0uQuSeXBF8IMAlVkbqyAUF+ZJPgHwEm5TgVDuGUiCDOg8TQMS3aeRfRHD4TgCOZwspYhksDFrcY8VR497COaA7fCZiFG1iJxSXhXQlLmy2JwC8C8qWkVgqwtNmSCKQAKUAKkAJQBBYpQAqQAixttiQCKUAKkAKkABSBRQqQAqQAS5stiUAKcCiAlVYt+MMkn+jHzcoxvK4Md3bWI3+LrTaI/aiPj/cgcVj3+Eus3eOZAK2il5TSSkTZSb5vIj72kJTyFtIirZR8dxAfvAd7rGgVMawZpQZqUBLpO74T03ILSA7UZheaA88EpBOqidPUl2s09fUqskyEMBaKULJ/23SvmEGNtJFafjZngxaq2w0FE0ChDaTjSIsekPrQhA1487LDpG+5R6nPF8gYuYkt9ixYtwsKJwBYGvzzEYS8hpBXEHIUe7PjpG6nFFSAQI12kLriOBno7gyDn+j6808JO5zW7YSCCxAjvl45iEGujFKfTpMx2o2NuXFctwMKLkBdc8n8xwePDyHj6AF1/08PYEv3kL79sfk6A5dHbdsTjAF/B8VsOKnbKYUTMNP1xeQoNXgAG6b/+qJF26cHxaBfBcRkh+FSmOzfauny2ub7uOffgFMhwPOAucmO3UxQ9AzIyTUe5KrbLYsmQBzJKYzoYuqbjhj4eGIo64gv5v7qutbpscBGgFk3Gp+th7hh0QT4BSlACpACLG22JAIpIBZ6g6IKSyBxIqCLiuzBSc/g7EFJXbwR0RwZAhKxJdWYkvQhDBwKU/bpNZMvaB4ZAgTF9vC0FzBSToVqJ7soDVsBAvMhaoOfJ8aPIPUv6PaKwq6nH/lZ/gBjD5Nf2bkbBQAAAABJRU5ErkJggg==",xlsx:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAAAXNSR0IArs4c6QAABXFJREFUWEfdmXtQVHUUx793dwUExBeIFEaCYIiYaySglDZSU8pkk6HRhMlYIsJI0TgitolubYBKg2TTMKyWj9HBpiwLBns51UQyhkSBUko4gDxUGHk/9zZnY7f94YV73b2g9ftnh3vP48P3nt+557fLwXLtgAIh6hQYuE3g4MHck+GPiSpnrHJ/TNfW151xIij9pjUhOcbpiwX+UKAEgIM1wcR8JqkmIN4rsq2h9/o+fWDqG2L2QvdZ4C/Vq8BxH1sTSIoPASfeHwUePGq7GnVtfV23rTQLXPBQJHg+T0pya2xMwOTbz/dbpfQdAyZoo9LdDdr6zuY9BSHZrVJEuKPAg0rfrO9q2ntg/i7tfwKYIA0woK6z4c367pYsMaXvuMImVfv4/psNEpS+a4ClKn1XARO0mNJjCuykdMDrM6PBgU07dLNRTdd2N2lutHZmfR6W0WZ5f0yBKXGUx5Pwc7pPtCEYle69lnEgcKdueOB89XMAd0I0mg0GDgo7+Dh6wtVusmgUHgb+ckdNeN2y09+ajMdcYVHKoQY81mBFifnte1vAkdPDEekRzoRs7GnGu9VHUdVZNyLLeKU91ns+g0enqBm7H1tKoa/5DB0DXcL+tgB7OrijKPQg6NPcPw39RuCtlftGBH7cNQSH5+2Cu/1Us12PoQ+LitahpPXi8L62AFPUcNeFODRPCw97VyZJeHEcvrlRLJiYbL8P0WOWo6f5fmt/B5IuZkJfc3LkKrEV2F5hh20+MdgxawOTiGDXlaWitruRuU72Wt84bPFey1zX155E0oVMEPiIy1ZgU/CCoGw84RYKhUVPJYiNv+vQzw+YGWJnrMJe/9fgpBxvvna+tRKhRevQY+gV34NyAQdN9DeWhr/zTIua7EXEuUR8PVgaQjVPT+Dl37QovF4kDksWcgFTrBXTwpA3Px2Oyn9PVGVtf+KF0hQ09bYgN1CDp6ctMYMN8AOILtPg2NVCabByA6s4JbLmbEHsjGeh5JRGCCqHnJpPUNleDd3sBKYUjtcXIvpXDVMyouRyKkzJqAN8MDeFUZKuU33ShjMtKgEqhaGbcsyBKeG8Cb74IUQPF5WTYH5J/XY4crkVNuV58Z7l2B+QfAu05H471sCznbyQp043qm25KtqrsPr8VpS3V4k+fUGD0VCYNt97AcnGzSe0hPqzZPrRAF7uFoY8dRrTESyBaANGlW7Hp43mKVEyr6x9mLIunvwgDgamwtdiKG/uawXNvZb9ubrrKmLKUnGm+RfpsHL3YYp3+uH9WDY1GArun0mV1Hzrsh5Txrlgs9fz5v5M92iUpCFJ0ivZ9G/JVRI0327zjoFm1iuMYh/VncLmij2g85tQf95ddQg7L+UMP/8O1V8u4IhpjyB3roaZb6mFLfxpLSo7qo1pqWMULzoMe8U4M8a13hbEl6fjRMNX0kpDDmAaakoWH4WbxbmMYOPL03Dkaj4DkuC1Bu/4JcBZ5chALz27AdTyRJetwC4qZ2T6J2G950om15G6fMRXpN0y37raTTI+iZXuSxn7Y/WFSChPA23QEZetwFq/OCR7x4B6r2n90XEFYT+vBz1uoSU0ZtKQlF193HjqGDXgBS4P4LvgHOb1S6WQWLEbH9adGjEvDfL0ZCxbHR08I869ijPN54b3tVZhUonmW4K2XDRKai/lirYqOnGk+sbipXsjGP8L7X9hY7kO9Cm4rAWmvjrH2QcqTsHEpYFdtA4HPWiTBjh7M/4G8KjsuILGnhvyAovu5tEysFbh0eIRjfv/Ah7ln71E1RQy4Ayr8VSp+QvKMf1h0QrgbhiwABElF0y+LDD9dBus3g5wmwBMtyKBfC48GsDx7+Ps+bexEwZT4L8Bn330S/1bvzIAAAAASUVORK5CYII=",csv:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAFF0lEQVR4nO2bX0xbVRzHfwXZTEF5YIss29gCxk1kkOGcwuLQGKpbMkc3EnERgjoNxDnJwEwfFqrypMw/82GYaDTwIA8bxZhsS4mKM5txw39z8U8iZBsPAs5EEJiU0vr73nlqb3vLei/H2FvPJyH3/O69hfP7nN855zalDorDA96ae4IOxzMhClVx+J+yu3DXmw/d8uBebkrHUEClt6aer7zLzaSgdm01Tfgn2/YU1x/gUCoxAjDycw76hJtJAwSAsenLrS2lDS9yUxoxAlzemt6Qg7ZzM2kQAsAf/sl9TxXXv8ZNKcQIqOytCfEhqYgUkO5I+zNIwYdr11T3crhgbCcABEPBK6NXxrbtL93zEYcLwpYCgCwJthUAIME/5694suiRsxxawtYCwExgZngqNH1H07onRjk0je0FgIVISAkBwKqElBEA+GnxEj8truJmwqSUADA+M/Hx0yWP3cfNhEg5AcCMhJQUABKVYAsBrrwKusm5lFvmGPr94lueu5obuBkXWwgozSmi25au5ZZ5rvUO0hYCnGnX07YCFy1KX8SReeaTYAsBYHXmcrp7ZRm3rDEw+k3ToYq2N7ipwzYCQE5GNm1eUUZZi7M4Mge/Z6ALE8M728r293AYxlYCQGB2lm5Ic9J1lEYrspfzmcTxzwX8Hfe/vJibYWwnQDAXCNCsf4Zb5vhs14e6nHUBsIsAq/RVdety1gVACVAClAAlgA8pixKgBCgBupx1AVAClAAlQAngQ8qiBCgBSoAuZ10AlAAlwJqA4pxbqWRJIbeIRqZ/pc9HvqTJ2SmOYsG9BdmrKSvDSYPjF+ncbz/o7sWnQLn88+3l7zkyJisjk/JvzNNeawbpAspzN1DDujqtw+Acd7r4bxFdPx6hrp+Ocusq6HTrxn2aKCSO12SyBCTvHTwevrdlfSOVL7uddhzbzZExjUV15C7Yot2D1yeKVAGulRXEn7hoybR/fVg7AiTqzt/CH2rupI7vOqln6DifJXpl0wHtmufMQRrlKgEY7do11bRp2QZyH3ucz1yV6rmzmdq/6iDf8Kd8JpaerW/TEP+9llMvcZQ40gSg412Vh7SkG/uf4zOxiJEWI+Tb/j5XxVEe6SMczQ9+N6bSswYJCvHzCYqHNAGiBJE8kkwE79Z36OfxC/TCmVfDUuKBqkAF1fbtDVeLAJV0M68homLMIE1AO3cCC5mZToikMLKnfznLPwNxFzFRYdEVI85jzTh8vpPPmEOaAKtzEOWLyinIXsURaZWAZLxDJ7R2JJ6NzZTP99VxFQiERKPKSARpAlABwKwAAUayJKeQXHmbtV1jkKdGY//zfOUfxGLo+eIgnR4Z4DNEnTz6Y5y41b8rTQC2KnTe7DZkxA7eMbCVRiYqQLljjcHOYSTELNIEYIXHYhQ9R60Sb4cQJQ/RLesbtKmD8reKNAEAc7Sc92+j7QgdbeXreA7AaCFGAh3nu2Ke8LAuYFsz2lEwVVAFkAMROEZLMoNUAXioQVKQgDmMVR2g0/jHJiSDfRxTBPeiYiDiFO8AWECBuNd36aT2MGWEEA0w+lYWP4FUAQJMh0oexVznEi0hdBAyfMMnteQjwWgjGdwHpvg6ko+uoEggDc8d17ovEf4VAXZCCVAClABdzroAKAH/dwHJ+MVJWThC9IHP3V3FzTAxApLxq7OySA/RvSfc3f0UQYwAkGxfnpZCiB7tc3e/R1EYCgCohCBRk92nA8o+jej16JEX/AVS3+lfWhLTjQAAAABJRU5ErkJggg==",mark:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAADWUlEQVR4nO2Z3XHaQBDHVx77OaSCyB24g0AFwR1cKrCZ8cerX/0xg12B6cCkApMKQgfgDvCzPVZ+68EaEIIs4YQluN/Mzp6Ovdu9v4Q4pEi2nCAAttUEATAT19fX9SRJ7mnGsj56e3t7h61Wa0S7ECLMxNXV1QAXy/rpI0KjKBEizAQCJLjPojARqiKAUogIZRXgGfuCZfEuQlkF+I11ROQey+JVhAgzsW4Bzs7O6uR0UrAIpRZAgLxOChSh9AIo5HZSkAiVEEAhv5MCRKiMAAo1OPEsQqUEUKjDiUcRKieAQi1OPIlQSQEU6nHiQYTKCqBQk5N8EXqMb+D/SYSZIFmCWxcmARTqcpIjAuNNazMFKSRKcOtiGEVRR4zwnKKJO8BSqi7AygQBggBBANPaTEFKECAIEAQIAuCW5Y5NyggvbGxquCPMwh3xXfzHJsc6LqUUAmSLYI6eiHzHFjGzDWZcglsK5pjKPQ9TkOKjiJubm+bb29sDzbns7OwcnpycdGmm+Mg9D1OQ4qsI5hmKyDcsjyfGxJKBMQluKZhnJncepiDFVxG8ZD3me92mOQPf+9bp6ektzSl85c7DFKT4KqLdbtdeXl6GMvvm55kHGXHegwxfufMwBSk+i2CuW9wRNskd8cf4GYj3ljuLKUjxWQRXQcxVMKCZwtnf5+wPJQefubOYghTfRTBfF/cDU34R28TnQqzX3JOYgpRVi+DmV9/d3e1zlkccvh9zM3ykqTe/Bje/noBeHa+vr/HHsbJq7kWYgpRVi9AFsweon5+fX8gY+vqIUCMuljGXl5cX7AV6GykAi32g7yuH7zCnE6CvI8DZ11+IAVfE4aYK8EjzJ/0dyYEcTnjCiwDpV0KhP8EtBTnS3IswBSmrFjEhwJD+ffwM5Bjg4k0XQLILVCb/J2Q/XzX3IkxByqpFTAoAPT5r4FOYXz+rC2yDAFMbH+Y+wP3B3tkKAWDIQjsC9DsRiWUM/ZsnAOOdcIfHLEz9UjA2wS0F49PcizAFKf9TBPQ5m118bXyWa5iFEeM6gmdcE3+ALUVZBPg0ggBBgCCAaW2mICUIEAQIAgQBcJWhCAFGuC9YFXhCgFgMmAUY/5npyPzXWmXhKYoiN/lnahFmATaVIAC21Wy9AH8BUf5iXxuxTnAAAAAASUVORK5CYII="},V=C((()=>e=>{const l=e.split(".").pop();for(const a in k)if(null==l?void 0:l.includes(a))return k[a]})),E=async(e,a)=>{var t,s;try{const{lists:s=[]}=await Ae({page_size:a,page_no:e,keyword:m.value,kb_id:l.value});null==(t=w.value)||t.complete(s)}catch(n){null==(s=w.value)||s.complete(!1)}},j=()=>{3!=d.value.power?i.value=!0:uni.$u.toast("无权限操作！")},F=p(),D=B({show:!1,id:0,name:""}),z=async()=>{var e,l,a;if(!D.name.trim())return null==(e=F.value)||e.clearLoading(),uni.$u.toast("请输入文件名称");try{await xe({name:D.name,fd_id:D.id}),D.show=!1,null==(l=w.value)||l.reload()}catch(t){null==(a=F.value)||a.clearLoading()}};return(e,a)=>{const p=c,k=t(s("u-search"),X),C=K,B=t(s("u-tag"),G),Y=t(s("u-icon"),N),R=t(s("z-paging"),Z),q=t(s("u-input"),W),L=t(s("u-modal"),$);return n(),u(p,{class:"bg-white h-full"},{default:o((()=>[r(R,{ref_key:"pagingRef",ref:w,modelValue:g.value,"onUpdate:modelValue":a[4]||(a[4]=e=>g.value=e),fixed:!1,height:"100%","safe-area-inset-bottom":!1,"auto-clean-list-when-reload":!1,onQuery:E},{top:o((()=>[r(p,{class:"py-[24rpx] px-[20rpx]"},{default:o((()=>[r(p,{class:"flex justify-between"},{default:o((()=>[r(p,{class:"bg-primary py-[20rpx] px-[30rpx] rounded text-white",onClick:j},{default:o((()=>[x(" 导入数据 ")])),_:1}),r(p,{class:"ml-2 flex-1 min-w-0"},{default:o((()=>[r(k,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value=e),onInput:a[1]||(a[1]=e=>{var l;return null==(l=v(w))?void 0:l.reload()}),"bg-color":"#fff",height:"80",shape:"square","border-color":"#e5e5e5",placeholder:"请输入关键词","show-action":!1},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),default:o((()=>[r(p,{class:"pb-[24rpx] px-[20rpx] pt-[10rpx]"},{default:o((()=>[(n(!0),b(_,null,y(g.value,((e,a)=>(n(),u(p,{key:a,class:"mb-[30rpx] shadow rounded-[16rpx]",onClick:A((a=>(e=>{const a=`/packages/pages/kb_item/kb_item?id=${e}&kb_id=${l.value}&kb_power=${d.value.power}`;I?U.miniProgram.navigateTo({url:a}):S.navigateTo(a)})(e.id)),["stop"])},{default:o((()=>[r(p,{class:"p-[30rpx]"},{default:o((()=>[r(p,{class:"flex items-center"},{default:o((()=>[e.is_default?(n(),u(C,{key:0,class:"w-[32rpx] h-[32rpx] flex-none",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAMAAAApWqozAAAAllBMVEUAAAD3own4own3pAr3owr3pAr1pgr3owr3own2pQj/ogD3pAn4pAj3pAr3pAr3owr3pAn3pAn4pAn2pgr5own9pwr3pAr3pAn3pAn4pQn3pAj2ogn/oQD3pAr3owr3own3pAr3pAr3owr4pAr4pQf2pAn/pAD3pAr4pAn2own4pAr3owr3pAr/mQD4pAr2pQn5owb3pArla+osAAAAMXRSTlMA1ar8gPcV6kA7C75759q1sKRQLysR48iXblgaB+3d0MK4nY4kHA7xiXVqZUkFMnEprxxFuQAAAYRJREFUOMvV1deSgyAYBWCU2HvUmF5s6dk97/9yCzizuhMxernnQmHmQ/jBUdJNfD8p0LLlIyWfYt99CpFdkHywmwwwnGI2Cw8UxmrQ6jkQivmfpetBmw/hCLvrbyc5YGHKraXhYne6e6jy4iIoW3afh97e3bDGHYhlOPYpL8k0AFCHDavPmMnwXPNjVuQRInxcjsCW4CuObHJr0eCgJuQLWSXBMzg6W4UnrGivoSSDOFEaHD05PpQSvKY+L94V1uCPLHBKZdvsiSOrxaKXhEVhN0nSAMeGAGLPHoD8CNegcQfrAT8kaaKj3sGbkzf0JqX6n2Ukpk0G02KR/4WtcOev0qcZHopvsrVMfQDnewCaay4Amm3chaGWcqyB5+yAx+G9iwS3oe1VHcZtenC1VNf2SPzyAZrb4/CFgunbOBw1G3AbhV2IGMYYXJ3egByTlzEBk7k3AW9vY7FIoU3AujoBkzqbgIm1H4uFlmxg1P+d7i2SSn50Lu3BYdWP7eCN7pYlafID9fqDiwpAYjoAAAAASUVORK5CYII="})):(n(),u(C,{key:1,class:"w-[32rpx] h-[32rpx] flex-none",src:v(V)(e.name)},null,8,["src"])),r(p,{class:"mx-[10rpx]"},{default:o((()=>[x(f(e.name),1)])),_:2},1024),1==e.is_qa?(n(),u(p,{key:2,class:"flex-none"},{default:o((()=>{var l,a,t,s;return[0==(null==(l=e.qa)?void 0:l.status)?(n(),u(B,{key:0,type:"info",text:null==(a=e.qa)?void 0:a.status_msg,size:"mini"},null,8,["text"])):h("v-if",!0),1==(null==(t=e.qa)?void 0:t.status)?(n(),u(B,{key:1,type:"warning",text:null==(s=e.qa)?void 0:s.status_msg,size:"mini"},null,8,["text"])):h("v-if",!0),r(p,{onClick:A((l=>{var a,t;return t=null==(a=e.qa)?void 0:a.error,void Q({title:"错误信息",content:t})}),["stop"])},{default:o((()=>{var l,a;return[3==(null==(l=e.qa)?void 0:l.status)?(n(),u(B,{key:0,type:"error",text:null==(a=e.qa)?void 0:a.status_msg,size:"mini"},null,8,["text"])):h("v-if",!0)]})),_:2},1032,["onClick"])]})),_:2},1024)):h("v-if",!0),r(Y,{name:"arrow-right"})])),_:2},1024),r(p,{class:"flex mt-[30rpx]"},{default:o((()=>[r(p,{class:"flex-1 flex"},{default:o((()=>[r(p,{class:"text-center"},{default:o((()=>[r(p,{class:"text-xl font-medium"},{default:o((()=>[x(f(e.wait_sum),1)])),_:2},1024),r(p,{class:"mt-[20rpx]"},{default:o((()=>[x("待训练")])),_:1})])),_:2},1024)])),_:2},1024),r(p,{class:"flex-1 flex justify-center"},{default:o((()=>[r(p,{class:"text-center"},{default:o((()=>[r(p,{class:"text-xl font-medium"},{default:o((()=>[x(f(e.ok_sum),1)])),_:2},1024),r(p,{class:"mt-[20rpx]"},{default:o((()=>[x("已训练")])),_:1})])),_:2},1024)])),_:2},1024),r(p,{class:"flex-1 flex justify-end"},{default:o((()=>[r(p,{class:"text-center"},{default:o((()=>[r(p,{class:"text-xl font-medium"},{default:o((()=>[x(f(e.total_sum),1)])),_:2},1024),r(p,{class:"mt-[20rpx]"},{default:o((()=>[x("数据总量")])),_:1})])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),r(p,{class:"border-t border-solid border-light border-0 p-[30rpx] flex justify-between items-center"},{default:o((()=>[r(p,{class:"text-sm text-muted"},{default:o((()=>[x(f(e.create_time),1)])),_:2},1024),r(p,{class:"flex items-center"},{default:o((()=>[r(p,{class:"flex items-center",onClick:A((l=>(e=>{D.id=e.id,D.show=!0,D.name=e.name})(e)),["stop"])},{default:o((()=>[r(Y,{class:"text-muted",name:"edit-pen"}),r(p,{class:"ml-1"},{default:o((()=>[x(" 重命名 ")])),_:1})])),_:2},1032,["onClick"]),e.is_default?h("v-if",!0):(n(),u(p,{key:0,class:"flex items-center ml-[20rpx]",onClick:A((l=>{return a=e.id,void Q({title:"提示",content:"请确认是否删除！",success:async function(e){var l;e.confirm?(await ge({fd_id:a}),null==(l=w.value)||l.reload()):e.cancel&&console.log("用户点击取消")}});var a}),["stop"])},{default:o((()=>[r(Y,{class:"text-muted",name:"trash"}),r(p,{class:"ml-1"},{default:o((()=>[x(" 删除 ")])),_:1})])),_:2},1032,["onClick"]))])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),r(We,{modelValue:i.value,"onUpdate:modelValue":a[2]||(a[2]=e=>i.value=e),onClose:a[3]||(a[3]=()=>{var e;i.value=!1,null==(e=v(w))||e.reload()})},null,8,["modelValue"])])),_:1})])),_:1},8,["modelValue"]),r(L,{ref_key:"uModalRef",ref:F,modelValue:D.show,"onUpdate:modelValue":a[6]||(a[6]=e=>D.show=e),title:"重命名","show-cancel-button":"","async-close":"",onConfirm:z},{default:o((()=>[r(p,{class:"slot-content p-[40rpx]"},{default:o((()=>[r(q,{modelValue:D.name,"onUpdate:modelValue":a[5]||(a[5]=e=>D.name=e),border:"",placeholder:"请输入文件名称"},null,8,["modelValue"])])),_:1})])),_:1},8,["modelValue"])])),_:1})}}}),el=l({__name:"dataTest",setup(e){const{KBId:l}=Ge(),d=a([]),i=a({kb_id:l.value,question:""}),p=async()=>{d.value=await ve({...i.value})};return(e,l)=>{const a=j,m=c,A=F,g=K,w=t(s("u-line-progress"),Be),k=E;return n(),u(k,{"scroll-y":"",class:"h-full bg-white"},{default:o((()=>[r(m,{class:"p-[20rpx]"},{default:o((()=>[r(m,{class:"p-[20rpx] border border-solid border-[#DCDFE6] rounded-lg bg-[#F7F8F9]"},{default:o((()=>[r(a,{modelValue:i.value.question,"onUpdate:modelValue":l[0]||(l[0]=e=>i.value.question=e),placeholder:"请输入需要搜索的内容"},null,8,["modelValue"])])),_:1}),r(m,{class:"mt-4"},{default:o((()=>[r(A,{class:"bg-primary text-white",onClick:p},{default:o((()=>[x(" 测试 ")])),_:1})])),_:1}),0==d.value.length?(n(),u(m,{key:0,class:"flex flex-col items-center justify-center py-[40rpx]"},{default:o((()=>[r(g,{class:"h-[240rpx] w-[240rpx]",src:v("/mobile/assets/testResult-71984749.png")},null,8,["src"]),r(m,null,{default:o((()=>[x("测试结果将在这里展示")])),_:1})])),_:1})):h("v-if",!0),r(m,{class:"mt-4"},{default:o((()=>[0!=d.value.length?(n(),u(m,{key:0},{default:o((()=>[(n(!0),b(_,null,y(d.value,((e,l)=>(n(),u(m,{key:l,class:"p-[10px] border border-solid border-[#e3e3e3] mb-[10px] rounded"},{default:o((()=>[r(w,{percent:100*Math.abs(e.score/1),"show-percent":!0},{default:o((()=>[r(m,null,{default:o((()=>[x(f(e.score),1)])),_:2},1024)])),_:2},1032,["percent"]),h(' <el-progress\n                        :percentage="Math.abs(item.score / 1) * 100"\n                        color="var(--el-text-color-disabled)"\n                    >\n                        <span>{{ Math.abs(item.score).toFixed(5) }}</span>\n                    </el-progress> '),r(m,{class:"text-sm text-tx-secondary mt-[5px] whitespace-pre-line"},{default:o((()=>[x(f(e.question),1)])),_:2},1024),r(m,{class:"text-sm text-tx-secondary whitespace-pre-line"},{default:o((()=>[x(f(e.answer),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):h("v-if",!0)])),_:1})])),_:1})])),_:1})}}}),ll=se(l({__name:"base-setting",setup(e){const l=D(),{KBInfo:d,KBId:i}=Ge(),p=a({name:"",image:"",intro:"",power:1,documents_model_id:"",documents_model_sub_id:"",embedding_model_id:""}),m=B({chatModels:[],vectorModels:[]}),g=async()=>{await he({...p.value})},b=async()=>{Q({title:"提示",content:"请确认是否删除！",success:async function(e){e.confirm?(await be({id:i.value}),I?U.miniProgram.navigateBack():S.navigateBack()):e.cancel&&console.log("用户点击取消")}})};return z((()=>{p.value=d.value,(async()=>{const{vectorModels:e}=await Y({queryKey:"modelLists"});m.vectorModels=e})()})),(e,a)=>{const i=c,_=t(s("app-upload"),Ee),y=w,k=j,C=t(s("app-select"),Ie),V=R,B=t(s("u-icon"),N),I=t(s("model-picker"),Ue),U=E,S=F;return n(),u(i,{class:"h-full flex flex-col"},{default:o((()=>[r(i,{class:"flex-1 min-h-0"},{default:o((()=>[r(U,{"scroll-y":"",class:"h-full bg-white"},{default:o((()=>[r(i,{class:"px-[20rpx]"},{default:o((()=>[r(i,null,{default:o((()=>[r(i,null,{default:o((()=>[x("知识库封面")])),_:1}),r(_,{modelValue:p.value.image,"onUpdate:modelValue":a[0]||(a[0]=e=>p.value.image=e)},null,8,["modelValue"])])),_:1}),r(i,{class:"mt-2"},{default:o((()=>[r(i,null,{default:o((()=>[x("知识库名称")])),_:1}),r(i,{class:"border border-solid border-[#DCDFE6] rounded-lg p-[20rpx] mt-2"},{default:o((()=>[r(y,{modelValue:p.value.name,"onUpdate:modelValue":a[1]||(a[1]=e=>p.value.name=e)},null,8,["modelValue"])])),_:1})])),_:1}),r(i,{class:"mt-2"},{default:o((()=>[r(i,null,{default:o((()=>[x("知识库简介")])),_:1}),r(i,{class:"border border-solid border-[#DCDFE6] rounded-lg p-[20rpx] mt-2"},{default:o((()=>[r(k,{modelValue:p.value.intro,"onUpdate:modelValue":a[2]||(a[2]=e=>p.value.intro=e),placeholder:"请用一句话描述知识库"},null,8,["modelValue"])])),_:1})])),_:1}),r(i,{class:"mt-2"},{default:o((()=>[r(i,{class:"mb-2"},{default:o((()=>[x("向量模型")])),_:1}),r(C,{modelValue:p.value.embedding_model_id,"onUpdate:modelValue":a[3]||(a[3]=e=>p.value.embedding_model_id=e),popupTitle:"向量模型",dataLists:m.vectorModels,placeholder:"请选择",name:"alias",value:"id",disabled:""},{label:o((({item:e})=>[r(i,null,{default:o((()=>[r(i,null,{default:o((()=>[x(f(e.alias),1)])),_:2},1024)])),_:2},1024)])),_:1},8,["modelValue","dataLists"])])),_:1}),r(i,{class:"mt-2 mb-[130px]"},{default:o((()=>[r(i,{class:"mb-2"},{default:o((()=>[x("文件处理模型")])),_:1}),r(I,{id:p.value.documents_model_id,"onUpdate:id":a[5]||(a[5]=e=>p.value.documents_model_id=e),sub_id:p.value.documents_model_sub_id,"onUpdate:sub_id":a[6]||(a[6]=e=>p.value.documents_model_sub_id=e)},{default:o((({item:e})=>[r(i,{class:"input flex"},{default:o((()=>[r(i,{class:"flex-1 min-w-0"},{default:o((()=>[r(i,{class:"line-clamp-1"},{default:o((()=>[e.alias?(n(),u(V,{key:0},{default:o((()=>[x(f(e.alias),1)])),_:2},1024)):(n(),u(V,{key:1,class:"text-[#888]"},{default:o((()=>[x("请选择")])),_:1})),e.alias&&"0"==e.price?(n(),u(V,{key:2,class:"text-muted"},{default:o((()=>[x(" (免费) ")])),_:1})):e.alias?(n(),u(V,{key:3,class:"text-muted"},{default:o((()=>[x(" ("+f(`消耗${e.price}${v(l).getTokenUnit}/1000字符`)+") ",1)])),_:2},1024)):h("v-if",!0)])),_:2},1024)])),_:2},1024),p.value.documents_model_id?(n(),u(i,{key:0,class:"text-muted flex flex-none mx-[20rpx]",onClick:a[4]||(a[4]=A((e=>{p.value.documents_model_id="",p.value.documents_model_sub_id=""}),["stop"]))},{default:o((()=>[r(B,{name:"close-circle"})])),_:1})):h("v-if",!0),r(i,{class:"text-muted flex"},{default:o((()=>[r(B,{name:"arrow-down"})])),_:1})])),_:2},1024)])),_:1},8,["id","sub_id"])])),_:1})])),_:1})])),_:1})])),_:1}),r(i,{class:"flex pt-[20rpx] left-0 w-full px-[10rpx] bg-white py-[20rpx]"},{default:o((()=>[r(S,{class:"text-error flex-1 mr-2",disabled:1!=p.value.power,onClick:b},{default:o((()=>[x(" 删除 ")])),_:1},8,["disabled"]),r(S,{class:"bg-primary text-white flex-1",disabled:v(d).power>=2,onClick:g},{default:o((()=>[x(" 保存 ")])),_:1},8,["disabled"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-ef1c0766"]]),al=se(l({__name:"setup",setup(e){const{KBInfo:l,KBId:t}=Ge(),s=a({name:"",image:"",intro:"",documents_model_id:"",documents_model_sub_id:"",embedding_model_id:""}),d=B({current:"baseSetting",lists:[{type:"baseSetting",name:"基础信息"}]});return z((()=>{s.value=l.value})),(e,l)=>{const a=c;return n(),u(a,{class:"h-full"},{default:o((()=>[r(a,{class:"pt-[20rpx] bg-white h-full flex flex-col"},{default:o((()=>[r(a,{class:"flex mb-[20rpx] px-[20rpx]"},{default:o((()=>[r(a,{class:"p-[8rpx] bg-page flex rounded-[8rpx]"},{default:o((()=>[(n(!0),b(_,null,y(d.lists,(e=>(n(),u(a,{key:e.type,class:k(["px-[30rpx] py-[9rpx] rounded-[8rpx]",{"tab-active":e.type==d.current}]),onClick:l=>d.current=e.type},{default:o((()=>[x(f(e.name),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),r(a,{class:"flex-1 min-h-0"},{default:o((()=>["baseSetting"===d.current?(n(),u(ll,{key:0,class:"h-full"})):h("v-if",!0)])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-b141b172"]]),tl=l({__name:"index",props:{id:{default:-1}},emits:["success"],setup(e,{expose:l,emit:d}){const i=e,p={1:"可管理",2:"可编辑",3:"可查看"},m=a(!1),g=a(""),w=a(!1),k=a([]),C=a([]),V=B({visible:!1,memberIndex:-1,memberId:0}),I=a([{text:"可管理",fontSize:30,color:"#333333",subText:"管理整个知识库数据和信息"},{text:"可编辑",fontSize:30,color:"#333333",subText:"只能操作数据学习，增删改查自己的数据，不能修改他人"},{text:"可查看",fontSize:30,color:"#333333",subText:"查看知识库所有数据"}]),U=(e,l)=>{if(e.is_added)return;const a=C.value.findIndex((l=>l.id===e.id));-1!==a?(e.permission=0,C.value.splice(a,1)):e.is_added||(e.permission=3,C.value.push(e)),e.isSelected="box"===l?e.isSelected?0:1:e.isSelected?1:0},S=e=>{k.value.forEach((l=>{l.is_added||(l.isSelected=e.value?1:0,l.permission=e.value?3:0)})),C.value=e.value?k.value.filter((e=>!e.is_added)):[]},Q=e=>{k.value[V.memberIndex].permission=e+1},{lockFn:K,isLock:j}=ce((async()=>{const e=Object.fromEntries(C.value.map((e=>[e.sn,e.permission])));await ye({kb_id:i.id,users:e}),d("success"),m.value=!1})),F=async()=>{const e=await _e({kb_id:i.id,keyword:g.value});k.value=e.lists};return l({show:()=>{g.value="",m.value=!0,C.value=[],w.value=!1,F()}}),(e,l)=>{const a=c,d=t(s("u-search"),X),i=t(s("u-checkbox"),Fe),C=t(s("u-image"),Se),B=R,D=t(s("u-icon"),N),z=E,Y=t(s("u-button"),ee),q=t(s("u-popup"),le),L=t(s("u-action-sheet"),je);return n(),u(a,null,{default:o((()=>[r(q,{modelValue:m.value,"onUpdate:modelValue":l[2]||(l[2]=e=>m.value=e),closeable:"","border-radius":"16",mode:"bottom",height:"970"},{default:o((()=>[r(a,{class:"flex flex-col min-h-0 h-full px-[20rpx]"},{default:o((()=>[r(a,{class:"py-[30rpx] font-medium text-lg"},{default:o((()=>[x(" 添加成员 ")])),_:1}),r(a,{class:"mb-4"},{default:o((()=>[r(d,{placeholder:"搜索成员",modelValue:g.value,"onUpdate:modelValue":l[0]||(l[0]=e=>g.value=e),shape:"square","show-action":!1,onChange:F},null,8,["modelValue"])])),_:1}),r(z,{"scroll-y":"",style:{height:"670rpx"}},{default:o((()=>[r(a,null,{default:o((()=>[r(i,{modelValue:w.value,"onUpdate:modelValue":l[1]||(l[1]=e=>w.value=e),name:1,onChange:S},{default:o((()=>[x(" 全选 ")])),_:1},8,["modelValue"])])),_:1}),0===k.value.length?(n(),u(a,{key:0,style:{height:"500rpx"},class:"flex justify-center items-center text-muted"},{default:o((()=>[x(" 请搜索成员添加 ")])),_:1})):(n(),u(a,{key:1,class:"mt-4"},{default:o((()=>[(n(!0),b(_,null,y(k.value,((e,l)=>(n(),u(a,{key:e.id,class:"flex justify-between items-center mb-4 pr-[20rpx]",onClick:A((l=>U(e,"box")),["stop"])},{default:o((()=>[r(a,{class:"flex items-center"},{default:o((()=>[r(i,{modelValue:e.isSelected,"onUpdate:modelValue":l=>e.isSelected=l,name:1,disabled:e.is_added,onClick:A((l=>U(e,"checkbox")),["stop"])},null,8,["modelValue","onUpdate:modelValue","disabled","onClick"]),r(a,{class:"flex items-center"},{default:o((()=>[r(a,{class:"flex-none"},{default:o((()=>[r(C,{width:"74",height:"74","border-radius":"50%",src:e.avatar},null,8,["src"])])),_:2},1024),r(a,{class:"ml-3"},{default:o((()=>[r(a,{class:"text-base"},{default:o((()=>[x(f(e.nickname),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),e.permission?(n(),u(a,{key:0,onClick:A((a=>((e,l)=>{V.visible=!0,V.memberIndex=l,V.memberId=e.id})(e,l)),["stop"])},{default:o((()=>[r(B,{class:"mr-2 text-content"},{default:o((()=>[x(f(p[e.permission]),1)])),_:2},1024),r(D,{name:"arrow-down",size:"22",color:"#666666"})])),_:2},1032,["onClick"])):h("v-if",!0)])),_:2},1032,["onClick"])))),128))])),_:1}))])),_:1}),r(a,null,{default:o((()=>[r(Y,{type:"primary",loading:v(j),onClick:v(K)},{default:o((()=>[x(" 确认添加 ")])),_:1},8,["loading","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),r(L,{list:I.value,"border-radius":"24",safeAreaInsetBottom:!0,customItemStyles:{"font-size":"30rpx","align-items":"start","padding-left":"30rpx"},modelValue:V.visible,"onUpdate:modelValue":l[3]||(l[3]=e=>V.visible=e),onClick:Q},null,8,["list","modelValue"])])),_:1})}}}),sl=l({__name:"team",setup(e){const l=q(),{KBId:d}=Ge(),i={1:"可管理",2:"可编辑",3:"可查看"},m=p(),A=a([]),g=a(!1),w=a("all"),k=a(!1),V=B({sn:-1}),I=a([]),U=B({visible:!1,memberId:0}),S=C((()=>A.value.find((e=>e.sn===L().userInfo.sn))||{})),Q=C((()=>1===S.value.power));C((()=>1===S.value.owned));const K=()=>{var e;null==(e=m.value)||e.show()},j=async()=>{k.value=!0,await we({sn:V.sn,kb_id:d.value,type:w.value}),"kb"===w.value?setTimeout((()=>{l.navigateBack()}),1e3):(k.value=!1,g.value=!1,Y())},F=e=>{I.value=((e,l)=>{const a=[];if(e){const e=[{text:"可管理",fontSize:30,color:"#333333",subText:"管理整个知识库数据和信息"},{text:"可编辑",fontSize:30,color:"#333333",subText:"只能操作数据学习，增删改查自己的数据，不能修改他人"},{text:"可查看",fontSize:30,color:"#333333",subText:"查看知识库所有数据"}];a.unshift(...e)}return 1===S.value.owned&&a.push({text:"转移所有权",fontSize:28,color:"red"}),1===S.value.power&&S.value.sn!==l.sn?a.push({text:"移出团队",fontSize:28,color:"red"}):S.value.power>=1&&S.value.sn===l.sn&&a.push({text:"退出团队",fontSize:28,color:"red"}),a})(Q.value,e),1!==e.owned&&0!==I.value.length&&(V.sn=e.sn,U.visible=!0,U.memberId=e.id)},D=async e=>{"移出团队"===I.value[e].text||"退出团队"===I.value[e].text?(await ke({id:U.memberId}),"退出团队"===I.value[e].text&&setTimeout((()=>{l.navigateBack()}),1e3)):"转移所有权"===I.value[e].text?g.value=!0:await Ce({id:U.memberId,power:e+=1}),Y()},Y=async()=>{A.value=await Ve({kb_id:d.value})};return z((()=>{Y()})),(e,l)=>{const a=R,p=t(s("u-button"),ee),C=c,V=t(s("u-image"),Se),B=t(s("u-tag"),G),Q=t(s("u-icon"),N),z=E,q=t(s("u-radio"),Qe),L=t(s("u-radio-group"),Ke),T=t(s("u-popup"),le),M=t(s("u-action-sheet"),je);return n(),u(C,{class:"h-full"},{default:o((()=>[r(C,{class:"pt-[20rpx] bg-white h-full flex flex-col"},{default:o((()=>[r(C,{class:"flex justify-between items-center text-xl font-medium mb-[20rpx] px-[20rpx]"},{default:o((()=>[r(a,null,{default:o((()=>[x("团队成员(共"+f(A.value.length||0)+"人)",1)])),_:1}),r(C,null,{default:o((()=>[1===v(S).owned?(n(),u(p,{key:0,type:"primary",size:"medium",onClick:K},{default:o((()=>[x(" +添加成员 ")])),_:1})):h("v-if",!0)])),_:1})])),_:1}),r(z,{class:"flex-1 min-h-0","scroll-y":""},{default:o((()=>[r(C,{class:"py-3"},{default:o((()=>[(n(!0),b(_,null,y(A.value,(e=>(n(),u(C,{key:e.id,class:"flex justify-between items-center mb-4 px-[20rpx]",onClick:l=>F(e)},{default:o((()=>[r(C,{class:"flex flex-1"},{default:o((()=>[r(C,{class:"flex-none"},{default:o((()=>[r(V,{width:"74",height:"74","border-radius":"50%",src:e.avatar},null,8,["src"])])),_:2},1024),r(C,{class:"ml-3"},{default:o((()=>[r(C,{class:"text-base"},{default:o((()=>[x(f(e.nickname),1)])),_:2},1024),1===e.owned?(n(),u(B,{key:0,type:"primary",text:"所有者",size:"mini",style:{"--color-primary-light-3":"transparent"}})):h("v-if",!0),2===e.owned?(n(),u(B,{key:1,type:"primary",text:"成员",size:"mini",style:{"--color-primary-light-3":"transparent"}})):h("v-if",!0),e.sn===v(S).sn?(n(),u(B,{key:2,type:"primary",class:"ml-2",text:"我",size:"mini",style:{"--color-primary-light-3":"transparent"}})):h("v-if",!0)])),_:2},1024)])),_:2},1024),r(C,{class:"flex-none"},{default:o((()=>[1===e.owned?(n(),u(a,{key:0,class:"mr-2 text-content"},{default:o((()=>[x(" 全部 ")])),_:1})):(n(),u(a,{key:1,class:"mr-2 text-content"},{default:o((()=>[x(f(i[e.power]),1)])),_:2},1024)),1===v(S).power&&v(S).sn!==e.sn&&1!==e.owned?(n(),u(Q,{key:2,name:"arrow-down",size:"22",color:"#666666"})):h("v-if",!0),v(S).power>=1&&v(S).sn===e.sn&&1!==e.owned?(n(),u(Q,{key:3,name:"arrow-down",size:"22",color:"#666666"})):h("v-if",!0)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1}),r(tl,{ref_key:"addUserModal",ref:m,id:v(d),onSuccess:Y},null,8,["id"]),r(T,{modelValue:g.value,"onUpdate:modelValue":l[2]||(l[2]=e=>g.value=e),closeable:"","border-radius":"20",mode:"center",height:"400"},{default:o((()=>[r(C,{class:"flex flex-col min-h-0 h-full px-[30rpx]",style:{width:"600rpx"}},{default:o((()=>[r(C,{class:"py-[30rpx] font-medium text-lg"},{default:o((()=>[x(" 成员处理方式 ")])),_:1}),r(C,{style:{padding:"26rpx 0"}},{default:o((()=>[r(L,{modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=e=>w.value=e)},{default:o((()=>[r(q,{name:"all",shape:"square"},{default:o((()=>[x(" 同步转移所有者的所有成员。 ")])),_:1}),r(q,{name:"kb",shape:"square",class:"flex !items-baseline mt-3"},{default:o((()=>[r(C,{style:{width:"500rpx","line-height":"40rpx"}},{default:o((()=>[x(" 不同步转移所有者的所有成员，只转移知识库。 ")])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1}),r(C,{class:"flex justify-end"},{default:o((()=>[r(C,null,{default:o((()=>[r(p,{size:"medium",onClick:l[1]||(l[1]=e=>g.value=!1)},{default:o((()=>[x(" 取消 ")])),_:1})])),_:1}),r(C,{class:"ml-4"},{default:o((()=>[r(p,{size:"medium",type:"primary",loading:k.value,onClick:j},{default:o((()=>[x(" 确认 ")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),r(M,{list:I.value,"border-radius":"24",customItemStyles:{"font-size":"30rpx","align-items":"start","padding-left":"30rpx"},modelValue:U.visible,"onUpdate:modelValue":l[3]||(l[3]=e=>U.visible=e),onClick:D},null,8,["list","modelValue"])])),_:1})}}}),nl=l({options:{virtualHost:!0},__name:"content",setup(e){const{getKBInfo:l,KBName:a,setKBId:d}=Ge(),i=B({list:[{name:"数据学习",type:"study"},{name:"数据测试",type:"test"},{name:"知识库设置",type:"setup"},{name:"团队成员",type:"team"}],current:0}),p=e=>{i.current=e};return T((async e=>{d(e.id),await l(),M({title:String(a.value||"知识库详情")})})),(e,l)=>{const d=t(s("u-navbar"),J),m=t(s("u-tabs"),H),f=c;return n(),u(f,{class:"h-full flex flex-col"},{default:o((()=>[v(I)?h("v-if",!0):(n(),u(d,{key:0,title:v(a),"title-color":"#333","title-bold":!0},null,8,["title"])),r(m,{"is-scroll":!1,ref:"tabs","active-color":e.$theme.primaryColor,list:i.list,current:i.current,onChange:p},null,8,["active-color","list","current"]),r(f,{class:"flex-1 min-h-0 pt-[20rpx]"},{default:o((()=>[0==i.current?(n(),u($e,{key:0})):h("v-if",!0),1==i.current?(n(),u(el,{key:1})):h("v-if",!0),2==i.current?(n(),u(al,{key:2})):h("v-if",!0),3==i.current?(n(),u(sl,{key:3})):h("v-if",!0)])),_:1})])),_:1})}}}),ul=se(l({__name:"kb_info",setup(l){const a=L(),u=P().query.id;return C((()=>`${O.baseUrl}mobile/packages/pages/kb_info/kb_info?id=${u}&webview=1&token=${a.token}`)),(l,a)=>{const u=t(s("page-meta"),e),d=c;return n(),b(_,null,[r(u,{"page-style":l.$theme.pageStyle},null,8,["page-style"]),r(d,{class:"h-full"},{default:o((()=>[r(nl)])),_:1})],64)}}}),[["__scopeId","data-v-8fdb9707"]]);export{ul as default};
