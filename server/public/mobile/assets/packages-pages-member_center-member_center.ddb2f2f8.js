import{d as e,u as a,A as t,s as l,cu as s,M as r,K as o,C as u,L as n,$ as i,bd as c,o as m,k as p,b as d,c as f,w as x,e as _,n as v,f as g,t as y,g as h,F as b,l as k,z as w,r as j,a as C,j as F,D as I,h as P,m as S,B as z,a4 as A,a6 as L,i as U}from"./index-d6d2a33a.js";import{_ as V}from"./page-meta.d751427a.js";import{_ as E}from"./u-avatar.b94cdf10.js";import{_ as R}from"./u-tabs.f14aec5a.js";import{p as T,_ as D}from"./payment.c92cd342.js";import{_ as O}from"./router-navigate.18e98059.js";import{_ as $}from"./u-empty.a728d8d9.js";import{F as M}from"./floating-menu.85d77f2f.js";import{_ as N}from"./u-icon.992584aa.js";import{_ as W}from"./u-popup.21776ef7.js";import{_ as B}from"./page-status.451737f8.js";import{_ as G}from"./tabbar.vue_vue_type_script_setup_true_lang.e2e30d1a.js";import{a as H,b as K}from"./member.9b01ec93.js";import{u as Z}from"./useLockFn.3b1f86f9.js";import{_ as q}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-badge.f9b9ebb9.js";import"./u-radio-group.5e4decfb.js";import"./emitter.1571a5d9.js";import"./u-button.97a3d07f.js";import"./u-loading.d153dd1a.js";const J=q(e({__name:"member_center",setup(e){w();const q=a(),J=t(),Q=l(s.LOADING),X=l([]);r();const Y=l({is_open:1,tips:"立即支付"}),ee=o({orderId:"",from:"member",showPay:!1,orderAmount:"",showCheck:!1,showPaySuccess:!1}),ae=l(-1),te=l(-1),le={1:"天",2:"个月"},se=u((()=>{var e;if(-1===ae.value&&(null==(e=X.value)?void 0:e.length)){const e=X.value.findIndex((e=>e.is_recommend));ae.value=-1!==e?e:0}return X.value[ae.value]||{}})),re=u((()=>{var e,a,t,l;if(null==(a=null==(e=se.value)?void 0:e.price_list)?void 0:a.length){const e=(null==(t=se.value)?void 0:t.price_list.findIndex((e=>e.is_recommend)))||0;te.value=-1!==e?e:0}return(null==(l=se.value)?void 0:l.price_list)||[]})),{isLock:oe,lockFn:ue}=Z((async()=>{A({mask:!0,title:"请稍后..."});try{const e=await H({member_price_id:re.value[te.value].id});L(),ee.orderId=e.order_id,ee.showPay=!0,ee.orderAmount=e.order_amount}catch(e){setTimeout((()=>L()),1e3)}})),ne=async()=>{ee.showPay=!1,ee.showPaySuccess=!0,J.getUser()},ie=async()=>{const e=await K();X.value=[],setTimeout((()=>{X.value=e}),250)};return n((async()=>{(async()=>{try{await Promise.all([ie()]),Q.value=s.NORMAL}catch(e){Q.value=s.ERROR}})()})),i((e=>{((null==e?void 0:e.id)||e["amp;id"])&&(e.from||e["amp;from"])&&(ee.orderId=(null==e?void 0:e.id)||e["amp;id"],ee.from=e.from||e["amp;from"]),(null==e?void 0:e.checkPay)&&(ee.showCheck=!0)})),c((async()=>{})),(e,a)=>{const t=j(C("page-meta"),V),l=j(C("u-avatar"),E),s=F,r=j(C("u-tabs"),R),o=j(C("price"),D),u=I,n=U,i=P,c=j(C("router-navigate"),O),w=j(C("u-empty"),$),A=j(C("floating-menu"),M),L=j(C("u-icon"),N),H=j(C("u-popup"),W),K=j(C("page-status"),B),Z=j(C("tabbar"),G);return m(),p(b,null,[d(t,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),Y.value.is_open?(m(),f(K,{key:0,class:"h-full",status:Q.value},{error:x((()=>[d(w,{text:"加载出错～"})])),default:x((()=>{var t;return[(null==(t=_(q).config)?void 0:t.member_package_open)?(m(),f(s,{key:0,class:"h-full flex flex-col min-h-full"},{default:x((()=>[d(s,{class:"member-account-info flex items-center pl-[40rpx] pt-[30rpx]"},{default:x((()=>[d(l,{src:_(J).userInfo.avatar,size:120},null,8,["src"]),d(s,{class:"text-main ml-[30rpx]"},{default:x((()=>[d(s,{class:"flex items-center"},{default:x((()=>[d(s,{class:"max-w-[220rpx] text-2xl font-medium line-clamp-1",style:v({maxWidth:_(J).userInfo.package_name?"300rpx":"100%"})},{default:x((()=>[g(y(_(J).userInfo.nickname),1)])),_:1},8,["style"]),_(J).userInfo.package_name?(m(),f(s,{key:0,class:"flex-none bg-[#FFE5CC] ml-[16rpx] text-xs text-[#FF8F1F] rounded-[6rpx] px-[10rpx] py-[6rpx]"},{default:x((()=>[g(y(_(J).userInfo.package_name),1)])),_:1})):h("v-if",!0)])),_:1}),d(s,{class:"text-xs text-content mt-[18rpx]"},{default:x((()=>[g(" 有效期至："+y(_(J).userInfo.package_time||"-"),1)])),_:1})])),_:1})])),_:1}),d(s,{class:"p-[30rpx]"},{default:x((()=>[d(r,{modelValue:ae.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ae.value=e),"is-scroll":!0,bgColor:"none",list:X.value,"active-color":e.$theme.primaryColor},null,8,["modelValue","list","active-color"])])),_:1}),d(s,{class:"member-center flex-1 min-h-0"},{default:x((()=>[d(u,{"scroll-x":"",class:"whitespace-nowrap pt-[30rpx]"},{default:x((()=>[(m(!0),p(b,null,k(_(re),((e,a)=>(m(),f(s,{class:S(["member-item inline-flex relative items-center mr-[30rpx]",{"!pt-[60rpx]":e.tags,"member-item--active":a==te.value}]),key:e.id,onClick:e=>te.value=a},{default:x((()=>[e.tags?(m(),f(s,{key:0,class:"bg-[#FE8484] text-white rounded-tl-lg rounded-r-[5rpx] absolute top-[-1px] left-[-1px] px-[12rpx] py-[6rpx] text-xs"},{default:x((()=>[z("span",null,y(e.tags),1)])),_:2},1024)):h("v-if",!0),d(s,{class:"flex flex-col items-center w-[200rpx] px-[20rpx]"},{default:x((()=>[d(s,{class:"text-base font-medium mb-[10px] line-clamp-1"},{default:x((()=>[g(y(le[e.duration_type]?e.duration+le[e.duration_type]:"永久"),1)])),_:2},1024),d(s,null,{default:x((()=>[d(o,{content:e.sell_price,color:"#000",fontWeight:"500",mainSize:"45rpx",minorSize:"32rpx"},null,8,["content"])])),_:2},1024),e.lineation_price>0?(m(),f(s,{key:0},{default:x((()=>[d(o,{color:"#999999",lineThrough:"",content:e.lineation_price,mainSize:"28rpx",minorSize:"28rpx"},null,8,["content"])])),_:2},1024)):h("v-if",!0)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1}),d(s,{class:""},{default:x((()=>{var e;return[d(s,{class:"font-medium text-xl pt-1"},{default:x((()=>[g("会员权益")])),_:1}),(m(!0),p(b,null,k(_(se).benefits_list,((e,a)=>(m(),f(s,{class:"text-base py-[16rpx]",key:a},{default:x((()=>[d(s,{class:"flex justify-between"},{default:x((()=>[d(s,{class:"flex flex-1"},{default:x((()=>[d(n,{src:e.image,class:"w-[36rpx] h-[36rpx]"},null,8,["src"]),d(i,{class:"text-tx-primary ml-[20rpx] line-clamp-1"},{default:x((()=>[g(y(e.name),1)])),_:2},1024)])),_:2},1024),d(s,{class:"text-primary flex-none ml-2"},{default:x((()=>[g(y(e.describe),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),(null==(e=_(re)[te.value])?void 0:e.is_give)?(m(),f(s,{key:0,class:"text-base mt-4 p-[8px] bg-[#F2F6FA] rounded-xl"},{default:x((()=>{var e,a;return[0!=(null==(e=_(re)[te.value])?void 0:e.give_balance)?(m(),f(s,{key:0,class:"pb-[8px]"},{default:x((()=>[d(i,null,{default:x((()=>[g("赠送"+y(_(q).getTokenUnit)+"：",1)])),_:1}),d(i,null,{default:x((()=>{var e;return[g(y(null==(e=_(re)[te.value])?void 0:e.give_balance),1)]})),_:1})])),_:1})):h("v-if",!0),0!=(null==(a=_(re)[te.value])?void 0:a.give_robot)?(m(),f(s,{key:1},{default:x((()=>[d(i,null,{default:x((()=>[g("赠送智能体：")])),_:1}),d(i,null,{default:x((()=>{var e;return[g(y(null==(e=_(re)[te.value])?void 0:e.give_robot),1)]})),_:1})])),_:1})):h("v-if",!0)]})),_:1})):h("v-if",!0)]})),_:1}),d(s,{class:"bg-white fixed bottom-0 w-full left-0"},{default:x((()=>[d(s,{class:"p-[20rpx]"},{default:x((()=>[d(s,{class:"w-full rounded-full member-center-btn py-[20rpx] text-center text-white",onClick:_(ue)},{default:x((()=>[g(" 立即支付 ")])),_:1},8,["onClick"]),d(c,{class:"text-center text-info text-sm mt-2",to:"/packages/pages/agreement/agreement?type=payment"},{default:x((()=>[g(" 支付即视为您同意《会员支付协议》 ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):(m(),f(s,{key:1,class:"py-[400rpx]"},{default:x((()=>[d(w,{text:"功能未开启"})])),_:1})),d(A),d(T,{show:ee.showPay,"onUpdate:show":a[1]||(a[1]=e=>ee.showPay=e),"order-id":ee.orderId,showCheck:ee.showCheck,"onUpdate:showCheck":a[2]||(a[2]=e=>ee.showCheck=e),from:ee.from,redirect:"/mobile/packages/pages/member_center/member_center","order-amount":ee.orderAmount,onSuccess:ne},null,8,["show","order-id","showCheck","from","order-amount"]),d(H,{modelValue:ee.showPaySuccess,"onUpdate:modelValue":a[4]||(a[4]=e=>ee.showPaySuccess=e),"safe-area-inset-bottom":!0,"mask-close-able":!1,"border-radius":"14","z-index":899,round:"",mode:"center",width:"600"},{default:x((()=>[d(s,{class:"pt-[20rpx]"},{default:x((()=>[d(s,{class:"px-[30rpx] py-[40rpx]"},{default:x((()=>[d(s,{class:"text-success text-center"},{default:x((()=>[d(L,{name:"checkmark-circle-fill",size:"100"})])),_:1}),d(s,{class:"text-xl font-medium mt-[20rpx] text-center"},{default:x((()=>[g(" 支付成功 ")])),_:1}),d(s,{class:"flex mt-[60rpx]"},{default:x((()=>[d(s,{class:"flex-1"},{default:x((()=>[d(s,{class:"h-[72rpx] leading-[72rpx] rounded-full bg-page text-center",onClick:a[3]||(a[3]=e=>ee.showPaySuccess=!1)},{default:x((()=>[d(i,null,{default:x((()=>[g("继续")])),_:1})])),_:1})])),_:1}),d(s,{class:"flex-1 ml-[20rpx]"},{default:x((()=>[d(c,{class:"h-[72rpx] leading-[72rpx] rounded-full bg-primary text-center text-btn-text",to:"/pages/index/index","nav-type":"reLaunch"},{default:x((()=>[d(i,null,{default:x((()=>[g("返回首页")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])]})),_:1},8,["status"])):h("v-if",!0),d(Z)],64)}}}),[["__scopeId","data-v-1b82daeb"]]);export{J as default};
