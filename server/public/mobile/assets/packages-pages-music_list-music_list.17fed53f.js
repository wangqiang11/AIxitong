import{d as e,u as a,s as t,K as l,o as s,k as o,b as u,w as r,f as i,t as n,e as c,F as m,j as p,r as d,a as f,aC as x,cA as _,J as y,C as g,x as v,aF as h,l as b,g as w,c as k,z as C,a$ as j,m as V,p as z,U as T,V as U,i as F,h as S}from"./index-d6d2a33a.js";import{_ as R}from"./page-meta.d751427a.js";import{_ as $}from"./u-image.9574760c.js";import{_ as q}from"./u-icon.992584aa.js";import{_ as A}from"./u-loading.d153dd1a.js";import{_ as L}from"./z-paging.6c8c2edf.js";import{F as N}from"./floating-menu.85d77f2f.js";import{_ as B}from"./u-action-sheet.29883fbc.js";import{_ as E}from"./u-button.97a3d07f.js";import{_ as I}from"./u-popup.21776ef7.js";import{_ as J}from"./icon_music.5ddb40fe.js";import{b as K,d as Q}from"./music.d5e913c6.js";import{a as D}from"./download.954a43dc.js";import{u as G}from"./useCopy.4954d67d.js";import{m as H}from"./icon_music_fail.bb797fc1.js";import{_ as M}from"./u-select.65c5ee75.js";import{u as O}from"./useLockFn.3b1f86f9.js";import"./_plugin-vue_export-helper.1b428a4d.js";const P=e({__name:"music-share",emits:["success","close"],setup(e,{expose:y,emit:g}){a();const v=t(!1),h=t(!1),b=t([]),w=l({category_id:"",records_id:"",category_name:""}),{lockFn:k,isLock:C}=O((async()=>{await _(w),v.value=!1,g("success",w.records_id)})),j=e=>{w.category_id=e[0].value,w.category_name=e[0].label},V=()=>{g("close")};return y({open:e=>{(async()=>{try{const e=await x({type:2,share:1});e.unshift({name:"全部",id:""}),b.value=e}catch(e){console.log("获取音乐分类失败=>",e)}})(),v.value=!0,w.records_id=e}}),(e,a)=>{const t=p,l=d(f("u-icon"),q),x=d(f("u-button"),E),_=d(f("u-popup"),I),y=d(f("u-select"),M);return s(),o(m,null,[u(_,{modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=e=>v.value=e),mode:"center","border-radius":"14",duration:"16",onClose:V},{default:r((()=>[u(t,{class:"w-[650rpx]"},{default:r((()=>[u(t,{class:"p-[30rpx] text-center text-lg font-medium"},{default:r((()=>[i("分享至广场")])),_:1}),u(t,{class:"h-[230rpx] p-[30rpx]"},{default:r((()=>[u(t,{class:"flex items-center justify-between rounded-[12rpx] p-[20rpx] text-content bg-[#eeeeee]",onClick:a[0]||(a[0]=e=>h.value=!0)},{default:r((()=>[i(n(w.category_name?w.category_name:"全部")+" ",1),u(l,{name:"arrow-right"})])),_:1})])),_:1}),u(t,{class:"flex justify-center mt-[30rpx] pb-[20rpx]"},{default:r((()=>[u(x,{type:"primary",customStyle:{width:"220rpx"},loading:c(C),onClick:c(k)},{default:r((()=>[i(" 确定 ")])),_:1},8,["loading","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),u(y,{modelValue:h.value,"onUpdate:modelValue":a[2]||(a[2]=e=>h.value=e),list:b.value,valueName:"id",labelName:"name",confirmColor:e.$theme.primaryColor,onConfirm:j},null,8,["modelValue","list","confirmColor"])],64)}}}),W=e({__name:"music_list",setup(e){const x=C(),_=a(),M=y(),{copy:O}=G(),W=t([]),X=[{name:"全部",type:-1},{name:"生成中",type:1},{name:"生成成功",type:2},{name:"生成失败",type:3}],Y=t(!1),Z=y(null),ee=t([]),ae=t(-1),te=l({show:!1,item:{}}),le=g((()=>{const e=[{value:"delete",text:"删除",color:"#EA0000"}];return 2==te.item.status&&e.unshift({value:"download",text:"下载"}),e})),se=e=>{te.show=!0,te.item=e},oe=t(),ue=async e=>{const a=le.value[e].value,t=te.item;switch(a){case"delete":(async e=>{const{cancel:a}=await T({title:"温馨提示",content:"确定删除？"});a||(await Q({id:e}),ce())})(t.id);break;case"download":j()?oe.value=!0:D(t.audio_url,t.title)}},re=async()=>{await O(te.item.audio_url),oe.value=!1},ie=y(),ne=async(e,a)=>{try{const{lists:t}=await K({page_no:e,page_size:a,status:ae.value});M.value.complete(t)}catch(t){M.value.complete(!1)}finally{setTimeout((()=>{clearTimeout(ie.value),[-1,1].includes(ae.value)&&W.value.some((e=>1===e.status))&&(ie.value=setTimeout((()=>{ce()}),6e3))}),100)}},ce=()=>{var e;null==(e=M.value)||e.refresh()};return v(ae,(()=>{ce()})),h((()=>{clearTimeout(ie.value)})),(e,a)=>{const t=d(f("page-meta"),R),l=p,y=d(f("u-image"),$),g=F,v=S,h=d(f("u-icon"),q),C=d(f("u-loading"),A),j=d(f("z-paging"),L),K=d(f("floating-menu"),N),Q=d(f("u-action-sheet"),B),D=d(f("u-button"),E),G=d(f("u-popup"),I);return s(),o(m,null,[u(t,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),u(j,{ref_key:"pagingRef",ref:M,modelValue:W.value,"onUpdate:modelValue":a[0]||(a[0]=e=>W.value=e),"auto-clean-list-when-reload":!1,"safe-area-inset-bottom":!0,onQuery:ne,fixed:!0},{top:r((()=>[u(l,{class:"p-[20rpx] flex mx-[-10rpx]"},{default:r((()=>[(s(),o(m,null,b(X,(e=>u(l,{class:"flex-1 px-[10rpx]",key:e.type},{default:r((()=>[u(l,{class:V(["bg-white py-[16rpx] rounded-[10rpx] shadow-light text-center",{"!bg-primary text-white":e.type===ae.value}]),onClick:a=>ae.value=e.type},{default:r((()=>[i(n(e.name),1)])),_:2},1032,["class","onClick"])])),_:2},1024))),64))])),_:1})])),default:r((()=>[u(l,{class:"flex flex-wrap px-[10rpx]"},{default:r((()=>[(s(!0),o(m,null,b(W.value,(e=>(s(),k(l,{class:"w-[50%] px-[10rpx] mb-[20rpx]",key:e.id},{default:r((()=>[u(l,{class:"h-[390rpx] relative rounded-[15rpx] overflow-hidden",onClick:a=>{return t=e.id,void x.navigateTo({path:"/packages/pages/music_player/music_player",query:{id:t}});var t}},{default:r((()=>[u(l,{class:"w-full h-full"},{default:r((()=>[u(y,{src:e.image_url,width:"100%",height:"100%"},null,8,["src"])])),_:2},1024),u(l,{class:"flex flex-col h-full absolute left-0 right-0 top-0 bottom-0 z-[999]"},{default:r((()=>[u(l,{class:"p-[20rpx] flex-1"},{default:r((()=>[u(l,{class:"flex justify-between"},{default:r((()=>[u(l,{class:"bg-[rgba(0,0,0,0.5)] inline-flex text-white p-[10rpx] rounded-full text-xs items-center"},{default:r((()=>[u(g,{src:J,class:"w-[24rpx] h-[24rpx]"}),u(v,{class:"ml-[6rpx]"},{default:r((()=>[i(n(e.duration),1)])),_:2},1024)])),_:2},1024),c(_).getSquareConfig.music_award.is_open?(s(),k(l,{key:0,class:"bg-[rgba(0,0,0,0.5)] inline-flex text-white w-[48rpx] h-[48rpx] rounded-full text-xs items-center justify-center",onClick:z((a=>(async(e,a)=>{ee.value.includes(e)||a?await T({title:"温馨提示",content:"该音乐已分享过了！"}):(Y.value=!0,await U(),setTimeout((()=>Z.value.open(e)),50))})(e.id,e.is_share)),["stop"])},{default:r((()=>[u(h,{name:"share"})])),_:2},1032,["onClick"])):w("v-if",!0)])),_:2},1024)])),_:2},1024),u(l,{class:"bg-[rgba(0,0,0,0.3)] px-[20rpx] py-[25rpx] text-white",style:{"backdrop-filter":"blur(10px)","border-radius":"0 0 15rpx 15rpx"}},{default:r((()=>[u(l,{class:"line-clamp-1 font-bold"},{default:r((()=>[i(n(e.title),1)])),_:2},1024),u(l,{class:"flex text-xs mt-[15rpx] items-center"},{default:r((()=>[u(l,{class:"mr-auto"},{default:r((()=>[i(n(e.create_time),1)])),_:2},1024),u(l,{onClick:z((a=>se(e)),["stop"])},{default:r((()=>[u(h,{name:"more-dot-fill",size:32})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024),3==e.status||1==e.status?(s(),k(l,{key:0,class:"h-full absolute left-0 right-0 top-0 bottom-0 z-[999] bg-white flex items-center justify-center flex-col"},{default:r((()=>[1==e.status?(s(),o(m,{key:0},[u(C,{size:50,mode:"flower"}),u(l,{class:"text-content text-sm mt-[20rpx]"},{default:r((()=>[i(" 歌曲生成中，请稍等！ ")])),_:1})],64)):(s(),o(m,{key:1},[u(h,{name:c(H),size:50},null,8,["name"]),u(l,{class:"text-content text-sm mt-[20rpx]"},{default:r((()=>[i(" 音乐生成失败 ")])),_:1}),u(l,{class:"absolute bottom-0 w-full px-[20rpx] py-[25rpx] flex items-center text-muted"},{default:r((()=>[u(l,{class:"mr-auto text-xs"},{default:r((()=>[i(n(e.create_time),1)])),_:2},1024),u(l,{onClick:z((a=>se(e)),["stop"])},{default:r((()=>[u(h,{name:"more-dot-fill",size:32})])),_:2},1032,["onClick"])])),_:2},1024)],64))])),_:2},1024)):w("v-if",!0)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})])),_:1},8,["modelValue"]),w("    悬浮菜单    "),u(K),u(Q,{"safe-area-inset-bottom":"",list:c(le),modelValue:te.show,"onUpdate:modelValue":a[1]||(a[1]=e=>te.show=e),onClick:ue},null,8,["list","modelValue"]),u(G,{modelValue:oe.value,"onUpdate:modelValue":a[2]||(a[2]=e=>oe.value=e),mode:"center","border-radius":"15",closeable:""},{default:r((()=>[u(l,{class:"w-[650rpx] p-[40rpx]"},{default:r((()=>[u(l,{class:"text-lg font-bold text-center mb-[40rpx]"},{default:r((()=>[i(" 下载音乐 ")])),_:1}),u(l,{class:"mb-[40rpx]"},{default:r((()=>[i(" 当前环境不支持下载，请复制链接到浏览器打开下载 ")])),_:1}),u(D,{type:"primary",shape:"circle",onClick:re},{default:r((()=>[i(" 复制链接 ")])),_:1})])),_:1})])),_:1},8,["modelValue"]),Y.value?(s(),k(P,{key:0,ref_key:"shareRef",ref:Z,onClose:a[3]||(a[3]=e=>Y.value=!1),onSuccess:a[4]||(a[4]=e=>ee.value.push(e))},null,512)):w("v-if",!0)],64)}}});export{W as default};
