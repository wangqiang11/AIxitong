import{d as e,K as l,o as a,c as t,w as s,b as u,k as o,l as r,F as i,j as m,D as d,r as n,a as p,m as c,e as f,n as _,f as x,t as g,s as v,q as h,p as w,g as b,i as y,h as V,S as k,x as j,a7 as L,J as C,u as U,A as z,$ as E,bo as T,z as $,ae as D,ag as F,b3 as I}from"./index-d6d2a33a.js";import{_ as S}from"./page-meta.d751427a.js";import{_ as q}from"./u-empty.a728d8d9.js";import{_ as A}from"./tabbar.vue_vue_type_script_setup_true_lang.e2e30d1a.js";import{_ as G}from"./u-icon.992584aa.js";import{_ as M}from"./router-navigate.18e98059.js";import{_ as J}from"./u-navbar.d70905ec.js";import{_ as O}from"./u-form.f207500c.js";import{_ as P}from"./u-button.97a3d07f.js";import{u as B}from"./useLockFn.3b1f86f9.js";import{g as H,b as K,c as R,e as X,f as N}from"./draw.cfe8756a.js";import{_ as Z,D as Q,a as W,P as Y}from"./item-title.vue_vue_type_script_setup_true_lang.c5dbcb83.js";import{_ as ee}from"./u-form-item.36bcbf1f.js";import{a as le}from"./index.3dd6f2ef.js";import{_ as ae}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as te}from"./u-image.9574760c.js";import{u as se,j as ue}from"./index.22b2ad12.js";import{_ as oe}from"./app-slider.f52d5aca.js";import{_ as re}from"./app-select.66776d41.js";import{_ as ie,a as me}from"./u-collapse.5c69f838.js";import{U as de}from"./uploader-picture.d97f4fdc.js";import"./u-badge.f9b9ebb9.js";import"./l-textarea.9d4b6972.js";import"./u-loading.d153dd1a.js";import"./u-popup.21776ef7.js";import"./emitter.1571a5d9.js";import"./u-tag.fd761889.js";import"./u-search.7e682473.js";import"./u-radio-group.5e4decfb.js";import"./u-checkbox.0fdc3635.js";import"./uni-file-picker.87d7f36a.js";import"./image-uploader.b31ee9fb.js";const ne=ae(e({__name:"sd-size",props:{modelValue:{default:"512x512"}},emits:["update:modelValue"],setup(e,{emit:v}){const h=e,{modelValue:w}=le(h,v),b=l({lists:[{name:"头像",scaleLabel:"1:1",scaleValue:"512x512",width:40,height:40},{name:"手机壁纸",scaleLabel:"1:2",scaleValue:"720x1440",width:20,height:40},{name:"小红书",scaleLabel:"2:3",scaleValue:"800x1200",width:25,height:40},{name:"文章",scaleLabel:"4:3",scaleValue:"1365x1024",width:40,height:30},{name:"媒体",scaleLabel:"3:4",scaleValue:"1024x1365",width:30,height:40},{name:"宣传海报",scaleLabel:"9:16",scaleValue:"720x1280",width:24,height:40},{name:"电脑壁纸",scaleLabel:"16:9",scaleValue:"1920x1080",width:40,height:24},{name:"横版名片",scaleLabel:"3:2",scaleValue:"960x640",width:40,height:30}]});return w.value="512x512",(e,l)=>{const v=m,h=d,y=n(p("u-form-item"),ee);return a(),t(v,{class:"mt-4"},{default:s((()=>[u(Z,{title:"图片尺寸",tips:"分辨率越高生成结果越慢，服务器配置比较低时可能会出现绘画失败、超时、缓慢等情况",required:""}),u(y,{prop:"size"},{default:s((()=>[u(v,{class:"flex-1 bg-white rounded-lg py-[20rpx] pr-[20rpx] overflow-hidden"},{default:s((()=>[u(h,{class:"flex-1 min-w-0 whitespace-nowrap","scroll-x":""},{default:s((()=>[(a(!0),o(i,null,r(b.lists,((e,l)=>(a(),t(v,{key:l,class:"inline-block w-[140rpx] ml-[20rpx]"},{default:s((()=>[u(v,{class:c(["picture-size text-center hover:text-primary",{"picture-size-active":f(w)==(null==e?void 0:e.scaleValue)}]),onClick:l=>w.value=e.scaleValue},{default:s((()=>[u(v,{class:"flex justify-center items-center h-[40rpx]"},{default:s((()=>[u(v,{class:"rect",style:_({width:`${e.width}rpx`,height:`${e.height}rpx`})},null,8,["style"])])),_:2},1024),u(v,{class:"text-[#101010] font-medium mt-[8rpx] size-scale"},{default:s((()=>[x(g(e.scaleLabel),1)])),_:2},1024),u(v,{class:"text-[#808D9C] mt-[8rpx] text-xs size-scale"},{default:s((()=>[x(g(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-dee587f4"]]),pe="/mobile/assets/empty-98182726.png",ce=e({__name:"sd-model",props:{modelValue:{default:()=>[]},cateList:null,modelList:null},emits:["update:modelValue","changeCate"],setup(e,{emit:l}){const _=e,{modelValue:j}=le(_,l),L=v(0),C=se((e=>{const a=ue(e)?e:e.detail.current;L.value!==a&&(L.value=a,l("changeCate",_.cateList[a].value))}),50);return(l,_)=>{const v=m,U=d,z=n(p("u-image"),te),E=n(p("u-icon"),G),T=y,$=V,D=k,F=h,I=n(p("u-form-item"),ee);return a(),t(v,{class:"mt-4"},{default:s((()=>[u(Z,{title:"模型选择",tips:"让AI根据此模型的风格绘制图片，修改合适的描述词和参数可以让生成效果更加精美",required:""}),u(I,{label:""},{default:s((()=>[u(v,{class:"flex-1 min-w-0 p-[20rpx] bg-white rounded-lg overflow-hidden"},{default:s((()=>[u(U,{class:"text-sm whitespace-nowrap","scroll-x":""},{default:s((()=>[(a(!0),o(i,null,r(e.cateList,((e,l)=>(a(),t(v,{key:l,class:c(["inline-block bg-page rounded-full mr-[30rpx] px-[40rpx] text-main",{"!bg-primary !text-white":l===L.value}]),onClick:w((e=>f(C)(l)),["stop"])},{default:s((()=>[x(g(e.label),1)])),_:2},1032,["class","onClick"])))),128))])),_:1}),u(F,{class:"h-[480rpx]",circular:"",current:L.value,"indicator-dots":!1,onChange:_[0]||(_[0]=e=>f(C)(e))},{default:s((()=>[(a(!0),o(i,null,r(e.cateList,((l,m)=>(a(),t(D,{key:m},{default:s((()=>[u(U,{"scroll-y":"true",class:"h-[480rpx] pt-[20rpx] mx-[-10rpx]"},{default:s((()=>[e.modelList.length?(a(),t(v,{key:0,class:"flex flex-wrap"},{default:s((()=>[(a(!0),o(i,null,r(e.modelList,(e=>(a(),t(v,{class:"w-[25%] px-[10rpx] mb-[10rpx]",key:e.id},{default:s((()=>[u(v,{class:"h-full",onClick:l=>{return a=e.model_name,void(j.value=a);var a}},{default:s((()=>[u(v,{class:"pt-[100%] relative h-0 rounded-[10rpx] overflow-hidden"},{default:s((()=>[u(v,{class:"absolute inset-0 left-0 top-0"},{default:s((()=>[u(z,{src:e.cover,class:"h-full w-full",width:"100%",height:"100%"},null,8,["src"])])),_:2},1024),f(j)===e.model_name?(a(),t(v,{key:0,class:"absolute bg-[rgba(0,0,0,0.5)] inset-0 left-0 top-0 flex items-center justify-center text-white"},{default:s((()=>[u(E,{name:"checkmark-circle-fill",size:40})])),_:1})):b("v-if",!0)])),_:2},1024),u(v,{class:"text-center text-xs line-clamp-1"},{default:s((()=>[x(g(e.title),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})):(a(),t(v,{key:1,class:"flex flex-col items-center justify-center h-full"},{default:s((()=>[u(T,{class:"w-[200rpx] h-[200rpx]",src:f(pe)},null,8,["src"]),u($,{class:"mt-4 text-content"},{default:s((()=>[x("暂无相关模型")])),_:1})])),_:1}))])),_:1})])),_:2},1024)))),128))])),_:1},8,["current"])])),_:1})])),_:1})])),_:1})}}}),fe=e({__name:"sd-lora",props:{modelValue:{default:()=>[]},currentLora:null,modelList:null},emits:["update:modelValue","changeCate"],setup(e,{emit:l}){const d=e,{modelValue:c}=le(d,l),_=v([]);j((()=>d.currentLora),(e=>{var l;_.value=(null==(l=d.modelList.find((l=>l.model_name===e)))?void 0:l.loras)||[],c.value.len?_.value.map((e=>{var l;c.value.includes(e.model_name)||(c.value=null==(l=c.value)?void 0:l.filter((l=>l!==e.model_name)))})):c.value=[]}),{immediate:!0,deep:!1});return(e,l)=>{const d=n(p("u-image"),te),v=m,h=n(p("u-icon"),G),w=y,k=V,j=n(p("u-form-item"),ee);return a(),t(v,{class:"mt-4"},{default:s((()=>[u(Z,{title:"模型选择",tips:"在基础模型上叠加微调模型，让画面更细腻更可控"}),u(j,{label:""},{default:s((()=>[u(v,{class:"flex-1 min-w-0 p-[20rpx] bg-white rounded-lg"},{default:s((()=>[_.value.length?(a(),t(v,{key:0,class:"flex flex-wrap"},{default:s((()=>[(a(!0),o(i,null,r(_.value,(e=>(a(),t(v,{class:"w-[25%] px-[10rpx] mb-[10rpx]",key:e.id},{default:s((()=>[u(v,{class:"h-full",onClick:l=>{return a=e.model_name,void(c.value.includes(a)?c.value=c.value.filter((e=>e!==a)):c.value.push(a));var a}},{default:s((()=>[u(v,{class:"pt-[100%] relative h-0 rounded-[10rpx] overflow-hidden"},{default:s((()=>[u(v,{class:"absolute inset-0 left-0 top-0"},{default:s((()=>[u(d,{src:e.cover,class:"h-full w-full",width:"100%",height:"100%"},null,8,["src"])])),_:2},1024),f(c).includes(e.model_name)?(a(),t(v,{key:0,class:"absolute bg-[rgba(0,0,0,0.5)] inset-0 left-0 top-0 flex items-center justify-center text-white"},{default:s((()=>[u(h,{name:"checkmark-circle-fill",size:40})])),_:1})):b("v-if",!0)])),_:2},1024),u(v,{class:"text-center text-xs line-clamp-1"},{default:s((()=>[x(g(e.title),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})):(a(),t(v,{key:1,class:"flex flex-col items-center justify-center h-full"},{default:s((()=>[u(w,{class:"w-[200rpx] h-[200rpx]",src:f(pe)},null,8,["src"]),u(k,{class:"mt-4 text-content"},{default:s((()=>[x("暂无关联的微调模型")])),_:1})])),_:1}))])),_:1})])),_:1})])),_:1})}}}),_e=ae(e({__name:"sd-options",props:{modelValue:{default:()=>{}},samplers:{default:()=>[]}},emits:["update:modelValue"],setup(e,{emit:l}){const o=e,r=v(!0),{modelValue:i}=le(o,l),d=e=>{const l=parseFloat(e.target.value);i.value.step=l>=150?150:l<0?0:l},c=e=>{const l=parseFloat(e.target.value);i.value.cfg_scale=l>=30?30:l<0?0:l};return(l,o)=>{const _=n(p("app-slider"),oe),x=m,g=L,v=n(p("app-select"),re),h=n(p("u-collapse-item"),ie),w=n(p("u-collapse"),me);return a(),t(w,null,{default:s((()=>[(a(),t(h,{title:"高级参数",key:"index",open:r.value},{default:s((()=>[u(x,{class:"flex-1 min-w-0 p-[20rpx] bg-white rounded-lg"},{default:s((()=>[b(" 绘画步数 "),u(x,{class:"text-base text-main"},{default:s((()=>[u(Z,{title:"绘画步数",tips:"越低：细节简练，耗时更短；越高：细节丰富，耗时变长；注*步数过高可能产生细节扭曲","font-weight":"400"}),u(x,{class:"flex items-center justify-between mt-[10rpx]"},{default:s((()=>[u(x,{class:"w-[480rpx]"},{default:s((()=>[u(_,{min:0,max:150,step:1,showValue:!1,activeColor:l.$theme.primaryColor,modelValue:f(i).step,"onUpdate:modelValue":o[0]||(o[0]=e=>f(i).step=e)},null,8,["activeColor","modelValue"])])),_:1}),u(g,{class:"options-input",type:"number",min:0,max:150,style:{width:"80rpx"},step:"1",modelValue:f(i).step,"onUpdate:modelValue":o[1]||(o[1]=e=>f(i).step=e),onBlur:d},null,8,["modelValue"])])),_:1})])),_:1}),b(" 文本强度 "),u(x,{class:"text-base text-main mt-2"},{default:s((()=>[u(Z,{title:"文本强度",tips:"低：淡化输入的特征，淡化风格；高：强化输入的特征，强化风格；最佳使用区间7-12，推荐不超过15","font-weight":"400"}),u(x,{class:"flex items-center justify-between mt-[10rpx]"},{default:s((()=>[u(x,{class:"w-[480rpx]"},{default:s((()=>[u(_,{min:0,max:30,step:.5,showValue:!1,activeColor:l.$theme.primaryColor,modelValue:f(i).cfg_scale,"onUpdate:modelValue":o[2]||(o[2]=e=>f(i).cfg_scale=e)},null,8,["step","activeColor","modelValue"])])),_:1}),u(g,{class:"options-input",type:"number",min:0,max:30,style:{width:"80rpx"},step:"0.5",modelValue:f(i).cfg_scale,"onUpdate:modelValue":o[3]||(o[3]=e=>f(i).cfg_scale=e),onBlur:c},null,8,["modelValue"])])),_:1})])),_:1}),b(" 采样模式 "),u(x,{class:"text-base text-main mt-2"},{default:s((()=>[u(Z,{title:"采样模式",tips:"靠前的采样（euler）：适合动漫，细节简练，快速；靠后的采样（DPM）：适合写实，细节丰富，较慢","font-weight":"400"}),u(x,{class:"flex-1 mt-[10rpx]"},{default:s((()=>[u(v,{modelValue:f(i).sampler_name,"onUpdate:modelValue":o[4]||(o[4]=e=>f(i).sampler_name=e),popupTitle:"采样器",dataLists:e.samplers,placeholder:"请选择",closeable:!1,name:"name",value:"name"},null,8,["modelValue","dataLists"])])),_:1})])),_:1}),b(" 随机种子 "),u(x,{class:"text-base text-main mt-2"},{default:s((()=>[u(Z,{title:"随机种子",tips:"每次生成图的初始画布，种子、提示词、参数和模型相同的情况下，可复原绘画结果","font-weight":"400"}),u(x,{class:"flex-1 mt-[10rpx]"},{default:s((()=>[u(g,{class:"options-input",type:"number",modelValue:f(i).seed,"onUpdate:modelValue":o[5]||(o[5]=e=>f(i).seed=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["open"]))])),_:1})}}}),[["__scopeId","data-v-589577a1"]]),xe=ae(e({__name:"sd",setup(e){const _=$(),h=D(),w=C(),y=U(),k=z(),j=v([{mode:Q.TEXT,name:"文生图"},{mode:Q.IMAGE,name:"图生图"}]),L=v({draw_api:W.SD,draw_type:Q.TEXT,draw_model:"",draw_loras:"",denoising_strength:.75,size:"512x512",prompt:"",negative_prompt:"",action:"generate",image_mask:"",image_id:"",complex_params:{step:20,sampler_name:"Euler a",seed:-1,cfg_scale:7}}),Z=l({model:{cate:[],list:[]},config:{},loras:[],samplers:[]}),ee=async()=>X().then((async e=>{const l=e.map((e=>({value:e.id,label:e.name})));Z.model.cate=[{label:"全部",value:0},...l],await le()})),le=async(e=0)=>{const l=await H({category_id:e});Z.model.list=l},ae=F((async()=>{Z.config=await R({draw_api:W.SD}),I({title:Z.config.diy_name})}),ee,le,(async()=>{Z.samplers=await N()})),{lockFn:te,isLock:se}=B((async()=>{try{if(L.value.draw_type===Q.IMAGE&&""===L.value.image_mask)return uni.$u.toast("请上传参考图");if(console.log(L.value.prompt),""===L.value.prompt)return uni.$u.toast("请输入提示词");if(""===L.value.draw_api)return uni.$u.toast("请选择主要模型");"img2img"!==L.value.draw_type&&(L.value.image_mask=""),await K({...L.value}),L.value.prompt="",_.navigateTo("/packages/pages/draw_list/draw_list?model=sd")}catch(e){}}));return ae(),E((()=>{T("drawRegenerate",(e=>{Object.assign(L.value,e)}));const e=h.query;try{const l=JSON.parse(e.data);Object.assign(L.value,l)}catch(l){}})),(e,l)=>{const _=n(p("page-meta"),S),v=n(p("u-empty"),q),h=n(p("tabbar"),A),C=m,U=n(p("u-icon"),G),z=n(p("router-navigate"),M),E=n(p("u-navbar"),J),T=n(p("u-form"),O),$=d,D=V,F=n(p("u-button"),P);return a(),o(i,null,[u(_,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),u(C,{class:"h-full flex flex-col bg-[#f5f8fd]"},{default:s((()=>[f(y).config.switch.sd_status?(a(),o(i,{key:1},[u(E,{"back-text":"绘画工作台"},{right:s((()=>[u(z,{to:"/packages/pages/draw_list/draw_list?model=sd"},{default:s((()=>[u(C,{class:"flex items-center mr-[20rpx]"},{default:s((()=>[u(C,{class:"text-primary flex"},{default:s((()=>[u(U,{name:"clock",size:32})])),_:1}),u(C,{class:"text-muted ml-[10rpx]"},{default:s((()=>[x("历史记录")])),_:1})])),_:1})])),_:1})])),_:1}),u(C,{class:"p-[20rpx]"},{default:s((()=>[u(C,{class:"flex p-[14rpx] bg-white rounded-full"},{default:s((()=>[(a(!0),o(i,null,r(j.value,(e=>(a(),t(C,{key:e.mode,class:c(["flex items-center px-[10rpx] py-[5rpx] flex-1 justify-center text-primary rounded-full",{"!bg-primary !text-white":L.value.draw_type===e.mode}]),onClick:l=>L.value.draw_type=e.mode},{default:s((()=>[u(C,{class:"leading-[30px]"},{default:s((()=>[x(g(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),u(C,{class:"flex-1 min-h-0"},{default:s((()=>[u($,{class:"h-full","scroll-y":""},{default:s((()=>[u(C,{class:"px-[20rpx] pb-[30rpx]"},{default:s((()=>[u(T,{ref_key:"uFormRef",ref:w,model:L.value,"label-position":"top","border-bottom":!1},{default:s((()=>[b("    图片上传    "),L.value.draw_type===f(Q).IMAGE?(a(),t(de,{key:0,modelValue:L.value.image_mask,"onUpdate:modelValue":l[0]||(l[0]=e=>L.value.image_mask=e)},null,8,["modelValue"])):b("v-if",!0),b("    关键词    "),u(Y,{modelValue:L.value.prompt,"onUpdate:modelValue":l[1]||(l[1]=e=>L.value.prompt=e),negative:L.value.negative_prompt,"onUpdate:negative":l[2]||(l[2]=e=>L.value.negative_prompt=e),model:f(W).SD,"is-negative":"",example:Z.example,typeEnum:f(Q),showTranslate:!!Z.config.translate_switch},null,8,["modelValue","negative","model","example","typeEnum","showTranslate"]),b("    生成尺寸    "),u(ne,{modelValue:L.value.size,"onUpdate:modelValue":l[3]||(l[3]=e=>L.value.size=e)},null,8,["modelValue"]),b("    生成模型    "),u(ce,{"cate-list":Z.model.cate,"model-list":Z.model.list,modelValue:L.value.draw_model,"onUpdate:modelValue":l[4]||(l[4]=e=>L.value.draw_model=e),onChangeCate:l[5]||(l[5]=e=>le(e))},null,8,["cate-list","model-list","modelValue"]),b("    Lora模型    "),u(fe,{modelValue:L.value.draw_loras,"onUpdate:modelValue":l[6]||(l[6]=e=>L.value.draw_loras=e),"model-list":Z.model.list,"current-lora":L.value.draw_model},null,8,["modelValue","model-list","current-lora"]),b("    高级参数    "),u(_e,{samplers:Z.samplers,modelValue:L.value.complex_params,"onUpdate:modelValue":l[7]||(l[7]=e=>L.value.complex_params=e)},null,8,["samplers","modelValue"])])),_:1},8,["model"])])),_:1})])),_:1})])),_:1}),u(C,{class:"p-[20rpx] bg-white safe-area-inset-bottom"},{default:s((()=>[u(F,{type:"primary",loading:f(se),onClick:f(te)},{default:s((()=>[u(C,null,{default:s((()=>[u(D,{class:"text-xl font-bold"},{default:s((()=>[x("立即生成")])),_:1}),Z.config.is_member?(a(),t(D,{key:0,class:"text-sm ml-[4px]"},{default:s((()=>[x(" 会员免费 ")])),_:1})):b("v-if",!0),0!=Z.config.power&&!Z.config.is_member&&f(k).isLogin?(a(),t(D,{key:1,class:"text-sm ml-[4px]"},{default:s((()=>[x(" 消耗"+g(Z.config.power||"--")+g(f(y).getTokenUnit),1)])),_:1})):b("v-if",!0)])),_:1})])),_:1},8,["loading","onClick"])])),_:1})],64)):(a(),t(C,{key:0,class:"w-full h-full bg-white rounded-[6px] flex items-center justify-center"},{default:s((()=>[u(v,{text:"绘画功能未开启",mode:"favor"}),u(h)])),_:1})),u(h)])),_:1})],64)}}}),[["__scopeId","data-v-51c8b0a8"]]);export{xe as default};
