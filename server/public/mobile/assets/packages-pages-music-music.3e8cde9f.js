import{d as e,J as l,u as t,A as a,s,K as i,C as o,L as r,o as u,k as c,b as m,w as n,e as d,F as f,f as p,l as x,c as _,p as g,g as y,t as A,z as h,ae as k,r as b,a as v,j as w,i as j,h as C,q as B,D as U,m as I,U as X,S as V}from"./index-d6d2a33a.js";import{_ as L}from"./page-meta.d751427a.js";import{_ as z}from"./u-icon.992584aa.js";import{_ as q}from"./router-navigate.18e98059.js";import{_ as F}from"./u-navbar.d70905ec.js";import{_ as E}from"./u-input.e3cf3beb.js";import{_ as J}from"./u-form-item.36bcbf1f.js";import{_ as S}from"./u-loading.d153dd1a.js";import{_ as Q}from"./l-textarea.9d4b6972.js";import{_ as T}from"./u-switch.4b65a60a.js";import{_ as D}from"./u-image.9574760c.js";import{_ as O}from"./u-form.f207500c.js";import{_ as Z}from"./u-button.97a3d07f.js";import{_ as R}from"./u-empty.a728d8d9.js";import{_ as K}from"./tabbar.vue_vue_type_script_setup_true_lang.e2e30d1a.js";import{g as W,p as G,a as Y}from"./music.d5e913c6.js";import{u as H}from"./useLockFn.3b1f86f9.js";import{_ as P}from"./_plugin-vue_export-helper.1b428a4d.js";import"./emitter.1571a5d9.js";import"./u-badge.f9b9ebb9.js";const M=P(e({__name:"music",setup(e){const P=h();k();const M=l(),N=t(),$=a(),ee=s([{mode:0,name:"灵感模式",tips:"只需输入一段歌曲描述，即可生成一首歌"},{mode:1,name:"歌词模式",tips:"输入自己的歌词，即可生成一首歌"}]),le=i({channel:"go_api",custom_mode:0,title:"",prompt:"",style_id:[],is_style_custom:0,style_custom:"",make_instrumental:0,version:""}),te=o((()=>0===le.custom_mode)),ae=s(8),se=e=>ce.value.style.slice(ae.value*e,ae.value*(e+1)),ie=o((()=>Math.ceil(ce.value.style.length/ae.value))),oe=()=>{$.isLogin||P.navigateTo("/pages/login/login")},re=()=>{le.is_style_custom=le.is_style_custom?0:1},ue=(e,l)=>{X({title:e,content:l,showCancel:!1})},ce=s({model:{},style:[],imagine:{}}),me=o((()=>!te.value&&ce.value.imagine.status)),ne=o((()=>ce.value.model[le.channel]||{})),{lockFn:de,isLock:fe}=H((async()=>{if(!le.title)return uni.$u.toast("请输入歌曲名称");const e=await G({prompt:le.title});le.prompt=e.content})),{lockFn:pe,isLock:xe}=H((async()=>{try{if(!le.title)return uni.$u.toast("请输入歌曲名称");if(!le.prompt)return uni.$u.toast("请输入"+(te.value?"歌曲描述":"歌词"));await Y({...le,style_id:le.is_style_custom?[]:le.style_id}),le.prompt="",le.title="",le.style_id=[],le.style_custom="",P.navigateTo("/packages/pages/music_list/music_list")}catch(e){}}));return r((()=>{(async()=>{ce.value=await W(),le.channel=ce.value.channel,le.version||(le.version=Object.keys(ne.value.version)[0]||"")})()})),(e,l)=>{const t=b(v("page-meta"),L),a=b(v("u-icon"),z),s=w,i=b(v("router-navigate"),q),o=b(v("u-navbar"),F),r=b(v("u-input"),E),h=b(v("u-form-item"),J),k=b(v("u-loading"),S),X=j,W=C,G=b(v("l-textarea"),Q),Y=b(v("u-switch"),T),H=b(v("u-image"),D),P=V,$=B,ae=b(v("u-form"),O),_e=U,ge=b(v("u-button"),Z),ye=b(v("u-empty"),R),Ae=b(v("tabbar"),K);return u(),c(f,null,[m(t,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),m(s,{class:"h-full flex flex-col"},{default:n((()=>[d(N).config.switch.music_status>0?(u(),c(f,{key:0},[m(o,{"back-text":"音乐"},{right:n((()=>[m(i,{to:"/packages/pages/music_list/music_list"},{default:n((()=>[m(s,{class:"flex items-center mr-[20rpx]"},{default:n((()=>[m(s,{class:"text-primary flex"},{default:n((()=>[m(a,{name:"clock",size:32})])),_:1}),m(s,{class:"text-muted ml-[10rpx]"},{default:n((()=>[p("历史记录")])),_:1})])),_:1})])),_:1})])),_:1}),m(s,{class:"p-[20rpx]"},{default:n((()=>[m(s,{class:"flex p-[14rpx] bg-white rounded-full"},{default:n((()=>[(u(!0),c(f,null,x(ee.value,(e=>(u(),_(s,{key:e.mode,class:I(["flex items-center px-[10rpx] py-[5rpx] flex-1 justify-center text-primary rounded-full",{"!bg-primary !text-white":le.custom_mode===e.mode}]),onClick:l=>le.custom_mode=e.mode},{default:n((()=>[m(s,null,{default:n((()=>[p(A(e.name),1)])),_:2},1024),m(s,{class:"flex p-[16rpx]",onClick:g((l=>ue(e.name,e.tips)),["stop"])},{default:n((()=>[m(a,{name:"error-circle",size:32})])),_:2},1032,["onClick"])])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),m(s,{class:"flex-1 min-h-0"},{default:n((()=>[m(_e,{class:"h-full","scroll-y":""},{default:n((()=>[m(s,{class:"px-[20rpx]"},{default:n((()=>[m(ae,{ref_key:"uFormRef",ref:M,model:le,"label-position":"top","border-bottom":!1},{default:n((()=>[m(h,{label:"歌曲名称",prop:"title",required:""},{default:n((()=>[m(s,{class:"flex-1 min-w-0"},{default:n((()=>[m(r,{"placeholder-style":"color: #9CA3AF;",height:80,modelValue:le.title,"onUpdate:modelValue":l[0]||(l[0]=e=>le.title=e),placeholder:"给你的歌曲起个好听的名字",border:!0,onClick:oe},null,8,["modelValue"])])),_:1})])),_:1}),m(h,{label:d(te)?"歌曲描述":"歌词","label-position":"left",required:"","label-width":d(te)?250:70},{default:n((()=>[m(s,{class:"flex flex-1"},{default:n((()=>[d(te)?y("v-if",!0):(u(),_(s,{key:0,class:"flex",onClick:l[1]||(l[1]=g((e=>ue("温馨提示","建议歌词长度100-1250，太长或太短容易生成失败")),["stop"]))},{default:n((()=>[m(a,{name:"error-circle",size:32})])),_:1})),m(s,{class:"flex items-center text-content text-xs ml-auto",onClick:l[2]||(l[2]=g((e=>le.prompt=""),["stop"]))},{default:n((()=>[m(a,{name:"trash"}),m(s,{class:"ml-[8rpx]"},{default:n((()=>[p(" 清空 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["label","label-width"]),m(h,null,{default:n((()=>[m(s,{class:"flex-1 min-w-0 overflow-hidden mt-[-25rpx]"},{default:n((()=>[m(G,{modelValue:le.prompt,"onUpdate:modelValue":l[3]||(l[3]=e=>le.prompt=e),maxlength:"1300",rows:4,"show-word-limit":!0,"custom-class":{background:"#fff",paddingBottom:"70rpx",fontSize:"28rpx"},placeholder:"请输入"+(d(te)?"灵感，例如写一首关于夏天的歌曲":"歌词"),onClick:oe},{"length-suffix":n((()=>[m(s,{class:"flex length-suffix"},{default:n((()=>[m(s,{class:"flex-1"},{default:n((()=>[d(me)?(u(),_(s,{key:0,class:"inline-flex items-center text-primary bg-primary-light-9 rounded-[10rpx] px-[15rpx] leading-[50rpx]",onClick:g(d(de),["stop"])},{default:n((()=>[d(fe)?(u(),_(k,{key:0,mode:"flower",color:e.$theme.primaryColor,size:"24"},null,8,["color"])):(u(),_(X,{key:1,class:"w-[24rpx] h-[24rpx]",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAxCAYAAACcXioiAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAUOSURBVGiB7VnLcdtIFOw3A50XIWAjWPoqiyUwAksBUAIjsBSBxAgkRSDYDkByBEKVtL6ajsDYCJZ7tTGv90CQBGmAxPCzLldtnzhT8+nHeX8I9oTXfXchghuIZIHIaZbKeB/3mH0cCgAiuAIAkLGDi/d1z94EABA2/N4p9inAf4L/BfjZCH42gSbECSMHFzvY0adURk3rGgU4TNixqg8EQjG8fE6DdC9MaxAnjJzqEyGRgY7jhL83ueFGFbLUcwIRgJAq992kOPEhIUDus36KOXlE5VT4bf77BzTbgPJLdUiV+8OEndZMDIciyEWQWtjHNltqyAMi2SoVklUHHp25a6AMSBOM1ZjeqgNL3e1QpSOC3wCEJP4Sw9zCZlkqeXvyGAViequi+EoBfITo9ouExpyDjFceKDIC+TEw5nZKLE4YOtXPvuSBFm705b29BjCsTIWGvJ8ODhN2umfuK0Xu15IHALID4KpQ/Tq1Kwd3sgn5VgJMhRBBujx/dOauzfI/1x4hVR665+7GwmazWQ/yk+UeODpz1xA5VpFLo3qCRdWaHChIIfzoYPOpmk19OijHJE6wlBuJIKXoO3ESWWsffTJXLwEWBFkiL4LUihk2GekUccLQUa9IXCztv31+Zy99uXgLcJR8j6HmqTpH4vLPD/a2bn2cMCzIewE7AB4p+vElPci6SZFQ5QaV1xBy8PzBL2B6C9A9c1+rOi+Gg1VRelbYLNwqj4HIoEDRqf4ZAuTWmN66V6zCK5nr9otkyWCH61IMA/6oz+SJU/0cIMhR8XAEokI18eHkJQCNOZ8NBKPSxa5EqRJDkcXUgkBUUB9e3tvratohwDk80FqF4oRhofr3bKPh6XMatEoRpijt5wFLeg8AFJnFFhjTe0kla3Nm6xdwcNVkbrzgu1viJT3IAmNeAZirlciVtUu5kmrc9sz29QDlj8ql2aZdhiyV/OjM3aF0wwSib0BkRLJZJJfJXd1+kVAkqqVDjA+seQxqvUQVk7bIwFHnzw7mm5CfIjAmLVQX4wiYcz4Mu0lxQq2o1Q+0AKf61szaH02YtEU6i1P4ZyPmJbJUchKXZbp9W5fdUmVt6k4gDAQYc03bg+BYNgvajSgDX23wA8pXIo9XJYgkhoE1pvfd6YlIvRBC5s/pQdY9d2/mkxV72BEI6QATJRIwz1KTA+it2xeUUa/xn5hB+QUyeQWhR2XWAqWLjmZXKb6sWL6A1m7U2rnbJBAdJS1y/5YoW49zJ2G1seJbRmsBslRySMXYyNXG7wHSvK0Mxy/pQdZ2r1cqIap3lVvjbr9IfPbX4XXfXSwZ6l3T2lpOvhcuZaPjwJhXPtljFYcJO0b1CXP1GQfGNPaA6uDdWqTRQWUYOtUnr3ZLiRryEMOBb4T3FqDUz4UU2Kh+ft13F827FjGtpVElL7j1TQ6BDUtKAOieu5vlshDAcF2K3VSOPr+zg/odq7Fxd7qsX6vtlra5/Nul8XBT8sCW7fWX9/ZaDGeXr2uvxAkjLOr8aZuiaBW2/j5A2HzTvRa2dcBqwi//geOXF2DnX2hW5UgOLtzC8dViawEUGC884yQ41YI7Jg/sQIU+pTLa6GuMyGjTFKSKndiANabnI4QAeSByuou7d/amccLwGxCZFl/l2/Z82mArAeKE3q3AKqatkW1UaSsjLsgHABuXlyJAQb5Bi9q3CdvZABlttR+AYLsztjXiO1TbhP4Yq/pVYMv4F7BDYuZt/gOrAAAAAElFTkSuQmCC"})),m(W,{class:"ml-[8rpx]"},{default:n((()=>[m(W,null,{default:n((()=>[p(" 智能联想 ")])),_:1}),ce.value.imagine.price>0?(u(),_(W,{key:0},{default:n((()=>[p("：消耗"+A(ce.value.imagine.price)+A(d(N).getTokenUnit),1)])),_:1})):y("v-if",!0)])),_:1})])),_:1},8,["onClick"])):y("v-if",!0)])),_:1})])),_:1})])),_:1},8,["modelValue","placeholder"])])),_:1})])),_:1}),m(h,{prop:"version",label:"选择版本",required:""},{default:n((()=>[m(s,{class:"flex flex-wrap"},{default:n((()=>[(u(!0),c(f,null,x(d(ne).version,((e,l)=>(u(),_(s,{key:e,class:I(["mr-[20rpx] h-[70rpx] leading-[70rpx] px-[40rpx] rounded-[8rpx] border-solid border-light border-[1px]",{"!text-primary !border-primary":le.version===String(l)}]),onClick:e=>le.version=String(l)},{default:n((()=>[p(A(e),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),d(te)?(u(),_(h,{key:0,label:"纯音乐","label-position":"left","label-width":"150"},{default:n((()=>[m(s,{class:"flex justify-end flex-1"},{default:n((()=>[m(Y,{modelValue:le.make_instrumental,"onUpdate:modelValue":l[4]||(l[4]=e=>le.make_instrumental=e)},null,8,["modelValue"])])),_:1})])),_:1})):y("v-if",!0),d(te)?y("v-if",!0):(u(),c(f,{key:1},[m(h,{label:"音乐风格","label-position":"left","label-width":"200"},{default:n((()=>[m(s,{class:"flex-1 min-w-0 flex justify-end"},{default:n((()=>[m(s,{class:"text-primary",onClick:re},{default:n((()=>[p(A(le.is_style_custom?"系统风格":"自定义风格"),1)])),_:1})])),_:1})])),_:1}),m(h,{class:"mt-[-15px]"},{default:n((()=>[le.is_style_custom?(u(),_(s,{key:1,class:"flex-1 min-w-0 overflow-hidden"},{default:n((()=>[m(G,{modelValue:le.style_custom,"onUpdate:modelValue":l[5]||(l[5]=e=>le.style_custom=e),maxlength:"1024",rows:4,"show-word-limit":!1,"custom-class":{background:"#fff",paddingBottom:"70rpx",fontSize:"28rpx"},placeholder:"请输入自定义风格，多个风格以,隔开"},null,8,["modelValue"])])),_:1})):(u(),_(s,{key:0,class:"flex-1 min-w-0 bg-white rounded-[16rpx]"},{default:n((()=>[m($,{class:"h-[520rpx]",circular:"","indicator-dots":d(ie)>1,"indicator-active-color":e.$theme.primaryColor},{default:n((()=>[(u(!0),c(f,null,x(d(ie),((e,l)=>(u(),_(P,{key:l},{default:n((()=>[m(s,{class:"flex flex-wrap px-[20rpx] pt-[20rpx] mx-[-10rpx]"},{default:n((()=>[(u(!0),c(f,null,x(se(l),(e=>(u(),_(s,{class:"w-[25%] px-[10rpx] mb-[10rpx]",key:e.id},{default:n((()=>[m(s,{class:"h-full cursor-pointer",onClick:l=>(e=>{const l=le.style_id.findIndex((l=>l===e));-1!==l?le.style_id.splice(l,1):le.style_id.push(e)})(e.id)},{default:n((()=>[m(s,{class:"pt-[100%] relative h-0 rounded-[10rpx] overflow-hidden"},{default:n((()=>[m(s,{class:"absolute inset-0 left-0 top-0"},{default:n((()=>[m(H,{src:e.image,class:"h-full w-full",width:"100%",height:"100%"},null,8,["src"])])),_:2},1024),le.style_id.includes(e.id)?(u(),_(s,{key:0,class:"absolute bg-[rgba(0,0,0,0.5)] inset-0 left-0 top-0 flex items-center justify-center text-white"},{default:n((()=>[m(a,{name:"checkmark-circle-fill",size:40})])),_:1})):y("v-if",!0)])),_:2},1024),m(s,{class:"text-center text-xs"},{default:n((()=>[p(A(e.name),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["indicator-dots","indicator-active-color"])])),_:1}))])),_:1})],64))])),_:1},8,["model"])])),_:1})])),_:1})])),_:1}),m(s,{class:"p-[20rpx] bg-white"},{default:n((()=>[m(ge,{type:"primary",loading:d(xe),onClick:d(pe)},{default:n((()=>[m(s,null,{default:n((()=>[m(W,{class:"text-xl font-bold"},{default:n((()=>[p("立即生成")])),_:1}),ce.value.is_member?(u(),_(W,{key:0,class:"text-sm ml-[4px]"},{default:n((()=>[p(" 会员免费 ")])),_:1})):d(ne).price>0?(u(),_(W,{key:1,class:"text-sm ml-[4px]"},{default:n((()=>[p(" 消耗 "+A(d(ne).price)+" "+A(d(N).getTokenUnit),1)])),_:1})):y("v-if",!0)])),_:1})])),_:1},8,["loading","onClick"])])),_:1})],64)):(u(),_(s,{key:1,class:"h-full flex-1 flex p-4 justify-center items-center"},{default:n((()=>[m(ye,{text:"功能未开启",mode:"list"})])),_:1})),m(Ae)])),_:1})],64)}}}),[["__scopeId","data-v-6a54422c"]]);export{M as default};
