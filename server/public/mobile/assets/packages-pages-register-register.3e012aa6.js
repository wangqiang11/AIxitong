import{_ as e}from"./page-meta.d751427a.js";import{d as a,s as l,C as o,u as t,J as s,K as r,$ as u,o as i,k as m,b as n,w as d,e as c,c as p,g as f,m as b,f as v,t as _,F as g,z as y,a3 as w,a2 as x,a1 as j,r as h,a as V,j as $,h as k,cl as C,E as B,ad as R}from"./index-d6d2a33a.js";import{_ as U}from"./u-tabs.f14aec5a.js";import{_ as E}from"./u-input.e3cf3beb.js";import{_ as F}from"./u-form-item.36bcbf1f.js";import{_ as L}from"./u-verification-code.38feb014.js";import{_ as P}from"./u-form.f207500c.js";import{_ as S}from"./agreement.4c7e450f.js";import{_ as T}from"./u-button.97a3d07f.js";import{u as G}from"./useLockFn.3b1f86f9.js";import{F as I}from"./floating-menu.85d77f2f.js";import{_ as J}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-badge.f9b9ebb9.js";import"./u-icon.992584aa.js";import"./emitter.1571a5d9.js";import"./router-navigate.18e98059.js";import"./u-checkbox.0fdc3635.js";const K=J(a({__name:"register",setup(a){const J=[{name:"手机号注册",type:"1"},{name:"邮箱注册",type:"2"}],K=l(0),q=o((()=>{var e;return(null==(e=A.getLoginConfig)?void 0:e.register_way)||[]})),z=o((()=>J.filter((e=>q.value.includes(e.type))))),A=t(),D=y(),H=s(),N=r({scene:"2",mobile:"",code:"",email:"",password:"",password_confirm:""}),O=s(),M=l(""),Q=e=>{M.value=e},W=o((()=>uni.$u.test.mobile(N.mobile))),X=o((()=>uni.$u.test.email(N.email))),Y=o((()=>{var e;return 1==(null==(e=A.getLoginConfig)?void 0:e.register_sms_verify)})),Z=o((()=>"1"==N.scene)),ee=o((()=>"2"==N.scene)),ae=e=>{K.value=e,N.scene=J[e].type,1==e?N.mobile="":N.email=""},le=async()=>{var e,a;if(null==(e=O.value)?void 0:e.canGetCode)try{Z.value?await te():await oe(),uni.$u.toast("发送成功"),null==(a=O.value)||a.start()}catch(l){console.log("发送验证码失败=>",l)}},oe=async()=>(console.log(X.value),N.email?X.value?void(await w({scene:x.REGISTER,email:N.email})):(uni.$u.toast("请输入正确的邮箱地址"),Promise.reject()):(uni.$u.toast("请输入邮箱"),Promise.reject())),te=async()=>N.mobile?X.value?(uni.$u.toast("请输入正确的手机号"),Promise.reject()):void(await j({scene:x.REGISTER,mobile:N.mobile})):(uni.$u.toast("请输入手机号"),Promise.reject()),{lockFn:se}=G((async()=>{var e;if(!(null==(e=H.value)?void 0:e.checkAgreement()))return;if(!N.mobile&&Z.value)return uni.$u.toast("请输入手机号码");if(!N.email&&ee.value)return uni.$u.toast("请输入邮箱");if(!N.code&&Y.value)return uni.$u.toast("请输入验证码");if(!N.password)return uni.$u.toast("请输入密码");if(!N.password_confirm)return uni.$u.toast("请再次输入密码");if(N.password!=N.password_confirm)return uni.$u.toast("两次输入的密码不一致");const a=await C(N);B.set(R,JSON.stringify(a)),setTimeout((()=>{D.navigateBack()}),1500)}));return u((async({type:e})=>{setTimeout((()=>{N.scene=e,2==e&&q.value.includes("1")&&(K.value=1)}),300)})),(a,l)=>{const o=h(V("page-meta"),e),t=h(V("u-tabs"),U),s=$,r=h(V("u-input"),E),u=h(V("u-form-item"),F),y=h(V("u-verification-code"),L),w=k,x=h(V("u-form"),P),j=h(V("agreement"),S),C=h(V("u-button"),T);return i(),m(g,null,[n(o,{"page-style":a.$theme.pageStyle},null,8,["page-style"]),n(s,{class:"register bg-white min-h-full flex flex-col items-center px-[40rpx] pt-[40rpx] box-border"},{default:d((()=>[n(s,{class:"w-full"},{default:d((()=>[n(s,{class:"pb-[40rpx]"},{default:d((()=>[n(t,{list:c(z),modelValue:K.value,"onUpdate:modelValue":l[0]||(l[0]=e=>K.value=e),"active-color":a.$theme.primaryColor,onChange:ae},null,8,["list","modelValue","active-color"])])),_:1}),n(x,{borderBottom:"","label-width":150},{default:d((()=>[c(Z)?(i(),p(u,{key:0,label:"手机号",borderBottom:""},{default:d((()=>[n(r,{class:"flex-1",modelValue:N.mobile,"onUpdate:modelValue":l[1]||(l[1]=e=>N.mobile=e),border:!1,placeholder:"请输入手机号码"},null,8,["modelValue"])])),_:1})):f("v-if",!0),c(ee)?(i(),p(u,{key:1,label:"邮箱",borderBottom:""},{default:d((()=>[n(r,{class:"flex-1",modelValue:N.email,"onUpdate:modelValue":l[2]||(l[2]=e=>N.email=e),border:!1,placeholder:"请输入邮箱账号"},null,8,["modelValue"])])),_:1})):f("v-if",!0),c(Y)?(i(),p(u,{key:2,label:"验证码"},{default:d((()=>[n(r,{class:"flex-1",modelValue:N.code,"onUpdate:modelValue":l[3]||(l[3]=e=>N.code=e),placeholder:"请输入验证码",border:!1},null,8,["modelValue"]),n(s,{class:"border-l border-solid border-0 border-light pl-3 leading-4 ml-3 w-[180rpx]",onClick:le},{default:d((()=>[n(y,{ref_key:"uCodeRef",ref:O,seconds:60,onChange:Q,"change-text":"x秒"},null,512),n(w,{class:b(["text-muted",{"text-primary":c(W)&&c(Z)||c(X)&&c(ee)}])},{default:d((()=>[v(_(M.value),1)])),_:1},8,["class"])])),_:1})])),_:1})):f("v-if",!0),n(u,{label:"设置密码",borderBottom:""},{default:d((()=>[n(r,{class:"flex-1",type:"password",modelValue:N.password,"onUpdate:modelValue":l[4]||(l[4]=e=>N.password=e),placeholder:"请输入字母+数字组合的密码",border:!1},null,8,["modelValue"])])),_:1}),n(u,{label:"确认密码",borderBottom:""},{default:d((()=>[n(r,{class:"flex-1",type:"password",modelValue:N.password_confirm,"onUpdate:modelValue":l[5]||(l[5]=e=>N.password_confirm=e),placeholder:"再次输入密码",border:!1},null,8,["modelValue"])])),_:1})])),_:1}),n(s,{class:"mt-[40rpx]"},{default:d((()=>[n(j,{ref_key:"agreementRef",ref:H},null,512)])),_:1}),n(s,{class:"mt-[60rpx]"},{default:d((()=>[n(C,{type:"primary",shape:"circle",onClick:c(se)},{default:d((()=>[v(" 注册 ")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1}),f("    悬浮菜单    "),n(I)],64)}}}),[["__scopeId","data-v-796775ec"]]);export{K as default};
