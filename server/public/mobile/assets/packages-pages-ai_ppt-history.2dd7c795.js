import{d as e,u as t,J as a,s as l,K as s,C as o,x as i,aF as u,o as r,k as n,b as p,w as c,F as m,l as d,g as f,e as x,f as _,z as g,a$ as y,r as h,a as v,j as w,m as b,t as k,c as j,p as C,U as T}from"./index-d6d2a33a.js";import{_ as P}from"./page-meta.d751427a.js";import{_ as V}from"./u-image.9574760c.js";import{_ as z}from"./u-icon.992584aa.js";import{_ as F}from"./u-loading.d153dd1a.js";import{_ as U}from"./z-paging.6c8c2edf.js";import{F as $}from"./floating-menu.85d77f2f.js";import{_ as E}from"./u-action-sheet.29883fbc.js";import{_ as S}from"./u-button.97a3d07f.js";import{_ as q}from"./u-popup.21776ef7.js";import{u as A,d as I,b as J,c as K}from"./aiPPT.8ab1aaff.js";import{u as Q}from"./useCopy.4954d67d.js";import"./_plugin-vue_export-helper.1b428a4d.js";import"./isString.6d1f126a.js";const R=e({__name:"history",setup(e){const R=g(),X=t(),B=A();B.getPPTConfig();const D=a(),{copy:G}=Q(),H=l([]),L=[{name:"全部",type:-1},{name:"生成中",type:1},{name:"生成成功",type:2},{name:"生成失败",type:3}];a(null);const M=l(-1),N=s({show:!1,item:{}}),O=o((()=>{const e=[{value:"delete",text:"删除",color:"#EA0000"}];return 2==N.item.status&&e.unshift({value:"download",text:"下载"+(N.item.pay_status?"":B.config.isVipFree?"(会员免费)":B.config.price>0?"-"+B.config.price+X.getTokenUnit:"")}),e})),W=e=>{N.show=!0,N.item=e},Y=l(),Z=async e=>{const t=O.value[e].value,a=N.item;switch(t){case"delete":(async e=>{const{cancel:t}=await T({title:"温馨提示",content:"确定删除？"});t||(await K({id:e}),le())})(a.id);break;case"download":if(y())Y.value=!0;else{const{file_url:e}=await I({id:a.id}),t=document.createElement("a");t.href=e,t.download=`${a.title}.pptx`,t.click()}}},ee=async()=>{const{file_url:e}=await I({id:N.item.id});await G(e),Y.value=!1},te=a(),ae=async(e,t)=>{try{const{lists:a}=await J({page_no:e,page_size:t,status:M.value});D.value.complete(a)}catch(a){D.value.complete(!1)}finally{setTimeout((()=>{clearTimeout(te.value),[-1,1].includes(M.value)&&H.value.some((e=>1===e.status))&&(te.value=setTimeout((()=>{le()}),6e3))}),100)}},le=()=>{var e;null==(e=D.value)||e.refresh()};return i(M,(()=>{le()})),u((()=>{clearTimeout(te.value)})),(e,t)=>{const a=h(v("page-meta"),P),l=w,s=h(v("u-image"),V),o=h(v("u-icon"),z),i=h(v("u-loading"),F),u=h(v("z-paging"),U),g=h(v("floating-menu"),$),y=h(v("u-action-sheet"),E),T=h(v("u-button"),S),A=h(v("u-popup"),q);return r(),n(m,null,[p(a,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),p(u,{ref_key:"pagingRef",ref:D,modelValue:H.value,"onUpdate:modelValue":t[0]||(t[0]=e=>H.value=e),"auto-clean-list-when-reload":!1,"safe-area-inset-bottom":!0,onQuery:ae,fixed:!0},{top:c((()=>[p(l,{class:"p-[20rpx] flex mx-[-10rpx]"},{default:c((()=>[(r(),n(m,null,d(L,(e=>p(l,{class:"flex-1 px-[10rpx]",key:e.type},{default:c((()=>[p(l,{class:b(["bg-white py-[16rpx] rounded-[10rpx] shadow-light text-center",{"!bg-primary text-white":e.type===M.value}]),onClick:t=>M.value=e.type},{default:c((()=>[_(k(e.name),1)])),_:2},1032,["class","onClick"])])),_:2},1024))),64))])),_:1})])),default:c((()=>[p(l,{class:"flex flex-wrap px-[10rpx]"},{default:c((()=>[(r(!0),n(m,null,d(H.value,(e=>(r(),j(l,{class:"w-[50%] px-[10rpx] mb-[20rpx]",key:e.id},{default:c((()=>[p(l,{class:"h-[300rpx] relative rounded-[15rpx] overflow-hidden",onClick:t=>{return a=e.id,void R.navigateTo({path:"/packages/pages/ai_ppt/detail",query:{id:a}});var a}},{default:c((()=>[p(l,{class:"w-full h-full"},{default:c((()=>{var t;return[p(s,{src:null==(t=e.preview)?void 0:t[0],width:"100%",height:"100%",mode:"widthFix"},null,8,["src"])]})),_:2},1024),p(l,{class:"flex flex-col absolute left-0 right-0 bottom-0 z-[999]"},{default:c((()=>[p(l,{class:"bg-[rgba(0,0,0,0.3)] px-[20rpx] py-[25rpx] text-white",style:{"backdrop-filter":"blur(10px)","border-radius":"0 0 15rpx 15rpx"}},{default:c((()=>[p(l,{class:"line-clamp-1 font-bold"},{default:c((()=>[_(k(e.title),1)])),_:2},1024),p(l,{class:"flex text-xs mt-[15rpx] items-center"},{default:c((()=>[p(l,{class:"mr-auto"},{default:c((()=>[_(k(e.create_time),1)])),_:2},1024),p(l,{onClick:C((t=>W(e)),["stop"])},{default:c((()=>[p(o,{name:"more-dot-fill",size:32})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024),3==e.status||1==e.status?(r(),j(l,{key:0,class:"h-full absolute left-0 right-0 top-0 bottom-0 z-[999] bg-white flex items-center justify-center flex-col"},{default:c((()=>[1==e.status?(r(),n(m,{key:0},[p(i,{size:50,mode:"flower"}),p(l,{class:"text-content text-sm mt-[20rpx]"},{default:c((()=>[_(" PPT生成中，请稍等！ ")])),_:1})],64)):(r(),n(m,{key:1},[_("clear "),p(l,{class:"text-content text-sm mt-[20rpx]"},{default:c((()=>[_(" PPT生成失败 ")])),_:1}),p(l,{class:"absolute bottom-0 w-full px-[20rpx] py-[25rpx] flex items-center text-muted"},{default:c((()=>[p(l,{class:"mr-auto text-xs"},{default:c((()=>[_(k(e.create_time),1)])),_:2},1024),p(l,{onClick:C((t=>W(e)),["stop"])},{default:c((()=>[p(o,{name:"more-dot-fill",size:32})])),_:2},1032,["onClick"])])),_:2},1024)],64))])),_:2},1024)):f("v-if",!0)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})])),_:1},8,["modelValue"]),f("    悬浮菜单    "),p(g),p(y,{"safe-area-inset-bottom":"",list:x(O),modelValue:N.show,"onUpdate:modelValue":t[1]||(t[1]=e=>N.show=e),onClick:Z},null,8,["list","modelValue"]),p(A,{modelValue:Y.value,"onUpdate:modelValue":t[2]||(t[2]=e=>Y.value=e),mode:"center","border-radius":"15",closeable:""},{default:c((()=>[p(l,{class:"w-[650rpx] p-[40rpx]"},{default:c((()=>[p(l,{class:"text-lg font-bold text-center mb-[40rpx]"},{default:c((()=>[_(" 下载PPTX ")])),_:1}),p(l,{class:"mb-[40rpx]"},{default:c((()=>[_(" 当前环境不支持下载，请复制链接到浏览器打开下载 ")])),_:1}),p(T,{type:"primary",shape:"circle",onClick:ee},{default:c((()=>[_(" 复制链接 ")])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}});export{R as default};
