import{E as e,d as t,C as l,r as a,a as o,o as s,c as u,w as r,b as i,aQ as n,e as d,P as p,f as m,t as c,g as f,j as v,cr as g,k as x,F as h,l as _,m as y,s as V,J as w,x as b,V as k,A as j,u as C,K as S,$ as U,bo as D,cs as $,bp as R,U as q,z as I,i as L,aJ as W,ct as F,bt as T}from"./index-d6d2a33a.js";import{_ as z}from"./page-meta.d751427a.js";import{_ as B}from"./u-image.9574760c.js";import{_ as E}from"./model-picker.594cca17.js";import{_ as N}from"./u-icon.992584aa.js";import{_ as M}from"./u-button.97a3d07f.js";import{_ as H}from"./create_record.3474bfb9.js";import{i as P}from"./chat.d9a8f946.js";import{b as A}from"./create.07ec191c.js";import{d as J}from"./index.3dd6f2ef.js";import{u as O}from"./useCopy.4954d67d.js";import{u as G}from"./useLockFn.3b1f86f9.js";import{F as K}from"./floating-menu.85d77f2f.js";import{C as Q}from"./creation-history-item.2073a254.js";import{_ as Y}from"./u-form-item.36bcbf1f.js";import{_ as X}from"./u-form.f207500c.js";import{_ as Z}from"./u-input.e3cf3beb.js";import{_ as ee}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as te}from"./u-select.65c5ee75.js";import{h as le}from"./index.22b2ad12.js";import{c as ae}from"./cloneDeep.8a0e8caf.js";import"./u-collapse.5c69f838.js";import"./u-popup.21776ef7.js";import"./u-tag.fd761889.js";import"./u-read-more.48be6c35.js";import"./u-loading.d153dd1a.js";import"./text-item.bd4ac6fd.js";import"./ua-markdown.e9ea1a15.js";import"./_commonjsHelpers.157f59fb.js";import"./katex.37f36714.js";import"./mp-html.318bb55d.js";import"./index.ccff8ee2.js";import"./icon_copy.36709540.js";import"./howler.bdae6f69.js";import"./emitter.1571a5d9.js";const oe=(e,t="yyyy-mm-dd")=>{e||(e=Number(new Date)),10==e.toString().length&&(e*=1e3);const l=new Date(e);let a;const o={"y+":l.getFullYear().toString(),"m+":(l.getMonth()+1).toString(),"d+":l.getDate().toString(),"h+":l.getHours().toString(),"M+":l.getMinutes().toString(),"s+":l.getSeconds().toString()};for(const s in o)a=new RegExp(`(${s})`).exec(t),a&&(t=t.replace(a[1],1==a[1].length?o[s]:o[s].padStart(a[1].length,"0")));return t};var se=(e=>(e[e.Normal=1]="Normal",e[e.Expand=2]="Expand",e[e.Simple=3]="Simple",e[e.Continue=4]="Continue",e[e.Change1=5]="Change1",e[e.Change2=6]="Change2",e[e.Change3=7]="Change3",e))(se||{});const ue=ee(t({__name:"input",props:{modelValue:{default:""},placeholder:{default:"请输入"},showWordLimit:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(e,{emit:t}){const g=e,x=l({get:()=>g.modelValue,set(e){t("update:modelValue",e)}});return(t,l)=>{const g=a(o("u-input"),Z),h=v;return s(),u(h,{class:"widget-input"},{default:r((()=>[i(g,n({class:"flex-1 min-w-0",modelValue:d(x),"onUpdate:modelValue":l[0]||(l[0]=e=>p(x)?x.value=e:null),placeholder:e.placeholder,height:"70","placeholder-style":"color: #999"},t.$attrs),null,16,["modelValue","placeholder"]),e.showWordLimit?(s(),u(h,{key:0,class:"text-xs text-muted ml-[20rpx]"},{default:r((()=>{var e;return[m(c(null==(e=d(x))?void 0:e.length)+" / "+c(t.$attrs.maxlength),1)]})),_:1})):f("v-if",!0)])),_:1})}}}),[["__scopeId","data-v-e4159e5b"]]),re=ee(t({__name:"textarea",props:{modelValue:{default:""},placeholder:{default:"请输入"},rows:{default:1},showWordLimit:{type:Boolean,default:!0},autosize:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,g=l({get:()=>n.modelValue,set(e){t("update:modelValue",e)}}),x=l((()=>({height:n.autosize?"auto":40*n.rows+"rpx",minHeight:"80rpx",fontSize:"28rpx"})));return(t,l)=>{const n=a(o("u-input"),Z),h=v;return s(),u(h,{class:"widget-textarea"},{default:r((()=>[i(n,{class:"w-full",modelValue:d(g),"onUpdate:modelValue":l[0]||(l[0]=e=>p(g)?g.value=e:null),placeholder:e.placeholder,"auto-height":e.autosize,"custom-style":d(x),"placeholder-style":"color: #999",maxlength:t.$attrs.maxlength,type:"textarea"},null,8,["modelValue","placeholder","auto-height","custom-style","maxlength"]),e.showWordLimit?(s(),u(h,{key:0,class:"text-xs bg-page text-muted absolute right-[20rpx] bottom-[10rpx] leading-[28rpx]"},{default:r((()=>{var e;return[m(c(null==(e=d(g))?void 0:e.length)+" / "+c(t.$attrs.maxlength),1)]})),_:1})):f("v-if",!0)])),_:1})}}}),[["__scopeId","data-v-801ecf90"]]),ie=ee(t({__name:"radio",props:{defaultValue:null,modelValue:{default:""},options:{default:()=>[]}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,o=l({get:()=>a.modelValue,set(e){t("update:modelValue",e)}});return g((()=>{a.defaultValue&&(o.value=a.defaultValue)})),(t,l)=>{const a=v;return s(),u(a,{class:"widget-radio"},{default:r((()=>[i(a,{class:"radio-group"},{default:r((()=>[(s(!0),x(h,null,_(e.options,((e,t)=>(s(),u(a,{class:y(["radio-item",{"radio-item--active":d(o)===e}]),key:t,onClick:t=>o.value=e},{default:r((()=>[m(c(e),1)])),_:2},1032,["onClick","class"])))),128))])),_:1})])),_:1})}}}),[["__scopeId","data-v-7dba6fb8"]]),ne=ee(t({__name:"select",props:{defaultValue:null,modelValue:{default:""},options:{default:()=>[]},placeholder:{default:"请输入"}},emits:["update:modelValue"],setup(e,{emit:t}){const u=e,n=l({get:()=>u.modelValue,set(e){t("update:modelValue",e)}}),p=V(!1),f=l((()=>u.options.map((e=>({value:e,label:e}))))),_=e=>{n.value=e[0].value};return g((()=>{u.defaultValue&&(n.value=u.defaultValue)})),(e,t)=>{const l=v,u=a(o("u-icon"),N),g=a(o("u-select"),te);return s(),x(h,null,[i(l,{class:"widget-select"},{default:r((()=>[i(l,{class:"flex-1",onClick:t[0]||(t[0]=e=>p.value=!0)},{default:r((()=>[i(l,{class:y(["h-[70rpx]",d(n)?"text-black":"text-muted"])},{default:r((()=>[m(c(d(n)||"请输入"),1)])),_:1},8,["class"])])),_:1}),i(l,{class:y(["text-muted arrow-icon",{"arrow-icon--top":p.value}])},{default:r((()=>[i(u,{name:"arrow-down"})])),_:1},8,["class"])])),_:1}),i(g,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=e=>p.value=e),list:d(f),onConfirm:_},null,8,["modelValue","list"])],64)}}}),[["__scopeId","data-v-10bbb22f"]]),de=ee(t({__name:"checkbox",props:{defaultValue:null,modelValue:{default:()=>[]},options:{default:()=>[]}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,o=l({get:()=>a.modelValue,set(e){t("update:modelValue",e)}}),n=e=>o.value.includes(e);return g((()=>{a.defaultValue&&(o.value=a.defaultValue)})),(t,l)=>{const a=v;return s(),u(a,{class:"widget-radio"},{default:r((()=>[i(a,{class:"radio-group"},{default:r((()=>[(s(!0),x(h,null,_(e.options,((e,t)=>(s(),u(a,{class:y(["radio-item",{"radio-item--active":n(e)}]),key:t,onClick:t=>(e=>{var t,l,a;const s=null==(t=o.value)?void 0:t.findIndex((t=>e===t));-1===s?null==(l=o.value)||l.push(e):null==(a=o.value)||a.splice(s,1)})(e)},{default:r((()=>[m(c(e),1)])),_:2},1032,["onClick","class"])))),128))])),_:1})])),_:1})}}}),[["__scopeId","data-v-ecc72ec5"]]),pe=t({__name:"form-designer",props:{formLists:{default:()=>[]},modelValue:null,labelPosition:{default:"top"},borderBottom:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{expose:t,emit:i}){const p=e,m=w(),c=l({get:()=>p.modelValue,set(e){i("update:modelValue",e)}}),v=V({});return b((()=>p.formLists),(e=>{v.value=null==e?void 0:e.reduce(((e,t)=>(c.value[t.props.field]=void 0,t.props.isRequired&&(e[t.props.field]=[{required:!0,message:"必填项不能为空"}]),e)),{}),k((()=>{var e;null==(e=m.value)||e.setRules(v.value)}))}),{immediate:!0}),t({validate:async()=>new Promise(((e,t)=>{var l;null==(l=m.value)||l.validate((l=>{l?e(!0):t()}))}))}),(t,l)=>{const i=a(o("u-form-item"),Y),g=a(o("u-form"),X);return s(),u(g,n({model:d(c),ref_key:"formRef",ref:m},{...t.$attrs,...p},{rules:v.value}),{default:r((()=>[(s(!0),x(h,null,_(e.formLists,(t=>(s(),u(i,{key:t.id,prop:t.props.field,label:t.props.title,borderBottom:e.borderBottom,required:t.props.isRequired},{default:r((()=>["WidgetInput"===t.name?(s(),u(ue,n({key:0,class:"w-full"},t.props,{modelValue:d(c)[t.props.field],"onUpdate:modelValue":e=>d(c)[t.props.field]=e}),null,16,["modelValue","onUpdate:modelValue"])):"WidgetTextarea"===t.name?(s(),u(re,n({key:1,class:"w-full"},t.props,{modelValue:d(c)[t.props.field],"onUpdate:modelValue":e=>d(c)[t.props.field]=e}),null,16,["modelValue","onUpdate:modelValue"])):"WidgetRadio"===t.name?(s(),u(ie,n({key:2},t.props,{modelValue:d(c)[t.props.field],"onUpdate:modelValue":e=>d(c)[t.props.field]=e}),null,16,["modelValue","onUpdate:modelValue"])):"WidgetSelect"===t.name?(s(),u(ne,n({key:3,class:"w-full"},t.props,{modelValue:d(c)[t.props.field],"onUpdate:modelValue":e=>d(c)[t.props.field]=e}),null,16,["modelValue","onUpdate:modelValue"])):"WidgetCheckbox"===t.name?(s(),u(de,n({key:4},t.props,{modelValue:d(c)[t.props.field],"onUpdate:modelValue":e=>d(c)[t.props.field]=e}),null,16,["modelValue","onUpdate:modelValue"])):f("v-if",!0)])),_:2},1032,["prop","label","borderBottom","required"])))),128))])),_:1},16,["model","rules"])}}}),me=t({__name:"create",setup(t){const{useShare:l,resolveOptions:n,removeMixinShare:p}=W(),g=j(),y=V(""),b=[{name:"WidgetTextarea",title:"多行文本",props:{field:"question",title:"内容描述",placeholder:"",rows:8,maxlength:400,autosize:!1,isRequired:!1}}],Y=C(),{copy:X}=O(),Z=S({id:0,type:1,token:""}),ee=w(),te=w(),ue=V([]),re=V({}),ie=V({}),ne=V([]),de=V(!1),me=()=>{var e;const t=(null==(e=ie.value)?void 0:e.form[0])||{};return`${t.props.title}：${re.value[t.props.field]||""}`};let ce=Date.now();const fe=async()=>{var t;try{await(null==(t=ee.value)?void 0:t.validate())}catch(l){return console.log(l),void uni.$u.toast("必填项不能为空")}if(g.userInfo.is_chat_limit&&((t,l)=>{const a=e.get(l),o=(new Date).toDateString(),s=!a||a!==o;return s&&t&&e.set(l,o),s})(!0,F)){if((await q({title:"对话上限提示",content:"已超过会员对话上限次数，继续对话将会消耗账户的对话余额",confirmText:"继续",cancelText:"关闭"})).cancel)return}de.value=!0,ce=Date.now();try{await P({model:y.value,other_id:Z.id,question:re.value,creation_type:se.Normal,type:2},{onstart(e){ue.value.length&&(ue.value=[])},onmessage(e){e.trim().split("data:").forEach((async e=>{var t,a,o;if(""!==e)try{const l=JSON.parse(e),{object:s,choices:u,error:r}=l;if(r){const{message:e,code:t}=r;if(1100===t)if(Y.getIsShowRecharge){const{cancel:e}=await q({title:"温馨提示",content:`${Y.getTokenUnit}数量已用完，请前往充值`});if(e)return;xe.navigateTo({path:"/packages/pages/recharge/recharge"})}else uni.$u.toast(`${Y.getTokenUnit}数量已用完。请联系客服增加`);else e&&uni.$u.toast(e);return}let i=ue.value.findIndex((e=>e.id===ce));const n=null==(t=u[0])?void 0:t.index,d=null==(o=null==(a=u[0])?void 0:a.delta)?void 0:o.content;if("chat"!==s&&"reasoning"!==s||(-1===i&&(ue.value.push({create_time:oe(new Date,"yyyy-mm-dd hh:MM:ss"),title:re.value.question?re.value.question:me(),reply:[],extra:ae(re.value),id:ce}),i=ue.value.length-1),d&&(ue.value[i].reply[n]||(ue.value[i].reply[n]=""),ue.value[i].reply[n]+=d)),"finish"===s)return ue.value[i].reply[n]+=d,void ge()}catch(l){}}))},onclose(){setTimeout((()=>{de.value=!1}),500)}})}catch(l){de.value=!1}},ve=()=>{var e,t;null==(t=null==(e=ie.value)?void 0:e.form)||t.forEach((e=>{e.props.placeholder&&!e.props.defaultValue&&(re.value[e.props.field]=e.props.placeholder)}))},ge=()=>{var e;null==(e=ie.value)||e.form.forEach((e=>{e.props.defaultValue?re.value[e.props.field]=ae(e.props.defaultValue):re.value[e.props.field]=void 0}))},xe=I(),{lockFn:he}=G((async e=>{e&&(T({scrollTop:0,duration:0}),re.value=e,await k(),fe())})),_e=()=>xe.navigateTo({path:"/packages/pages/create_history/create_history",query:{id:Z.id}}),{height:ye}=J(te);return le(ye,(()=>{de.value&&T({selector:"#bottom-line",duration:0})}),{throttle:200}),U((async e=>{Z.id=Number(null==e?void 0:e.id),Z.type=Number(null==e?void 0:e.type),await(async()=>{const e=await A({id:Z.id});ie.value=e,ie.value.form||(ie.value.form=b),l({title:e.name,desc:e.tips,imageUrl:e.image}),ne.value=ae(ie.value.form),ge()})(),D("createRewrite",(e=>{console.log(e),he(e)}))})),$((()=>{R("createRewrite")})),(e,t)=>{const l=a(o("page-meta"),z),n=a(o("u-image"),B),p=v,g=L,V=a(o("model-picker"),E),w=a(o("u-icon"),N),b=a(o("u-button"),M);return s(),x(h,null,[i(l,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),ie.value.name?(s(),u(p,{key:0,class:"safe-area-inset-bottom"},{default:r((()=>[i(p,{class:"pt-[20rpx] pb-[220rpx]"},{default:r((()=>[i(p,{class:"px-[20rpx]"},{default:r((()=>[i(p,{class:"px-[30rpx] py-[24rpx] flex rounded-[14rpx] bg-white items-center"},{default:r((()=>[i(n,{src:ie.value.image,width:"84",height:"84"},null,8,["src"]),i(p,{class:"flex-1 min-w-0 ml-[20rpx]"},{default:r((()=>[i(p,{class:"text-xl font-medium"},{default:r((()=>[m(c(ie.value.name),1)])),_:1}),ie.value.tips?(s(),u(p,{key:0,class:"text-content line-clamp-2 text-xs mt-[10rpx]"},{default:r((()=>[m(c(ie.value.tips),1)])),_:1})):f("v-if",!0)])),_:1}),f(' <view @click="collection(modelData.id)">\n                        <u-icon\n                            v-if="modelData?.is_collect == false"\n                            name="star"\n                            color="#ccc"\n                            size="32"\n                        ></u-icon>\n                        <u-icon\n                            v-if="modelData?.is_collect == true"\n                            name="star-fill"\n                            color="#ffac25"\n                            size="32"\n                        ></u-icon>\n                    </view> ')])),_:1}),i(p,{class:"px-[30rpx] py-[24rpx] rounded-[14rpx] bg-white mt-[20rpx]"},{default:r((()=>[i(pe,{ref_key:"formDesignerRef",ref:ee,formLists:ne.value,modelValue:re.value,"onUpdate:modelValue":t[0]||(t[0]=e=>re.value=e)},null,8,["formLists","modelValue"]),i(p,{class:"bg-[#FFFAF0] text-xs rounded-full inline-block px-[30rpx] py-[14rpx] text-[#FD984E] mt-[10rpx]",onClick:ve},{default:r((()=>[m(" 不知道写啥？点击插入示例 👈🏻 ")])),_:1})])),_:1})])),_:1}),i(p,null,{default:r((()=>[i(p,{class:"flex items-center px-[20rpx] py-[30rpx]"},{default:r((()=>[i(p,{class:"text-lg font-medium mr-auto"},{default:r((()=>[m(" 本次创作结果 ")])),_:1}),i(p,{class:"text-content",onClick:_e},{default:r((()=>[m(" 创作历史 ")])),_:1})])),_:1}),i(p,null,{default:r((()=>[i(p,{class:"current-history",ref_key:"currentHistoryRef",ref:te},{default:r((()=>[i(p,{class:"px-[20rpx]"},{default:r((()=>[(s(!0),x(h,null,_(ue.value,(e=>(s(),u(p,{class:"mt-[20rpx]",key:e.id},{default:r((()=>[(s(!0),x(h,null,_(e.reply,((t,l)=>(s(),u(p,{class:"mt-[20rpx]",key:l},{default:r((()=>[i(Q,{title:e.title,time:e.create_time,content:t,showDelete:!1,"show-rewrite":!de.value,onCopy:d(X),onRewrite:t=>d(he)(e.extra)},null,8,["title","time","content","show-rewrite","onCopy","onRewrite"])])),_:2},1024)))),128))])),_:2},1024)))),128))])),_:1})])),_:1},512)])),_:1})])),_:1}),ue.value.length?f("v-if",!0):(s(),u(p,{key:0,class:"flex flex-col justify-center items-center pb-[200rpx]"},{default:r((()=>[i(g,{class:"w-[300rpx] h-[300rpx]",src:H,alt:""}),i(p,{class:"my-[32rpx] font-medium"},{default:r((()=>[m(" AI创作结果会在显示这里，现在你只需要 ")])),_:1}),i(p,null,{default:r((()=>[i(p,{class:"text-content text-sm"},{default:r((()=>[m(" 1.填写越详细，结果越准确哦 ")])),_:1}),i(p,{class:"text-content text-sm"},{default:r((()=>[m(" 2.点击立即生成按钮，一般在10秒内搞定 ")])),_:1})])),_:1})])),_:1}))])),_:1}),i(p,{id:"bottom-line",class:"h-[1px]"}),i(p,{class:"safe-area-inset-bottom fixed bottom-0 left-0 w-full bg-white z-10"},{default:r((()=>[i(p,{class:"p-[20rpx]"},{default:r((()=>[f(" 模型选择 "),i(V,{sub_id:y.value,"onUpdate:sub_id":t[1]||(t[1]=e=>y.value=e),class:"mb-[20rpx]"},null,8,["sub_id"]),i(p,{class:"flex"},{default:r((()=>[i(p,{class:"w-[40%]"},{default:r((()=>[i(b,{hairLine:!1,"custom-style":{width:"100%",border:"none",background:"#f5f5f5"},onClick:ge},{default:r((()=>[i(w,{name:"trash"}),m(" 重置内容 ")])),_:1})])),_:1}),i(p,{class:"flex-1 ml-[20rpx]"},{default:r((()=>[i(b,{type:"primary",loading:de.value,"custom-style":{width:"100%"},onClick:fe},{default:r((()=>[m(" 立即生成 ")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1})])),_:1}),f("    悬浮菜单    "),i(K)])),_:1})):f("v-if",!0)],64)}}});export{me as default};
