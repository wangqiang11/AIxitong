import{d as e,J as a,s as l,x as t,r as s,a as i,o as u,c as d,w as o,b as n,O as m,a4 as r,a6 as f,b4 as p,j as c}from"./index-d6d2a33a.js";import{_ as v}from"./uni-file-picker.87d7f36a.js";const y=e({__name:"app-upload-file",props:{modelValue:{default:()=>[]},fileExtname:{default:()=>[]},data:{default:()=>({})},header:{default:()=>({})},limit:{default:9},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:y}){const V=e,h=a(),x=l([]),_=l(!0),b=async e=>{r({title:"正在上传中。。。"}),_.value=!1;const{tempFilePaths:a}=e,l=a.map((async e=>{await P(e)}));await Promise.all(l),f(),_.value=!0},w=async e=>{var a,l;r({title:"正在上传中，请稍后。。。"}),_.value=!1;const[{item:t}]=e,s=null==t?void 0:t.path,i=null==(l=null==(a=h.value)?void 0:a.filesList)?void 0:l.find((e=>e.path==s));i.progress=0,i.status="ready",await P(s),f(),_.value=!0},P=async e=>{var a,l;const t=null==(l=null==(a=h.value)?void 0:a.filesList)?void 0:l.find((a=>a.path==e));try{const{uri:a,name:l}=await p({filePath:e,formData:V.data,header:V.header},(e=>{t&&(t.progress=e)}));t.status="success",t.url=a,y("update:modelValue",[...V.modelValue.slice(),{url:a,name:l}])}catch(s){t&&(t.progress=0,t.status="error")}},k=e=>{_.value=!1;const{tempFilePath:a}=e,l=V.modelValue.findIndex((e=>e.url==a));if(l>-1){const e=V.modelValue.slice();e.splice(l,1),y("update:modelValue",e)}setTimeout((()=>{_.value=!0}))};return t((()=>V.modelValue),(e=>{_.value&&(x.value=e)}),{immediate:!0}),(a,l)=>{const t=s(i("uni-file-picker"),v),r=c;return u(),d(r,null,{default:o((()=>[n(t,{ref_key:"filePickerRef",ref:h,modelValue:x.value,"onUpdate:modelValue":l[0]||(l[0]=e=>x.value=e),limit:e.limit,"file-mediatype":"all",mode:"list","del-icon":!0,"list-styles":{display:"none"},fileExtname:e.fileExtname,disabled:e.disabled,onRetry:w,onSelect:b,onDelete:k},{default:o((()=>[m(a.$slots,"default")])),_:3},8,["modelValue","limit","fileExtname","disabled"])])),_:3})}}});export{y as _};
