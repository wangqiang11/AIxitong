import{d as e,K as l,o as a,c as t,w as s,b as o,k as u,l as i,F as r,j as m,D as d,r as n,a as p,m as c,e as f,n as _,f as v,t as x,g,C as h,x as w,P as V,s as y,a7 as b,J as j,u as k,A as L,$ as U,bo as q,z as C,ae as z,ag as F,h as T,b3 as $}from"./index-d6d2a33a.js";import{_ as J}from"./page-meta.d751427a.js";import{_ as M}from"./u-empty.a728d8d9.js";import{_ as E}from"./tabbar.vue_vue_type_script_setup_true_lang.e2e30d1a.js";import{_ as D}from"./u-icon.992584aa.js";import{_ as I}from"./router-navigate.18e98059.js";import{_ as K}from"./u-navbar.d70905ec.js";import{_ as R}from"./u-form.f207500c.js";import{_ as B}from"./u-button.97a3d07f.js";import{u as O}from"./useLockFn.3b1f86f9.js";import{b as P,c as A}from"./draw.cfe8756a.js";import{_ as H,a as S,D as G,P as N}from"./item-title.vue_vue_type_script_setup_true_lang.c5dbcb83.js";import{U as X}from"./uploader-picture.d97f4fdc.js";import{_ as Z}from"./u-form-item.36bcbf1f.js";import{a as Q}from"./index.3dd6f2ef.js";import{_ as W}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as Y}from"./u-image.9574760c.js";import{_ as ee}from"./app-select.66776d41.js";import{_ as le}from"./app-slider.f52d5aca.js";import{_ as ae,a as te}from"./u-collapse.5c69f838.js";import"./u-badge.f9b9ebb9.js";import"./l-textarea.9d4b6972.js";import"./u-loading.d153dd1a.js";import"./u-popup.21776ef7.js";import"./uni-file-picker.87d7f36a.js";import"./image-uploader.b31ee9fb.js";import"./emitter.1571a5d9.js";import"./index.22b2ad12.js";import"./u-tag.fd761889.js";import"./u-search.7e682473.js";import"./u-radio-group.5e4decfb.js";import"./u-checkbox.0fdc3635.js";const se=W(e({__name:"mj-size",props:{modelValue:{default:"512x512"}},emits:["update:modelValue"],setup(e,{emit:g}){const h=e,{modelValue:w}=Q(h,g),V=l({lists:[{name:"头像",scaleLabel:"1:1",scaleValue:"1:1",width:40,height:40},{name:"手机壁纸",scaleLabel:"1:2",scaleValue:"1:2",width:20,height:40},{name:"小红书",scaleLabel:"2:3",scaleValue:"2:3",width:25,height:40},{name:"文章",scaleLabel:"4:3",scaleValue:"4:3",width:40,height:30},{name:"媒体",scaleLabel:"3:4",scaleValue:"3:4",width:30,height:40},{name:"宣传海报",scaleLabel:"9:16",scaleValue:"9:16",width:24,height:40},{name:"电脑壁纸",scaleLabel:"16:9",scaleValue:"16:9",width:40,height:24},{name:"横版名片",scaleLabel:"3:2",scaleValue:"3:2",width:40,height:30}]});return w.value="1:1",(e,l)=>{const g=m,h=d,y=n(p("u-form-item"),Z);return a(),t(g,{class:"mt-4"},{default:s((()=>[o(H,{title:"图片尺寸",tips:"指定生成图像的宽高比",required:""}),o(y,{prop:"size"},{default:s((()=>[o(g,{class:"flex-1 bg-white rounded-lg py-[20rpx] pr-[20rpx] overflow-hidden"},{default:s((()=>[o(h,{class:"flex-1 min-w-0 whitespace-nowrap","scroll-x":""},{default:s((()=>[(a(!0),u(r,null,i(V.lists,((e,l)=>(a(),t(g,{key:l,class:"inline-block w-[140rpx] ml-[20rpx]"},{default:s((()=>[o(g,{class:c(["picture-size text-center hover:text-primary",{"picture-size-active":f(w)==(null==e?void 0:e.scaleValue)}]),onClick:l=>w.value=e.scaleValue},{default:s((()=>[o(g,{class:"flex justify-center items-center h-[40rpx]"},{default:s((()=>[o(g,{class:"rect",style:_({width:`${e.width}rpx`,height:`${e.height}rpx`})},null,8,["style"])])),_:2},1024),o(g,{class:"text-[#101010] font-medium mt-[8rpx] size-scale"},{default:s((()=>[v(x(e.scaleLabel),1)])),_:2},1024),o(g,{class:"text-[#808D9C] mt-[8rpx] text-xs size-scale"},{default:s((()=>[v(x(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-db754d12"]]),oe=e({__name:"mj-model",props:{modelValue:{default:""}},emits:["update:modelValue","changeCate"],setup(e,{emit:l}){const d=e,{modelValue:c}=Q(d,l),_=window.origin+"/",h=[{value:"mj",title:"真实感强",cover:_+"resource/image/api/draw/mj.png"},{value:"niji",title:"卡通动漫",cover:_+"resource/image/api/draw/nj.png"}];return(e,l)=>{const d=n(p("u-image"),Y),_=m,w=n(p("u-icon"),D),V=n(p("u-form-item"),Z);return a(),t(_,{class:"mt-4"},{default:s((()=>[o(H,{title:"模型选择",tips:"让AI根据此模型的风格绘制图片，修改合适的描述词和参数可以让生成效果更加精美",required:""}),o(V,{label:""},{default:s((()=>[o(_,{class:"flex-1 min-w-0 pt-[20rpx] px-[20rpx] bg-white rounded-lg overflow-hidden"},{default:s((()=>[h.length?(a(),t(_,{key:0,class:"flex flex-wrap"},{default:s((()=>[(a(),u(r,null,i(h,((e,l)=>o(_,{key:e.cover,class:"w-[50%] px-[10rpx]"},{default:s((()=>[o(_,{class:"h-full",onClick:l=>{return a=e.value,void(c.value=a);var a}},{default:s((()=>[o(_,{class:"pt-[70%] relative h-0 rounded-[10rpx] overflow-hidden"},{default:s((()=>[o(_,{class:"absolute inset-0 left-0 top-0"},{default:s((()=>[o(d,{src:e.cover,class:"h-full w-full",width:"100%",mode:"widthFix"},null,8,["src"])])),_:2},1024),f(c)===e.value?(a(),t(_,{key:0,class:"absolute bg-[rgba(0,0,0,0.5)] inset-0 left-0 top-0 flex items-center justify-center text-white"},{default:s((()=>[o(w,{name:"checkmark-circle-fill",size:40})])),_:1})):g("v-if",!0)])),_:2},1024),o(_,{class:"text-center text-xs line-clamp-1"},{default:s((()=>[v(x(e.title),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024))),64))])),_:1})):g("v-if",!0)])),_:1})])),_:1})])),_:1})}}}),ue=e({__name:"mj-version",props:{modelValue:{default:""},versionList:{default:[]},drawModel:null},emits:["update:modelValue"],setup(e,{emit:l}){const u=e,{modelValue:i}=Q(u,l),r=h((()=>{var e;return(null==(e=null==u?void 0:u.versionList)?void 0:e.map((e=>({value:e,label:`${e}`}))))||[]}));return w((()=>[null==u?void 0:u.versionList,u.drawModel]),(()=>{(null==u?void 0:u.versionList.length)&&(i.value=null==u?void 0:u.versionList[0])})),(e,l)=>{const u=n(p("app-select"),ee),d=m,c=n(p("u-form-item"),Z);return a(),t(d,{class:"mt-4"},{default:s((()=>[o(H,{title:"版本选择",tips:"指定midjourney的渲染版本",required:""}),o(c,{prop:"size"},{default:s((()=>[o(d,{class:"flex-1 bg-white rounded-lg py-[20rpx] px-[20rpx] overflow-hidden"},{default:s((()=>[o(u,{modelValue:f(i),"onUpdate:modelValue":l[0]||(l[0]=e=>V(i)?i.value=e:null),popupTitle:"版本选择",dataLists:f(r),placeholder:"请选择",closeable:!1,name:"label",value:"value"},null,8,["modelValue","dataLists"])])),_:1})])),_:1})])),_:1})}}}),ie=e({__name:"mj-styles",props:{modelValue:{default:""},stylesList:{default:{}}},emits:["update:modelValue"],setup(e,{emit:l}){const u=e,{modelValue:i}=Q(u,l),r=h((()=>Reflect.ownKeys(u.stylesList).map((e=>({value:e,label:u.stylesList[e]})))));return(e,l)=>{const u=n(p("app-select"),ee),d=m,c=n(p("u-form-item"),Z);return a(),t(d,{class:"mt-4"},{default:s((()=>[o(H,{title:"风格选择",tips:"指定midjourney的渲染风格",required:""}),o(c,{prop:"size"},{default:s((()=>[o(d,{class:"flex-1 bg-white rounded-lg py-[20rpx] px-[20rpx] overflow-hidden"},{default:s((()=>[o(u,{modelValue:f(i),"onUpdate:modelValue":l[0]||(l[0]=e=>V(i)?i.value=e:null),popupTitle:"风格选择",dataLists:f(r),placeholder:"请选择",closeable:!1,name:"label",value:"value"},null,8,["modelValue","dataLists"])])),_:1})])),_:1})])),_:1})}}}),re=W(e({__name:"mj-options",props:{modelValue:{default:()=>{}},qList:{default:{}}},emits:["update:modelValue"],setup(e,{emit:l}){const u=e,i=y(!0),{modelValue:r}=Q(u,l),d=h((()=>Reflect.ownKeys(u.qList).map((e=>({value:e,label:u.qList[e]}))))),c=e=>{const l=parseFloat(e.target.value);r.value.iw=l>=2?2:l<0?.5:l},_=e=>{const l=parseFloat(e.target.value);r.value.s=l>=1e3?1e3:l<0?0:l},v=e=>{const l=parseFloat(e.target.value);r.value.c=l>=100?100:l<0?0:l};return(e,l)=>{const u=n(p("app-slider"),le),x=m,h=b,w=n(p("app-select"),ee),V=n(p("u-collapse-item"),ae),y=n(p("u-collapse"),te);return a(),t(y,null,{default:s((()=>[(a(),t(V,{title:"高级参数",key:"index",open:i.value},{default:s((()=>[o(x,{class:"flex-1 min-w-0 p-[20rpx] bg-white rounded-lg"},{default:s((()=>[g(" 参考图权重 "),o(x,{class:"text-base text-main"},{default:s((()=>[o(H,{title:"参考图权重",tips:"设置生成图片时垫图的权重，值越大越像垫图，取值范围0.5-2， 默认值1","font-weight":"400"}),o(x,{class:"flex items-center justify-between mt-[10rpx]"},{default:s((()=>[o(x,{class:"w-[480rpx]"},{default:s((()=>[o(u,{step:.1,min:.5,max:2,showValue:!1,activeColor:e.$theme.primaryColor,modelValue:f(r).iw,"onUpdate:modelValue":l[0]||(l[0]=e=>f(r).iw=e)},null,8,["step","min","activeColor","modelValue"])])),_:1}),o(h,{class:"options-input",type:"number",step:.1,min:.5,max:2,style:{width:"80rpx"},modelValue:f(r).iw,"onUpdate:modelValue":l[1]||(l[1]=e=>f(r).iw=e),onBlur:c},null,8,["step","min","modelValue"])])),_:1})])),_:1}),g(" 图片质量 "),o(x,{class:"text-base text-main mt-2"},{default:s((()=>[o(H,{title:"图片质量",tips:"设置图片的质量，越大质量越高，取值范围0.3-5，默认值1","font-weight":"400"}),o(x,{class:"flex-1 mt-[10rpx]"},{default:s((()=>[o(w,{modelValue:f(r).q,"onUpdate:modelValue":l[2]||(l[2]=e=>f(r).q=e),popupTitle:"图片质量",dataLists:f(d),placeholder:"请选择",closeable:!1,name:"label",value:"value"},null,8,["modelValue","dataLists"])])),_:1})])),_:1}),g(" 风格化值 "),o(x,{class:"text-base text-main mt-2"},{default:s((()=>[o(H,{title:"风格化值",tips:"设置生成图片时的风格化程度，值越大，风格化的程度越高，取值范围0-1000， 默认值100","font-weight":"400"}),o(x,{class:"flex items-center justify-between mt-[10rpx]"},{default:s((()=>[o(x,{class:"w-[480rpx]"},{default:s((()=>[o(u,{step:1,max:1e3,min:0,showValue:!1,activeColor:e.$theme.primaryColor,modelValue:f(r).s,"onUpdate:modelValue":l[3]||(l[3]=e=>f(r).s=e)},null,8,["activeColor","modelValue"])])),_:1}),o(h,{class:"options-input",type:"number",step:1,max:1e3,min:0,style:{width:"80rpx"},modelValue:f(r).s,"onUpdate:modelValue":l[4]||(l[4]=e=>f(r).s=e),onBlur:_},null,8,["modelValue"])])),_:1})])),_:1}),g(" 混乱值 "),o(x,{class:"text-base text-main mt-2"},{default:s((()=>[o(H,{title:"混乱值",tips:"本参数会控制生成4张图的差别， 值越大，生成4张图的区别越大，值越小,生成的4张图越接近，取值范围0-100， 默认值0","font-weight":"400"}),o(x,{class:"flex items-center justify-between mt-[10rpx]"},{default:s((()=>[o(x,{class:"w-[480rpx]"},{default:s((()=>[o(u,{step:1,max:100,min:0,showValue:!1,activeColor:e.$theme.primaryColor,modelValue:f(r).c,"onUpdate:modelValue":l[5]||(l[5]=e=>f(r).c=e)},null,8,["activeColor","modelValue"])])),_:1}),o(h,{class:"options-input",type:"number",step:1,max:100,min:0,style:{width:"80rpx"},modelValue:f(r).c,"onUpdate:modelValue":l[6]||(l[6]=e=>f(r).c=e),onBlur:v},null,8,["modelValue"])])),_:1})])),_:1}),g(" 随机种子 "),o(x,{class:"text-base text-main mt-2"},{default:s((()=>[o(H,{title:"随机种子",tips:"种子用于指定生成效果，可以用于生成套图，保障生成的一系列图片保持同一种风格","font-weight":"400"}),o(x,{class:"flex-1 mt-[10rpx]"},{default:s((()=>[o(h,{class:"options-input",type:"number",modelValue:f(r).seed,"onUpdate:modelValue":l[7]||(l[7]=e=>f(r).seed=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["open"]))])),_:1})}}}),[["__scopeId","data-v-20c3535a"]]),me=W(e({__name:"mj",setup(e){const i=C(),c=z(),_=j(),h=k(),w=L(),V=y({draw_api:S.MJ,draw_type:G.TEXT,draw_model:"mj",size:"1:1",prompt:"",negative_prompt:"",action:"generate",image_mask:"",image_id:"",complex_params:{seed:"",iw:1,q:"1",s:100,c:0},style:"",version:"",origin_task_id:""}),b=l({config:{mj_version:{},mj_style:{},mj_quality:{}}}),H=F((async()=>{b.config=await A({draw_api:S.MJ}),$({title:b.config.diy_name})})),{lockFn:Z,isLock:Q}=O((async e=>{try{if(e&&(V.value.action=e),""===V.value.prompt)return uni.$u.toast("请输入提示词");await P({...V.value}),V.value.prompt="",i.navigateTo({path:"/packages/pages/draw_list/draw_list",query:{model:S.MJ}})}catch(l){}}));return H(),U((()=>{q("drawRegenerate",(e=>{Object.assign(V.value,e),"generate"!==e.action&&Z(e.action)}));const e=c.query;try{const l=JSON.parse(e.data);Object.assign(V.value,l),"generate"!==l.action&&Z(l.action)}catch(l){}})),(e,l)=>{const i=n(p("page-meta"),J),c=n(p("u-empty"),M),y=n(p("tabbar"),E),j=m,k=n(p("u-icon"),D),L=n(p("router-navigate"),I),U=n(p("u-navbar"),K),q=n(p("u-form"),R),C=d,z=T,F=n(p("u-button"),B);return a(),u(r,null,[o(i,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),o(j,{class:"h-full flex flex-col bg-[#f5f8fd]"},{default:s((()=>[f(h).config.switch.mj_status?(a(),u(r,{key:1},[o(U,{"back-text":"绘画工作台"},{right:s((()=>[o(L,{to:{path:"/packages/pages/draw_list/draw_list",query:{model:f(S).MJ}}},{default:s((()=>[o(j,{class:"flex items-center mr-[20rpx]"},{default:s((()=>[o(j,{class:"text-primary flex"},{default:s((()=>[o(k,{name:"clock",size:32})])),_:1}),o(j,{class:"text-muted ml-[10rpx]"},{default:s((()=>[v("历史记录")])),_:1})])),_:1})])),_:1},8,["to"])])),_:1}),o(j,{class:"flex-1 min-h-0"},{default:s((()=>[o(C,{class:"h-full","scroll-y":""},{default:s((()=>[o(j,{class:"px-[20rpx] pb-[30rpx] pt-[6rpx]"},{default:s((()=>[o(q,{ref_key:"uFormRef",ref:_,model:V.value,"label-position":"top","border-bottom":!1},{default:s((()=>{var e,s;return[g("    关键词    "),o(N,{modelValue:V.value.prompt,"onUpdate:modelValue":l[0]||(l[0]=e=>V.value.prompt=e),negative:V.value.negative_prompt,"onUpdate:negative":l[1]||(l[1]=e=>V.value.negative_prompt=e),"is-negative":!0,model:f(S).MJ,example:b.example,typeEnum:f(G),showTranslate:!!b.config.translate_switch},null,8,["modelValue","negative","model","example","typeEnum","showTranslate"]),g("    图片上传    "),o(X,{modelValue:V.value.image_mask,"onUpdate:modelValue":l[2]||(l[2]=e=>V.value.image_mask=e)},null,8,["modelValue"]),g("    图片尺寸    "),o(se,{modelValue:V.value.size,"onUpdate:modelValue":l[3]||(l[3]=e=>V.value.size=e)},null,8,["modelValue"]),g(" 绘画模型 "),o(oe,{modelValue:V.value.draw_model,"onUpdate:modelValue":l[4]||(l[4]=e=>V.value.draw_model=e)},null,8,["modelValue"]),g(" 版本选择 "),o(ue,{modelValue:V.value.version,"onUpdate:modelValue":l[5]||(l[5]=e=>V.value.version=e),"draw-model":V.value.draw_model,versionList:null==(e=b.config)?void 0:e.mj_version[V.value.draw_model]},null,8,["modelValue","draw-model","versionList"]),g(" 风格选择 "),5==V.value.version&&"niji"==V.value.draw_model?(a(),t(ie,{key:0,"styles-list":null==(s=b.config)?void 0:s.mj_style,modelValue:V.value.style,"onUpdate:modelValue":l[6]||(l[6]=e=>V.value.style=e)},null,8,["styles-list","modelValue"])):g("v-if",!0),g(" 高级参数 "),o(re,{modelValue:V.value.complex_params,"onUpdate:modelValue":l[7]||(l[7]=e=>V.value.complex_params=e),"q-list":b.config.mj_quality},null,8,["modelValue","q-list"])]})),_:1},8,["model"])])),_:1})])),_:1})])),_:1}),o(j,{class:"p-[20rpx] bg-white safe-area-inset-bottom"},{default:s((()=>[o(F,{type:"primary",loading:f(Q),onClick:l[8]||(l[8]=e=>f(Z)("generate"))},{default:s((()=>[o(j,null,{default:s((()=>[o(z,{class:"text-xl font-bold"},{default:s((()=>[v("立即生成")])),_:1}),b.config.is_member?(a(),t(z,{key:0,class:"text-sm ml-[4px]"},{default:s((()=>[v(" 会员免费 ")])),_:1})):g("v-if",!0),0!=b.config.power&&!b.config.is_member&&f(w).isLogin?(a(),t(z,{key:1,class:"text-sm ml-[4px]"},{default:s((()=>[v(" 消耗"+x(b.config.power||"--")+x(f(h).getTokenUnit),1)])),_:1})):g("v-if",!0)])),_:1})])),_:1},8,["loading"])])),_:1})],64)):(a(),t(j,{key:0,class:"w-full h-full bg-white rounded-[6px] flex items-center justify-center"},{default:s((()=>[o(c,{text:"绘画功能未开启",mode:"favor"}),o(y)])),_:1})),o(y)])),_:1})],64)}}}),[["__scopeId","data-v-6f34eead"]]);export{me as default};
