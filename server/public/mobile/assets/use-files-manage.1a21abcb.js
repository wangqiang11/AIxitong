import{_ as e}from"./u-loading.d153dd1a.js";import{d as a,s,o as t,c as r,w as i,b as o,f as n,r as l,a as c,j as u}from"./index-d6d2a33a.js";import{_ as m}from"./u-icon.992584aa.js";import{_ as d}from"./uni-file-picker.87d7f36a.js";import{r as p,a as f,b as x}from"./fileReader.617b57ea.js";import{_}from"./_plugin-vue_export-helper.1b428a4d.js";const v=_(a({__name:"file-parser",emits:["on-success","on-failed"],setup(a,{emit:_}){const v=s(!1);async function w(e){v.value=!0;const a=e.tempFiles||[];for(let t=0,r=a.length;t<r;t++){const e=a[t],r=e.file;try{if(e.size>5242880)throw new Error(`${e.name} 文件超过5MB`);const a={id:e.uuid,url:e.url,type:30,name:e.name,size:e.size,text:""};a.text=await y(r),_("on-success",a)}catch(s){const a=s instanceof Error?s.message:"文件解析错误";uni.$u.toast(`${e.nam} ${a}`)}}v.value=!1}const y=async e=>{switch(e.name.split(".").pop()){case"md":case"txt":default:return await p(e);case"pdf":return await x(e);case"doc":case"docx":return await f(e)}};return(a,s)=>{const p=l(c("u-loading"),e),f=l(c("u-icon"),m),x=u,_=l(c("uni-file-picker"),d);return t(),r(_,{class:"uni-file-picker",mode:"list",limit:10,"file-mediatype":"file","auto-upload":!1,"file-extname":["md","txt","pdf","doc","docx"],onSelect:w},{default:i((()=>[o(x,{class:"text-sm text-primary flex items-center bg-[#ECF6FF] py-[10rpx] px-[18rpx] rounded-full"},{default:i((()=>[v.value?(t(),r(p,{key:0,mode:"flower",class:"mr-[4rpx]",size:"28"})):(t(),r(f,{key:1,name:"arrow-upward",class:"mr-[4rpx]",size:"28"})),n(" 文件 ")])),_:1})])),_:1})}}}),[["__scopeId","data-v-9b96ae2d"]]);function w(){const e=s([]);return{files:e,addFile:a=>{e.value=[...e.value,a]},removeFile:a=>{e.value=e.value.filter((e=>e.id!==a.id))},clear:()=>{e.value=[]}}}export{v as F,w as u};
